{"id":"32305962192","type":"CommitCommentEvent","actor":{"id":69727,"login":"mstorsjo","display_login":"mstorsjo","gravatar_id":"","url":"https://api.github.com/users/mstorsjo","avatar_url":"https://avatars.githubusercontent.com/u/69727?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"comment":{"url":"https://api.github.com/repos/tukaani-project/xz/comments/129098431","html_url":"https://github.com/tukaani-project/xz/commit/0570308ddd9c0e39e85597ebc0e31d4fc81d436f#commitcomment-129098431","id":129098431,"node_id":"CC_kwDOIQBEvs4HseK_","user":{"login":"mstorsjo","id":69727,"node_id":"MDQ6VXNlcjY5NzI3","avatar_url":"https://avatars.githubusercontent.com/u/69727?v=4","gravatar_id":"","url":"https://api.github.com/users/mstorsjo","html_url":"https://github.com/mstorsjo","followers_url":"https://api.github.com/users/mstorsjo/followers","following_url":"https://api.github.com/users/mstorsjo/following{/other_user}","gists_url":"https://api.github.com/users/mstorsjo/gists{/gist_id}","starred_url":"https://api.github.com/users/mstorsjo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstorsjo/subscriptions","organizations_url":"https://api.github.com/users/mstorsjo/orgs","repos_url":"https://api.github.com/users/mstorsjo/repos","events_url":"https://api.github.com/users/mstorsjo/events{/privacy}","received_events_url":"https://api.github.com/users/mstorsjo/received_events","type":"User","site_admin":false},"position":null,"line":null,"path":null,"commit_id":"0570308ddd9c0e39e85597ebc0e31d4fc81d436f","created_at":"2023-10-04T10:46:29Z","updated_at":"2023-10-04T10:46:29Z","author_association":"NONE","body":"Kiitos/tack!\r\n\r\nI was just about to submit a PR doing the same, when I saw that you had updated xz already to take this into account. Very much appreciated.\r\n\r\nWhen I made llvm-windres originally, I wasn't aware of how `--use-temp-file` affects how GNU windres mangles the command line arguments. Without the flag, the arguments get interpreted by a shell one time extra within the `popen()`, as you've noted. Some projects explicitly expect this - see e.g. https://git.savannah.gnu.org/gitweb/?p=gettext.git;a=blob;f=windows/windres-options;h=b12edd0edc875a15dd0b79a54b975cd6ced91b0f;hb=775d1d26a8f72214834ef4d399bad4690b7a604c#l67 - and I've made llvm-windres handle that. That works, but if you'd be using that, you'd need to pass different `-D` options to windres and to the compiler in general. (That setup still is problematic for passing strings with spaces in them to GNU windres though.) But using `--use-temp-file` seems like a much nicer solution.\r\n\r\nFWIW, I was about to suggest a slightly different form of the cmake conditional, something like this:\r\n```cmake\r\nif(MINGW AND (NOT CMAKE_C_COMPILER_ID MATCHES \"Clang\" OR\r\n              CMAKE_C_COMPILER_VERSION VERSION_GREATER_EQUAL \"17\"))\r\n```\r\nThis assumes that any mingw-compatible toolchain supports this, with llvm-windres older than 16 being the exception. In the future for cleanup, that distinction could also maybe be dropped entirely.\r\n\r\nRegardless, it might make sense to change the leading `if (WIN32 ...` into `if (MINGW` in any case; I think a setup with Clang acting in MSVC mode (with `llvm-rc` or MS `rc.exe` as the RC tool) would hit this otherwise.","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/comments/129098431/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0}}},"public":true,"created_at":"2023-10-04T10:46:29Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
{"id":"32305989976","type":"IssueCommentEvent","actor":{"id":69727,"login":"mstorsjo","display_login":"mstorsjo","gravatar_id":"","url":"https://api.github.com/users/mstorsjo","avatar_url":"https://avatars.githubusercontent.com/u/69727?"},"repo":{"id":112254496,"name":"mstorsjo/llvm-mingw","url":"https://api.github.com/repos/mstorsjo/llvm-mingw"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363","repository_url":"https://api.github.com/repos/mstorsjo/llvm-mingw","labels_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/labels{/name}","comments_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/comments","events_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/events","html_url":"https://github.com/mstorsjo/llvm-mingw/issues/363","id":1857901647,"node_id":"I_kwDOBrDeIM5uvVRP","number":363,"title":"Issue with windres/rc","user":{"login":"DeadSix27","id":1492505,"node_id":"MDQ6VXNlcjE0OTI1MDU=","avatar_url":"https://avatars.githubusercontent.com/u/1492505?v=4","gravatar_id":"","url":"https://api.github.com/users/DeadSix27","html_url":"https://github.com/DeadSix27","followers_url":"https://api.github.com/users/DeadSix27/followers","following_url":"https://api.github.com/users/DeadSix27/following{/other_user}","gists_url":"https://api.github.com/users/DeadSix27/gists{/gist_id}","starred_url":"https://api.github.com/users/DeadSix27/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DeadSix27/subscriptions","organizations_url":"https://api.github.com/users/DeadSix27/orgs","repos_url":"https://api.github.com/users/DeadSix27/repos","events_url":"https://api.github.com/users/DeadSix27/events{/privacy}","received_events_url":"https://api.github.com/users/DeadSix27/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2023-08-19T23:50:46Z","updated_at":"2023-10-04T10:47:32Z","closed_at":"2023-10-04T10:47:31Z","author_association":"NONE","active_lock_reason":null,"body":"I'm not quite sure what's happening here, but I was trying to compile lzma with the llvm-mingw toolchain and got into this issue: \r\nllvm-rc: Error parsing file: Invalid token found at position 635\r\nLooked into the resource file:\r\n```\r\n/*\r\n * Author: Lasse Collin\r\n *\r\n * This file has been put into the public domain.\r\n * You can do whatever you want with this file.\r\n */\r\n\r\n#define MY_TYPE VFT_APP\r\n#define MY_NAME \"xzdec\"\r\n#define MY_SUFFIX \".exe\"\r\n#define MY_DESC \"xzdec decompression tool for .xz files\"\r\n#include \"common_w32res.rc\"\r\n```\r\n(check the git for the other rc files here: https://github.com/tukaani-project/xz/tree/master/src/xzdec\r\n\r\nLooked for position 635, couldn't really figure out the issue here.. any advice?\r\n\r\nThe lzma cmake script runs windres via this command line:\r\n\r\n`x86_64-w64-mingw32-windres -O coff -DHAVE_CHECK_CRC32 -DHAVE_CHECK_CRC64 -DHAVE_CHECK_SHA256 -DHAVE_DECODERS -DHAVE_DECODER_ARM -DHAVE_DECODER_ARM64 -DHAVE_DECODER_ARMTHUMB -DHAVE_DECODER_DELTA -DHAVE_DECODER_IA64 -DHAVE_DECODER_LZMA1 -DHAVE_DECODER_LZMA2 -DHAVE_DECODER_POWERPC -DHAVE_DECODER_SPARC -DHAVE_DECODER_X86 -DHAVE_ENCODERS -DHAVE_ENCODER_ARM -DHAVE_ENCODER_ARM64 -DHAVE_ENCODER_ARMTHUMB -DHAVE_ENCODER_DELTA -DHAVE_ENCODER_IA64 -DHAVE_ENCODER_LZMA1 -DHAVE_ENCODER_LZMA2 -DHAVE_ENCODER_POWERPC -DHAVE_ENCODER_SPARC -DHAVE_ENCODER_X86 -DHAVE_INTTYPES_H -DHAVE_LZIP_DECODER -DHAVE_MF_BT2 -DHAVE_MF_BT3 -DHAVE_MF_BT4 -DHAVE_MF_HC3 -DHAVE_MF_HC4 -DHAVE_STDBOOL_H -DHAVE_STDINT_H -DHAVE__BOOL -DHAVE___BUILTIN_ASSUME_ALIGNED -DHAVE___BUILTIN_BSWAPXX -DLZMA_API_STATIC -DMYTHREAD_VISTA -DPACKAGE_BUGREPORT=\\\"xz@tukaani.org\\\" -DPACKAGE_NAME=\"\\\"XZ Utils\\\"\" -DPACKAGE_URL=\\\"https://tukaani.org/xz/\\\" -DTUKLIB_FAST_UNALIGNED_ACCESS -I /sources/lzma/src/common -I /sources/lzma/src/liblzma/api  /sources/lzma/src/xzdec/xzdec_w32res.rc CMakeFiles/xzdec.dir/src/xzdec/xzdec_w32res.rc.res\r\nllvm-rc: Error parsing file: Invalid token found at position 635`","reactions":{"url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/timeline","performed_via_github_app":null,"state_reason":"completed"},"comment":{"url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/comments/1746621113","html_url":"https://github.com/mstorsjo/llvm-mingw/issues/363#issuecomment-1746621113","issue_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363","id":1746621113,"node_id":"IC_kwDOBrDeIM5oG1K5","user":{"login":"mstorsjo","id":69727,"node_id":"MDQ6VXNlcjY5NzI3","avatar_url":"https://avatars.githubusercontent.com/u/69727?v=4","gravatar_id":"","url":"https://api.github.com/users/mstorsjo","html_url":"https://github.com/mstorsjo","followers_url":"https://api.github.com/users/mstorsjo/followers","following_url":"https://api.github.com/users/mstorsjo/following{/other_user}","gists_url":"https://api.github.com/users/mstorsjo/gists{/gist_id}","starred_url":"https://api.github.com/users/mstorsjo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mstorsjo/subscriptions","organizations_url":"https://api.github.com/users/mstorsjo/orgs","repos_url":"https://api.github.com/users/mstorsjo/repos","events_url":"https://api.github.com/users/mstorsjo/events{/privacy}","received_events_url":"https://api.github.com/users/mstorsjo/received_events","type":"User","site_admin":false},"created_at":"2023-10-04T10:47:31Z","updated_at":"2023-10-04T10:47:31Z","author_association":"OWNER","body":"This seems to have been fixed in https://github.com/tukaani-project/xz/commit/0570308ddd9c0e39e85597ebc0e31d4fc81d436f.","reactions":{"url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/comments/1746621113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2023-10-04T10:47:32Z"}
{"id":"32305990068","type":"IssuesEvent","actor":{"id":69727,"login":"mstorsjo","display_login":"mstorsjo","gravatar_id":"","url":"https://api.github.com/users/mstorsjo","avatar_url":"https://avatars.githubusercontent.com/u/69727?"},"repo":{"id":112254496,"name":"mstorsjo/llvm-mingw","url":"https://api.github.com/repos/mstorsjo/llvm-mingw"},"payload":{"action":"closed","issue":{"url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363","repository_url":"https://api.github.com/repos/mstorsjo/llvm-mingw","labels_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/labels{/name}","comments_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/comments","events_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/events","html_url":"https://github.com/mstorsjo/llvm-mingw/issues/363","id":1857901647,"node_id":"I_kwDOBrDeIM5uvVRP","number":363,"title":"Issue with windres/rc","user":{"login":"DeadSix27","id":1492505,"node_id":"MDQ6VXNlcjE0OTI1MDU=","avatar_url":"https://avatars.githubusercontent.com/u/1492505?v=4","gravatar_id":"","url":"https://api.github.com/users/DeadSix27","html_url":"https://github.com/DeadSix27","followers_url":"https://api.github.com/users/DeadSix27/followers","following_url":"https://api.github.com/users/DeadSix27/following{/other_user}","gists_url":"https://api.github.com/users/DeadSix27/gists{/gist_id}","starred_url":"https://api.github.com/users/DeadSix27/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DeadSix27/subscriptions","organizations_url":"https://api.github.com/users/DeadSix27/orgs","repos_url":"https://api.github.com/users/DeadSix27/repos","events_url":"https://api.github.com/users/DeadSix27/events{/privacy}","received_events_url":"https://api.github.com/users/DeadSix27/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2023-08-19T23:50:46Z","updated_at":"2023-10-04T10:47:32Z","closed_at":"2023-10-04T10:47:31Z","author_association":"NONE","active_lock_reason":null,"body":"I'm not quite sure what's happening here, but I was trying to compile lzma with the llvm-mingw toolchain and got into this issue: \r\nllvm-rc: Error parsing file: Invalid token found at position 635\r\nLooked into the resource file:\r\n```\r\n/*\r\n * Author: Lasse Collin\r\n *\r\n * This file has been put into the public domain.\r\n * You can do whatever you want with this file.\r\n */\r\n\r\n#define MY_TYPE VFT_APP\r\n#define MY_NAME \"xzdec\"\r\n#define MY_SUFFIX \".exe\"\r\n#define MY_DESC \"xzdec decompression tool for .xz files\"\r\n#include \"common_w32res.rc\"\r\n```\r\n(check the git for the other rc files here: https://github.com/tukaani-project/xz/tree/master/src/xzdec\r\n\r\nLooked for position 635, couldn't really figure out the issue here.. any advice?\r\n\r\nThe lzma cmake script runs windres via this command line:\r\n\r\n`x86_64-w64-mingw32-windres -O coff -DHAVE_CHECK_CRC32 -DHAVE_CHECK_CRC64 -DHAVE_CHECK_SHA256 -DHAVE_DECODERS -DHAVE_DECODER_ARM -DHAVE_DECODER_ARM64 -DHAVE_DECODER_ARMTHUMB -DHAVE_DECODER_DELTA -DHAVE_DECODER_IA64 -DHAVE_DECODER_LZMA1 -DHAVE_DECODER_LZMA2 -DHAVE_DECODER_POWERPC -DHAVE_DECODER_SPARC -DHAVE_DECODER_X86 -DHAVE_ENCODERS -DHAVE_ENCODER_ARM -DHAVE_ENCODER_ARM64 -DHAVE_ENCODER_ARMTHUMB -DHAVE_ENCODER_DELTA -DHAVE_ENCODER_IA64 -DHAVE_ENCODER_LZMA1 -DHAVE_ENCODER_LZMA2 -DHAVE_ENCODER_POWERPC -DHAVE_ENCODER_SPARC -DHAVE_ENCODER_X86 -DHAVE_INTTYPES_H -DHAVE_LZIP_DECODER -DHAVE_MF_BT2 -DHAVE_MF_BT3 -DHAVE_MF_BT4 -DHAVE_MF_HC3 -DHAVE_MF_HC4 -DHAVE_STDBOOL_H -DHAVE_STDINT_H -DHAVE__BOOL -DHAVE___BUILTIN_ASSUME_ALIGNED -DHAVE___BUILTIN_BSWAPXX -DLZMA_API_STATIC -DMYTHREAD_VISTA -DPACKAGE_BUGREPORT=\\\"xz@tukaani.org\\\" -DPACKAGE_NAME=\"\\\"XZ Utils\\\"\" -DPACKAGE_URL=\\\"https://tukaani.org/xz/\\\" -DTUKLIB_FAST_UNALIGNED_ACCESS -I /sources/lzma/src/common -I /sources/lzma/src/liblzma/api  /sources/lzma/src/xzdec/xzdec_w32res.rc CMakeFiles/xzdec.dir/src/xzdec/xzdec_w32res.rc.res\r\nllvm-rc: Error parsing file: Invalid token found at position 635`","reactions":{"url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/mstorsjo/llvm-mingw/issues/363/timeline","performed_via_github_app":null,"state_reason":"completed"}},"public":true,"created_at":"2023-10-04T10:47:32Z"}
