{"id":"38858955874","type":"IssuesEvent","actor":{"id":96086763,"login":"nate-thirdwave","display_login":"nate-thirdwave","gravatar_id":"","url":"https://api.github.com/users/nate-thirdwave","avatar_url":"https://avatars.githubusercontent.com/u/96086763?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"opened","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/122","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/122/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/122/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/122/events","html_url":"https://github.com/tukaani-project/xz/issues/122","id":2326151776,"node_id":"I_kwDOIQBEvs6KpkJg","number":122,"title":"tsan also needs sanitizer nerf for crc64","user":{"login":"nate-thirdwave","id":96086763,"node_id":"U_kgDOBboq6w","avatar_url":"https://avatars.githubusercontent.com/u/96086763?v=4","gravatar_id":"","url":"https://api.github.com/users/nate-thirdwave","html_url":"https://github.com/nate-thirdwave","followers_url":"https://api.github.com/users/nate-thirdwave/followers","following_url":"https://api.github.com/users/nate-thirdwave/following{/other_user}","gists_url":"https://api.github.com/users/nate-thirdwave/gists{/gist_id}","starred_url":"https://api.github.com/users/nate-thirdwave/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nate-thirdwave/subscriptions","organizations_url":"https://api.github.com/users/nate-thirdwave/orgs","repos_url":"https://api.github.com/users/nate-thirdwave/repos","events_url":"https://api.github.com/users/nate-thirdwave/events{/privacy}","received_events_url":"https://api.github.com/users/nate-thirdwave/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-05-30T17:06:42Z","updated_at":"2024-05-30T17:06:42Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"The `no_sanitize_address` nerf for crc64 also needs `no_sanitize_thread` since the tsan checker also looks for heap-use-after-free.\r\n\r\n```\r\n--- src/liblzma/check/crc64_fast.c\t2023-11-01 12:19:29.000000000 +0000\r\n+++ src/liblzma/check/crc64_fast.c-new\t2024-05-30 16:56:41.935335535 +0000\r\n@@ -209,11 +209,14 @@\r\n // The intrinsics use 16-byte-aligned reads from buf, thus they may read\r\n // up to 15 bytes before or after the buffer (depending on the alignment\r\n // of the buf argument). The values of the extra bytes are ignored.\r\n-// This unavoidably trips -fsanitize=address so address sanitizier has\r\n-// to be disabled for this function.\r\n+// This unavoidably trips -fsanitize=address and -fsanitize=thread\r\n+// so the sanitizers have to be disabled for this function.\r\n #if lzma_has_attribute(__no_sanitize_address__)\r\n __attribute__((__no_sanitize_address__))\r\n #endif\r\n+#if lzma_has_attribute(__no_sanitize_thread__)\r\n+__attribute__((__no_sanitize_thread__))\r\n+#endif\r\n static uint64_t\r\n crc64_clmul(const uint8_t *buf, size_t size, uint64_t crc)\r\n {\r\n```","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/122/timeline","performed_via_github_app":null,"state_reason":null}},"public":true,"created_at":"2024-05-30T17:06:44Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
{"id":"38859003098","type":"IssueCommentEvent","actor":{"id":96086763,"login":"nate-thirdwave","display_login":"nate-thirdwave","gravatar_id":"","url":"https://api.github.com/users/nate-thirdwave","avatar_url":"https://avatars.githubusercontent.com/u/96086763?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/122","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/122/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/122/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/122/events","html_url":"https://github.com/tukaani-project/xz/issues/122","id":2326151776,"node_id":"I_kwDOIQBEvs6KpkJg","number":122,"title":"tsan also needs sanitizer nerf for crc64","user":{"login":"nate-thirdwave","id":96086763,"node_id":"U_kgDOBboq6w","avatar_url":"https://avatars.githubusercontent.com/u/96086763?v=4","gravatar_id":"","url":"https://api.github.com/users/nate-thirdwave","html_url":"https://github.com/nate-thirdwave","followers_url":"https://api.github.com/users/nate-thirdwave/followers","following_url":"https://api.github.com/users/nate-thirdwave/following{/other_user}","gists_url":"https://api.github.com/users/nate-thirdwave/gists{/gist_id}","starred_url":"https://api.github.com/users/nate-thirdwave/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nate-thirdwave/subscriptions","organizations_url":"https://api.github.com/users/nate-thirdwave/orgs","repos_url":"https://api.github.com/users/nate-thirdwave/repos","events_url":"https://api.github.com/users/nate-thirdwave/events{/privacy}","received_events_url":"https://api.github.com/users/nate-thirdwave/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-05-30T17:06:42Z","updated_at":"2024-05-30T17:08:30Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"The `no_sanitize_address` nerf for crc64 also needs `no_sanitize_thread` since the tsan checker also looks for heap-use-after-free.\r\n\r\n```\r\n--- src/liblzma/check/crc64_fast.c\t2023-11-01 12:19:29.000000000 +0000\r\n+++ src/liblzma/check/crc64_fast.c-new\t2024-05-30 16:56:41.935335535 +0000\r\n@@ -209,11 +209,14 @@\r\n // The intrinsics use 16-byte-aligned reads from buf, thus they may read\r\n // up to 15 bytes before or after the buffer (depending on the alignment\r\n // of the buf argument). The values of the extra bytes are ignored.\r\n-// This unavoidably trips -fsanitize=address so address sanitizier has\r\n-// to be disabled for this function.\r\n+// This unavoidably trips -fsanitize=address and -fsanitize=thread\r\n+// so the sanitizers have to be disabled for this function.\r\n #if lzma_has_attribute(__no_sanitize_address__)\r\n __attribute__((__no_sanitize_address__))\r\n #endif\r\n+#if lzma_has_attribute(__no_sanitize_thread__)\r\n+__attribute__((__no_sanitize_thread__))\r\n+#endif\r\n static uint64_t\r\n crc64_clmul(const uint8_t *buf, size_t size, uint64_t crc)\r\n {\r\n```","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/122/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/2140304065","html_url":"https://github.com/tukaani-project/xz/issues/122#issuecomment-2140304065","issue_url":"https://api.github.com/repos/tukaani-project/xz/issues/122","id":2140304065,"node_id":"IC_kwDOIQBEvs5_knLB","user":{"login":"nate-thirdwave","id":96086763,"node_id":"U_kgDOBboq6w","avatar_url":"https://avatars.githubusercontent.com/u/96086763?v=4","gravatar_id":"","url":"https://api.github.com/users/nate-thirdwave","html_url":"https://github.com/nate-thirdwave","followers_url":"https://api.github.com/users/nate-thirdwave/followers","following_url":"https://api.github.com/users/nate-thirdwave/following{/other_user}","gists_url":"https://api.github.com/users/nate-thirdwave/gists{/gist_id}","starred_url":"https://api.github.com/users/nate-thirdwave/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nate-thirdwave/subscriptions","organizations_url":"https://api.github.com/users/nate-thirdwave/orgs","repos_url":"https://api.github.com/users/nate-thirdwave/repos","events_url":"https://api.github.com/users/nate-thirdwave/events{/privacy}","received_events_url":"https://api.github.com/users/nate-thirdwave/received_events","type":"User","site_admin":false},"created_at":"2024-05-30T17:08:30Z","updated_at":"2024-05-30T17:08:30Z","author_association":"NONE","body":"Observing a tsan fault depends on the state of your heap (some other previously free'd memory block needs to be in the vestigial space before or after the buffer)","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/2140304065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-05-30T17:08:31Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
