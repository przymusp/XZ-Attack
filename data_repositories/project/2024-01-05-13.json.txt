{"id":"34600111904","type":"IssueCommentEvent","actor":{"id":78042786,"login":"JiaT75","display_login":"JiaT75","gravatar_id":"","url":"https://api.github.com/users/JiaT75","avatar_url":"https://avatars.githubusercontent.com/u/78042786?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/76","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/76/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/76/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/76/events","html_url":"https://github.com/tukaani-project/xz/issues/76","id":2067065110,"node_id":"I_kwDOIQBEvs57NOkW","number":76,"title":"[Bug]: --disable-assembler broken since v5.2.12","user":{"login":"nika-begiashvili","id":259598,"node_id":"MDQ6VXNlcjI1OTU5OA==","avatar_url":"https://avatars.githubusercontent.com/u/259598?v=4","gravatar_id":"","url":"https://api.github.com/users/nika-begiashvili","html_url":"https://github.com/nika-begiashvili","followers_url":"https://api.github.com/users/nika-begiashvili/followers","following_url":"https://api.github.com/users/nika-begiashvili/following{/other_user}","gists_url":"https://api.github.com/users/nika-begiashvili/gists{/gist_id}","starred_url":"https://api.github.com/users/nika-begiashvili/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nika-begiashvili/subscriptions","organizations_url":"https://api.github.com/users/nika-begiashvili/orgs","repos_url":"https://api.github.com/users/nika-begiashvili/repos","events_url":"https://api.github.com/users/nika-begiashvili/events{/privacy}","received_events_url":"https://api.github.com/users/nika-begiashvili/received_events","type":"User","site_admin":false},"labels":[{"id":4687621022,"node_id":"LA_kwDOIQBEvs8AAAABF2drng","url":"https://api.github.com/repos/tukaani-project/xz/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-01-05T10:03:45Z","updated_at":"2024-01-05T13:17:52Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Describe the bug\n\nAfter updating to v5.2.12 it seems --disable-assembler flag is not fully affecting liblzma  \r\n\r\ncompiler is not standard but for this case it can be considered as clang, also tried v5.2.11 and it's working fine so I'm guessing it must be a configuration changes between these two versions\n\n### Version\n\nv5.2.12\n\n### Operating System\n\ndocker/ubuntu:jammy\n\n### Relevant log output\n\n```shell\n22.71 make[3]: Entering directory '/opt/xz-5.2.12/src/liblzma'\r\n22.71 /bin/bash ../../libtool  --tag=CC   --mode=compile /emsdk/upstream/emscripten/emcc -DHAVE_CONFIG_H -I. -I../..  -I../../src/liblzma/api -I../../src/liblzma/common -I../../src/liblzma/check -I../../src/liblzma/lz -I../../src/liblzma/rangecoder -I../../src/liblzma/lzma -I../../src/liblzma/delta -I../../src/liblzma/simple -I../../src/common -DTUKLIB_SYMBOL_PREFIX=lzma_ -I/usr/local/include/ -I/opt/zlib-1.3 -I/opt/bzip2-1.0.8 -I/opt/openssl-1.0.2s/include -I/opt/openssl-1.0.2s/test -fvisibility=hidden -Wall -Wextra -Wvla -Wformat=2 -Winit-self -Wmissing-include-dirs -Wstrict-aliasing -Wfloat-equal -Wundef -Wshadow -Wpointer-arith -Wbad-function-cast -Wwrite-strings -Waggregate-return -Wstrict-prototypes -Wold-style-definition -Wmissing-prototypes -Wmissing-declarations -Wmissing-noreturn -Wredundant-decls -g -O2 -MT liblzma_la-common.lo -MD -MP -MF .deps/liblzma_la-common.Tpo -c -o liblzma_la-common.lo `test -f 'common/common.c' || echo './'`common/common.c\r\n22.76 libtool: compile:  /emsdk/upstream/emscripten/emcc -DHAVE_CONFIG_H -I. -I../.. -I../../src/liblzma/api -I../../src/liblzma/common -I../../src/liblzma/check -I../../src/liblzma/lz -I../../src/liblzma/rangecoder -I../../src/liblzma/lzma -I../../src/liblzma/delta -I../../src/liblzma/simple -I../../src/common -DTUKLIB_SYMBOL_PREFIX=lzma_ -I/usr/local/include/ -I/opt/zlib-1.3 -I/opt/bzip2-1.0.8 -I/opt/openssl-1.0.2s/include -I/opt/openssl-1.0.2s/test -fvisibility=hidden -Wall -Wextra -Wvla -Wformat=2 -Winit-self -Wmissing-include-dirs -Wstrict-aliasing -Wfloat-equal -Wundef -Wshadow -Wpointer-arith -Wbad-function-cast -Wwrite-strings -Waggregate-return -Wstrict-prototypes -Wold-style-definition -Wmissing-prototypes -Wmissing-declarations -Wmissing-noreturn -Wredundant-decls -g -O2 -MT liblzma_la-common.lo -MD -MP -MF .deps/liblzma_la-common.Tpo -c common/common.c  -fPIC -DPIC -o .libs/liblzma_la-common.o\r\n22.87 <inline asm>:1:1: error: unknown directive\r\n22.87     1 | .symver lzma_get_progress_522,lzma_get_progress@XZ_5.2.2\r\n22.87       | ^\r\n22.87 <inline asm>:2:1: error: unknown directive\r\n22.87     2 | .symver lzma_get_progress_52,lzma_get_progress@@XZ_5.2\r\n22.87       | ^\r\n22.89 2 errors generated.\n```\n","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/76/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/76/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/1878647289","html_url":"https://github.com/tukaani-project/xz/issues/76#issuecomment-1878647289","issue_url":"https://api.github.com/repos/tukaani-project/xz/issues/76","id":1878647289,"node_id":"IC_kwDOIQBEvs5v-eH5","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"created_at":"2024-01-05T13:17:51Z","updated_at":"2024-01-05T13:17:51Z","author_association":"MEMBER","body":"Hello!\r\n\r\nThere were no changes to any of the assembly related code between `5.2.11` and `5.2.12`. I see you are using `emscripten`, so I was able to recreate your error on both `5.2.11` and `5.2.12` using:\r\n\r\n```bash\r\nemconfigure ./configure\r\nmake\r\n```\r\n\r\n```shell\r\n<inline asm>:1:1: error: unknown directive\r\n.symver lzma_get_progress_522,lzma_get_progress@XZ_5.2.2\r\n^\r\n<inline asm>:2:1: error: unknown directive\r\n.symver lzma_get_progress_52,lzma_get_progress@@XZ_5.2\r\n^\r\n```\r\n\r\nSo the problem isn't a difference between `5.2.11` and `5.2.12`. Also, unless you are building on 32-bit x86 the `disable-assembler` flag has no effect. In order to build, you need to pass the `disable-symbol-versions` flag.\r\n\r\n```bash\r\nemconfigure ./configure --disable-symbol-versions\r\nmake\r\n```\r\n\r\nThe underlying issue here is that `emcc` (and I believe WebAssembly in general) does not support symbol versioning so it needs to be manually disabled. `emconfigure` does not change the underlying `$host_os` or `$host_cpu` so `configure` will guess that symbol versioning is supported on GNU or FreeBSD systems.\r\n","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/1878647289/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-01-05T13:17:52Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
