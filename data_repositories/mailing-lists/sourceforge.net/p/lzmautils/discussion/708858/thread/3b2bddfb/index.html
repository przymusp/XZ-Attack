<!DOCTYPE html>

<html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="content-type" />
<title>
  XZ Utils / Discussion /
  Open Discussion: multi-threading; lxz
</title>
<meta name="viewport" content="width=1100">
<link rel="icon" sizes="180x180" href="https://a.fsdn.com/con/img/sandiego/logo-180x180.png" type="image/png">
<link rel="icon" sizes="any" href="https://a.fsdn.com/con/img/sandiego/svg/originals/sf-icon-orange-no_sf.svg" type="image/svg+xml">
<link rel="apple-touch-icon" sizes="180x180" href="https://a.fsdn.com/con/img/sandiego/logo-180x180.png">
<link rel="mask-icon" href="https://a.fsdn.com/con/img/sandiego/svg/originals/sf-icon-orange-no_sf.svg" color="#FF6600">
<link rel="stylesheet" href="https://a.fsdn.com/con/css/lato.css?">
<script>
if (!window.SF) { window.SF = {}; }
SF.sandiego = false;
SF.sandiego_chrome = true;
SF.cdn = "https://a.fsdn.com/con";
SF.fpid = '49274a03-34cc-42cc-b6f5-2520776e440f';
</script>

<link rel="stylesheet" type="text/css" href="https://a.fsdn.com/allura/nf/1720797364/_ew_/_slim/css?href=allura%2Fcss%2Fforge%2Fhilite.css%3Ballura%2Fcss%2Fforge%2Ftooltipster.css">
<link rel="stylesheet" type="text/css" href="https://a.fsdn.com/allura/nf/1720797364/_ew_/allura/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="https://a.fsdn.com/allura/nf/1720797364/_ew_/theme/sftheme/css/forge.css">
<link rel="stylesheet" type="text/css" href="https://a.fsdn.com/allura/nf/1720797364/_ew_/_slim/css?href=css%2Fpage_list.css%3Bcss%2Fjquery.tagsinput.css">
<link rel="stylesheet" type="text/css" href="https://a.fsdn.com/allura/nf/1720797364/_ew_/css/easymde.min.css">
<link rel="stylesheet" type="text/css" href="https://a.fsdn.com/allura/nf/1720797364/_ew_/_slim/css?href=css%2Fmarkitup_sf.css%3Bcss%2Fshow-hint.css">
<style>
        div.moderate {
            color:grey;
        }
        </style>
<link rel="stylesheet" type="text/css" href="https://a.fsdn.com/allura/nf/1720797364/_ew_/theme/sftheme/css/sftheme/sandiego/cmp.css">


<script type="text/javascript" src="https://a.fsdn.com/allura/nf/1720797364/_ew_/_slim/js?href=allura%2Fjs%2Fjquery-3.6.0.min.js%3Ballura%2Fjs%2Fjquery.cookie-1.4.1.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fcmp2.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fshared_head.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Ftypescript%2Fcompliance.js"></script>

<style type="text/css">
            /* make URL &amp; Project custom fields in support tickets not get hidden as much */
.project-forge.mountpoint-site-support .view_holder .grid-4:nth-child(5),
.project-forge.mountpoint-site-support .view_holder .grid-4:nth-child(6) {
  overflow: visible;
  font-size: 22px;
  width: 340px;
  line-height: 1;
  margin-bottom: 5px;
}
.project-forge.mountpoint-site-support .view_holder .grid-4:nth-child(5) label, .project-forge.mountpoint-site-support .view_holder .grid-4:nth-child(6) label {
  font-size: 14px;
}
        </style>
<style>.XwrFawrAZljCmyXCjKxwolwpfDoTDClOBZwwZ {
        display: none
    }</style>
<link rel="canonical" href="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/" />
<script>
        window.bizx.cmp.init({
            gam_gdpr_technical_delivery: true,
        });
    </script>
<script>
    function initPiwik(){
      var _paq = window._paq = window._paq || [];
      _paq.push(['trackPageView', document.title, {
            dimension1: 'lzmautils',
            dimension2: 'discussion'
      }]);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//analytics.slashdotmedia.com/";
        _paq.push(['setTrackerUrl', u+'sf.php']);
        _paq.push(['setSiteId', 39]);
        
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'sf.js'; s.parentNode.insertBefore(g,s);
      })();
    }
    bizx.cmp.ifConsent({ purposes: ['storage', 'measurement'], vendors: 'sdm'}, initPiwik);
</script>
</head>
<body class="
body_class sandiego_chrome  legacy_chrome 
" id="forge">

<script type="text/javascript" src="https://a.fsdn.com/allura/nf/1720797364/_ew_/_slim/js?href=allura%2Fjs%2Fjquery-ui-1.13.2.min.js"></script>

<div class="off-canvas position-right" id="offCanvas" data-off-canvas>

<ul class="header-nav-menulist">
<li class="highlight search">
<form method="get" action="/directory/" class="m-search-form">
<input type="text" placeholder="Search for software or solutions" autocomplete="off" name="q">
<label>
<input type="submit" class="bt" value>
<svg data-name="search" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z" /></svg>
</label>
</form>
</li>
<li class="highlight"><a href="/auth/">Join/Login</a></li>
<li><a href="/directory/">Open Source Software</a></li>
<li><a href="/software/">Business Software</a></li>
<li><a href="/software/vendors/" title="For Vendors">For Vendors</a></li>
<li><a href="/blog/" title="Blog">Blog</a></li>
<li><a href="/about">About</a></li>
<li><a id="header-nav-more" data-toggle="header-nav-more header-nav-more-content" data-toggler=".toggled">More</a></li>
<li>
<ul id="header-nav-more-content" class="toggled" data-toggler=".toggled">
<li><a href="/articles/">Articles</a></li>
<li><a href="/create">Create</a></li>
<li><a href="/learn/">Learn</a></li>
<li><a href="https://sourceforge.net/articles/category/sourceforge-podcast/">SourceForge Podcast</a></li>
<li><a href="https://sourceforge.net/p/forge/documentation/Docs%20Home/">Site Documentation</a></li>
<li><a href="/user/newsletters">Subscribe to our Newsletter</a></li>
<li><a href="/support">Support Request</a></li>
</ul>
</li>
</ul>
</div>
<div class="off-canvas-content" data-off-canvas-content>
<script>
    SF.linkout_icon = '<svg  data-name="sf-linkout-icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 300" style="enable-background:new 0 0 300 300;" xml:space="preserve"><polygon class="st0" points="243.2,243.2 56.8,243.2 56.8,56.8 123,56.8 123,9 9,9 9,291 291,291 291,179.4 243.2,179 "/><polygon class="st0" points="128.5,213 155,186.5 176,165.5 206.7,196.3 235.5,132.5 248.9,102.6 290.6,9.8 291,9 290.6,9.2 197.4,51.1 169.1,63.8 103.7,93.3 137,126.5 115.9,147.5 89.5,174 "/></svg>';
</script>
<div class="l-header-nav  sandiego">
<section class="sandiego l-header-nav-top show-for-large">
<div class="row">
<a href="/" title="Home" class="sf-logo">
<img src="https://a.fsdn.com/con/images/sandiego/sf-logo-full.svg" alt="SourceForge logo" class="sf-logo-full" />
</a>
<nav class="links">
<a href="/software/vendors/" title="For Vendors">For Vendors</a>
<a href="/support" title="Help">Help</a>
<a href="/create/" title="Create">Create</a>
<a href="/user/registration" title="Join">Join</a>
<a href="/auth/" title="Login">Login</a>
</nav>
</div>
</section>
<section class="sandiego l-header-nav-top hide-for-large">
<div class="row">
<a href="/" title="Home" class="sf-logo">
<img src="https://a.fsdn.com/con/images/sandiego/sf-logo-full.svg" alt="SourceForge logo" class="sf-logo-full" />
</a>
<div class="title-bar-right">
<button type="button" class="menu-icon" data-toggle="offCanvas"></button>
</div>
</div>
</section>
<section class="sandiego l-header-nav-bottom">
<nav class="row">
<a href="/" title="Home" class="sf-logo">
<img src="https://a.fsdn.com/con/images/sandiego/sf-logo-full.svg" alt="SourceForge logo" class="sf-logo-full" />
</a>
<div class="links">
<div class="nav-dropdown">
<a href="/directory/" title="Browse">Open Source Software</a>
</div>
<div class="nav-dropdown">
<a href="/software/">Business Software</a>
</div>
<div class="nav-dropdown">
<a>Resources</a>
<ul class="nav-dropdown-menu">
<li><a href="/articles/">Articles</a></li>
<li><a href="/software/case-studies/">Case Studies</a></li>
<li><a href="/learn/">Learn</a></li>
<li><a href="/blog/">Blog</a></li>
<li><a href="https://sourceforge.net/articles/category/sourceforge-podcast/">SourceForge Podcast</a></li>
</ul>
</div>
<div class="dev-menu-when-stuck">
Menu
<ul class="dev-menu-dropdown header-nav-menulist">
<li><a href="/support">Help</a></li>
<li><a href="/create">Create</a></li>
<li><a href="/user/registration/" title="Join">Join</a></li>
<li><a href="/auth/" title="Login">Login</a></li>
</ul>
</div>
<div class="search-toggle-when-stuck">
<a class="search-toggle">
<svg data-name="search" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z" /></svg>
</a>
</div>
</div>
<div class="search">
<div class="main-nav-button">
<a href="/p/import_project/github/" rel="nofollow" title="Sync your Github project to SourceForge" id="github-link">
<img src="https://a.fsdn.com/con/images/sandiego/github-sync.png" srcset="https://a.fsdn.com/con/images/sandiego/github-sync_2x.png 2x" alt="GitHub sync" id="main-nav-badge" />
</a>
</div>
<form method="get" action="/directory/" class="m-search-form">
<div class="typeahead__container">
<div class="typeahead__field">
<div class="typeahead__query">
<input type="text" placeholder="Search for software or solutions" autocomplete="off" name="q">
</div>
<label>
<input type="submit" class="bt" value>
<svg data-name="search" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z" /></svg>
</label>
</div>
</div>
</form>
</div>
</nav>
</section>
</div>
<div class="notification-on-project-page">
</div>
<section id="page-body" class=" neighborhood-Projects project-lzmautils mountpoint-discussion 

">
<div id="nav_menu_holder">
<div class="sandiego">
<section class="project-masthead">
<div class="backdrop" style="box-sizing: content-box; padding-bottom: 24px"></div>
<div class="content">
<nav id="breadcrumbs" class="breadcrumbs rtl">
<ul itemscope itemtype="http://schema.org/BreadcrumbList">
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="/"><span itemprop="name">Home</span></a>
<meta itemprop="position" content="1" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="/directory/"><span itemprop="name">Browse</span></a>
<meta itemprop="position" content="2" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<a itemprop="item" href="/p/lzmautils/"><span itemprop="name">XZ Utils</span></a>
<meta itemprop="position" content="3" />
</li>
<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
<span itemprop="name">Discussion</span>
<meta itemprop="position" content="4" />
</li>
</ul>
</nav>
<div class="overview">
<div class="project-icon  default-project-icon ">
<svg data-name="default-icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 300 300" style="enable-background:new 0 0 300 300;" xml:space="preserve"><rect class="st0" width="300" height="300" /><g><path class="st1" d="M162.5,154.8c0-28.9-10.2-42-15.6-46.9c-1.1-1-2.7-0.1-2.6,1.3c1.1,16.3-19.4,20.3-19.4,45.9h0c0,0.1,0,0.1,0,0.2c0,15.6,11.8,28.3,26.3,28.3c14.5,0,26.3-12.7,26.3-28.3c0-0.1,0-0.1,0-0.2h0c0-7.2-2.7-14.1-5.5-19.3c-0.5-1-2.1-0.6-1.9,0.3C174.9,158.1,162.5,171.8,162.5,154.8z" /><g><path class="st1" d="M131.2,215.6c-0.7,0-1.3-0.3-1.8-0.7l-67.2-67.1c-1-1-1-2.6,0-3.6l70.9-70.9c0.5-0.5,1.1-0.7,1.8-0.7h20.4c1.2,0,2,0.8,2.3,1.6c0.3,0.7,0.3,1.9-0.5,2.7l-66.7,66.7c-1.3,1.3-1.3,3.5,0,4.9l52.7,52.7c1,1,1,2.6,0,3.6L133,214.9C132.5,215.4,131.9,215.6,131.2,215.6z" /></g><g><path class="st1" d="M144.7,227.4c-1.2,0-2-0.8-2.3-1.5c-0.3-0.7-0.3-1.9,0.5-2.7l66.7-66.7c0.7-0.6,1-1.5,1-2.4s-0.4-1.8-1-2.4l-52.7-52.7c-1-1-1-2.6,0-3.6l10.2-10.2c0.5-0.5,1.1-0.7,1.8-0.7c0.7,0,1.3,0.3,1.8,0.7l67,67.1c0.5,0.5,0.7,1.1,0.7,1.8s-0.3,1.3-0.7,1.8l-70.9,70.9c-0.5,0.5-1.1,0.7-1.8,0.7H144.7z" /></g></g></svg>
</div>
<div class="title ">
<meta itemprop="name" content="XZ Utils" />
<h1>multi-threading; lxz
</h1>
<div class="as-h3 brought-by">
Brought to you by:
<a href="/u/larhzu/profile/">larhzu</a>
</div>
</div>
</div>
</div>
</section>
</div>
</div>
<div id="top_nav" class>
<div id="top_nav_admin">
<ul class="dropdown">
<li class>
<a href="/projects/lzmautils/" class="tool-summary-32">
Summary
</a>
</li>
<li class>
<a href="/projects/lzmautils/files/" class="tool-files-sf-32">
Files
</a>
</li>
<li class>
<a href="/projects/lzmautils/reviews/" class="tool-reviews-32">
Reviews
</a>
</li>
<li class>
<a href="/projects/lzmautils/support" class="tool-support-32">
Support
</a>
</li>
<li class>
<a href="/p/lzmautils/wiki/" class="tool-wiki-32">
Wiki
</a>
</li>
<li class>
<a href="/p/lzmautils/news/" class="tool-blog-32">
News
</a>
</li>
<li class="selected">
<a href="/p/lzmautils/discussion/" class="tool-discussion-32">
Discussion
</a>
</li>
</ul>
</div>
</div>
<div id="content_base">
<a id="sidebar-activate" href="#">
<span class="btn-label">Menu</span>
<span class="btn-arrow-down">▾</span>
<span class="btn-arrow-up">▴</span>
</a>
<div id="sidebar">
<form id="search" method="GET" action="/p/lzmautils/discussion/search/">
<input name="q" type="text" title="Search Discussion" placeholder="Search Discussion">
<label>
<input type="submit" style="display:none">
<b class="fa fa-search" title="Submit"></b>
</label>
</form>
<ul class="sidebarmenu">
<li>
<a class="icon" href="/p/lzmautils/discussion/create_topic/708858" title="Add"><i class="fa fa-plus-circle"></i>
<span>Create Topic</span>
</a>
</li>
<li>
<a class="icon" href="/p/lzmautils/discussion/stats" title="Stats"><i class="fa fa-line-chart"></i>
<span>Stats Graph</span>
</a>
</li>
</ul>
<h3 class>Forums</h3>
<ul class="sidebarmenu">
<li>
<a href="/p/lzmautils/discussion/708858/">
<span class="has_small">Open Discussion</span>
<small>163</small></a>
</li>
</ul>
<h3 class>Help</h3>
<ul class="sidebarmenu">
<li>
<a href="/nf/markdown_syntax" target="_blank">
<span>Formatting Help</span>
</a>
</li>
</ul>
</div>
<script>
$('#sidebar-admin-header').on('click', function(e){
    $("#sidebar-admin-menu").toggleClass("hidden");
    $(this).toggleClass("expanded");
    e.preventDefault();
});
</script>
<div class="grid-20 pad">
<h2 class="dark title">
<span>multi-threading; lxz</span>

<small>
<a class="icon thread_feed0" href="feed.rss" rel="nofollow" title="Follow This"><i class="fa fa-rss"></i></a>
<div id="subscription-form" style="display: inline;"></div>
<script>
  document.SUBSCRIPTION_OPTIONS = {
    "thing": "topic",
    "subscribed": false,
    "url": "subscribe",
    "icon": {
      "css": "fa fa-envelope-o"
    }
  };
</script>
</small>

</h2>
<div class="editbox">
<div class="grid-5"><label>Forum:</label> <a href="/p/lzmautils/discussion/708858/">Open Discussion</a></div>
<div class="grid-5"><label>Creator:</label>
<a href="/u/lacos-hu/profile/" class="user-mention">
Laszlo Ersek
</a>
</div>
<div class="grid-4"><label>Created:</label>
<span title="Thu Dec 16, 2010 11:28 AM UTC">
2010-12-16
</span>
</div>
<div class="grid-5"><label>Updated:</label>
<span title="Thu May 30, 2013 04:55 PM UTC">
2013-05-30
</span>
</div>
</div>
<div>
<div>
<div class="comment-row">
<div id="comment">
<ul>

<li>
<div>
<div id="1268" class="discussion-post">
<div class="comment-row">
<div class="grid-2 tcenter gravatar">
<p class="gravatar">
<img src="https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png" alt="Laszlo Ersek" title="Laszlo Ersek" class="emboss x48">
</p>
</div>
<div class="grid-16 post-content bubble" style="width: 652px;  ">
<div class="header">
<a href="/u/lacos-hu/profile/" class="user-mention">
Laszlo Ersek
</a>
- <i style="color: #777">
<span title="Thu Dec 16, 2010 11:28 AM UTC">
2010-12-16
</span>
</i>
<div class="tools">
<a href="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#1268" title="Link" class="little_link shortlink icon btn ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
<span><i class="fa fa-link" aria-hidden="true"></i></span></a>
</div>
</div>
<div class="display_post">
<div><div class="markdown_content"><p>Hi, </p>
<p>I wrote lbzip2. (See <a href="http://lacos.hu" rel="nofollow">http://lacos.hu</a>.)I intend to fork lbzip2-0.23 into "lxz-0.01", remove the decompression functionality and replace the bzip2 compression with xz compression. </p>
<p>(I did something like that before with lzlib (a different LZMA implementation by Antonio Diaz Diaz); that program is available now as plzip (it is maintained by him). Now I feel like doing a similar fork with liblzma.) </p>
<p>I've been browsing the xz-format documentation and the header files, and I think I should be able to do this. I don't intend to maintain it very actively, and if you were interested I'd pass maintenance over to you as soon as I get a working version. Obviously this is only for the interim time while you don't finish your xz-native multi-threading; I'm not sure about how far ahead you are with that. I do know about the "pxz" utility, but I find its architecture and disk access pattern less than optimal (though those seeks shouldn't matter too much considering how CPU hungry liblzma is). Anyway I don't necessarily plan to do it for the public benefit; I mainly plan to do it because xz is wide-spread and I myself want to be able to create conformant xz files, from pipe to pipe, with MT. I consider lbzip2 to have all the necessary fluff in place (well, at least for my needs). </p>
<p>So, some technical questions: </p>
<p>(A) for the trivial input splitting lbzip2 does in compression mode, I need to know the following two-valued function. For each compression preset P in , what is (a) the optimal input chunk size (that will be compressed in a single shot), and (b) what is the <em>worst</em> compression ratio that liblzma can produce? I need (b) because I preallocate the output block (which will be a complete xz file in itself), and I need to know its maximum size in advance, based on preset P. </p>
<p>I don't intend to support the "extreme" flag. The CRC would be fixed to CRC64. The single-block multi-stream format should not be much of a problem with Backward Size present in the stream footer; the Backward Size fields (combined with the Indices) allow one to seek over a multi-stream regular file backward. </p>
<p>(B) The API pattern I intend to use is for each single-shot compression, once input and output space is allocated:<br/>
- initialize stream structure (on stack),<br/>
- </p>
<div class="codehilite"><pre><span></span>lzma_easy_encoder(preset)
</pre></div>
<p>,<br/>
- </p>
<div class="codehilite"><pre><span></span>lzma_code(&amp;strm, LZMA_FINISH)
</pre></div>
<p>,<br/>
- assert </p>
<div class="codehilite"><pre><span></span>LZMA_STREAM_END
</pre></div>
<p>is returned,<br/>
- </p>
<div class="codehilite"><pre><span></span>lzma_end(&amp;strm)
</pre></div>
<p>. </p>
<p>Is there some API-level optimization that I can apply here, like not using the heaviest-weight API calls? For example, it seems like I can delay the </p>
<div class="codehilite"><pre><span></span>lzma_end()
</pre></div>
<p>call until thread destruction time, and use a long-lived stream object throughout the lifetime of any given thread. </p>
<p>Another thing I consider is </p>
<div class="codehilite"><pre><span></span>LZMA_FULL_FLUSH
</pre></div>
<p>instead of </p>
<div class="codehilite"><pre><span></span>LZMA_FINISH
</pre></div>
<p>, but I suspect that would be wrong. The blocks emitted by </p>
<div class="codehilite"><pre><span></span>LZMA_FULL_FLUSH
</pre></div>
<p>must apparently use the same stream object, and on the file level, be part of the same stream and index. However,<br/>
- blocks produced by multiple worker threads will be interleaved in the output,<br/>
- I would have to extract a single stream header and index and stream footer,<br/>
- I would possibly have to share access to the same stream object (which would entirely defeat the purpose of multi-threading), </p>
<p>so I guess </p>
<div class="codehilite"><pre><span></span>LZMA_FINISH
</pre></div>
<p>is the only action I can use in my existing "framework". (Not that it torments me or anything.) </p>
<p>Thus could you please describe the preset -&gt; (optimal input chunk, worst compressed size) mapping described in (A), and could you please review the API pattern in (B) wrt. sanity? </p>
<p>Thank you very much for you help in advance.<br/>
lacos (Laszlo Ersek)</p></div></div>&nbsp;
<div class="reactions" style="user-select: none; cursor: default">
</div>
</div>
</div>
<div class="shortlink_popup modal" style="display: none">
<a class="icon close" href="#" title="Close"><i class="fa fa-close"></i></a>
<div>If you would like to refer to this comment somewhere else in this project, copy and paste the following link:</div>
<input type="text" style="width:100%;" value="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#1268">
</div>
</div>
<ul>
<li>
</li>
</ul>
</div>
</div>
<script>
$('.attachment_toolbar #remove-attachment').on('click', function(e){
    $(this).closest('form').submit();
})
</script>

<ul>
</ul>

</li>

</ul>
<ul>

<li>
<div>
<div id="00e8" class="discussion-post">
<div class="comment-row">
<div class="grid-2 tcenter gravatar">
<p class="gravatar">
<img src="https://a.fsdn.com/allura/u/ipavlov/user_icon?1434850831" alt="Igor Pavlov" title="Igor Pavlov" class="emboss x48">
</p>
</div>
<div class="grid-16 post-content bubble" style="width: 652px;  ">
<div class="header">
<a href="/u/ipavlov/profile/" class="user-mention">
Igor Pavlov
</a>
- <i style="color: #777">
<span title="Thu Dec 16, 2010 02:40 PM UTC">
2010-12-16
</span>
</i>
<div class="tools">
<a href="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#00e8" title="Link" class="little_link shortlink icon btn ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
<span><i class="fa fa-link" aria-hidden="true"></i></span></a>
</div>
</div>
<div class="display_post">
<div><div class="markdown_content"><p>Did you check p7zip?<br/>
It supports multithreading xz creating. </p></div></div>&nbsp;
<div class="reactions" style="user-select: none; cursor: default">
</div>
</div>
</div>
<div class="shortlink_popup modal" style="display: none">
<a class="icon close" href="#" title="Close"><i class="fa fa-close"></i></a>
<div>If you would like to refer to this comment somewhere else in this project, copy and paste the following link:</div>
<input type="text" style="width:100%;" value="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#00e8">
</div>
</div>
<ul>
<li>
</li>
</ul>
</div>
</div>
<script>
$('.attachment_toolbar #remove-attachment').on('click', function(e){
    $(this).closest('form').submit();
})
</script>

<ul>
</ul>

</li>

</ul>
<ul>

<li>
<div>
<div id="f8bd" class="discussion-post">
<div class="comment-row">
<div class="grid-2 tcenter gravatar">
<p class="gravatar">
<img src="https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png" alt="Laszlo Ersek" title="Laszlo Ersek" class="emboss x48">
</p>
</div>
<div class="grid-16 post-content bubble" style="width: 652px;  ">
<div class="header">
<a href="/u/lacos-hu/profile/" class="user-mention">
Laszlo Ersek
</a>
- <i style="color: #777">
<span title="Fri Dec 17, 2010 10:04 AM UTC">
2010-12-17
</span>
</i>
<div class="tools">
<a href="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#f8bd" title="Link" class="little_link shortlink icon btn ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
<span><i class="fa fa-link" aria-hidden="true"></i></span></a>
</div>
</div>
<div class="display_post">
<div><div class="markdown_content"><p>Hi Igor, </p>
<p>yes, thanks, I do know about p7zip. While it is a great program functionality-wise, it doesn't fit very well in a POSIX environment; according to my taste anyway. For example, its command line doesn't follow the <a class href="http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html" rel="nofollow">Utility Syntax Guidelines</a>. Or if you stop the compression with ^C / SIGINT, the exit status is 255, not 130. I suppose there's a reason why the "plzip", "lzip", "lzma", and "xz" tools were created, and why users ask for MT in "xz", and why Lasse Collin considers adding MT to xz. </p>
<p>I mean no disrespect. p7zip is a great port of a great windows command line program; but for me, in the functionality area it can do much more than I need, and in the interface area, a bit less. Thank you for unleashing the LZMA SDK on the world :) </p>
<p>So… could you please answer my questions in the topic starter? :) Thanks!</p></div></div>&nbsp;
<div class="reactions" style="user-select: none; cursor: default">
</div>
</div>
</div>
<div class="shortlink_popup modal" style="display: none">
<a class="icon close" href="#" title="Close"><i class="fa fa-close"></i></a>
<div>If you would like to refer to this comment somewhere else in this project, copy and paste the following link:</div>
<input type="text" style="width:100%;" value="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#f8bd">
</div>
</div>
<ul>
<li>
</li>
</ul>
</div>
</div>
<script>
$('.attachment_toolbar #remove-attachment').on('click', function(e){
    $(this).closest('form').submit();
})
</script>

<ul>
</ul>

</li>

</ul>
<ul>

<li>
<div>
<div id="a76c" class="discussion-post">
<div class="comment-row">
<div class="grid-2 tcenter gravatar">
<p class="gravatar">
<img src="https://a.fsdn.com/allura/u/ipavlov/user_icon?1434850831" alt="Igor Pavlov" title="Igor Pavlov" class="emboss x48">
</p>
</div>
<div class="grid-16 post-content bubble" style="width: 652px;  ">
<div class="header">
<a href="/u/ipavlov/profile/" class="user-mention">
Igor Pavlov
</a>
- <i style="color: #777">
<span title="Fri Dec 17, 2010 10:39 AM UTC">
2010-12-17
</span>
</i>
<div class="tools">
<a href="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#a76c" title="Link" class="little_link shortlink icon btn ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
<span><i class="fa fa-link" aria-hidden="true"></i></span></a>
</div>
</div>
<div class="display_post">
<div><div class="markdown_content"><p>You wrote:<br/>
"I mainly plan to do it because xz is wide-spread and I myself want to be able to create conformant xz files, from pipe to pipe, with MT." </p>
<p>Does p7zip do it?<br/>
Of yes, what problem? </p>
<p>- I suppose there's a reason why the "plzip", "lzip", "lzma", and "xz" tools were created, and why users ask for MT in "xz". </p>
<p>Most users don't know that p7zip already supports multithreading xz and multithreading bzip2. </p>
<p>XZ Utils is good for two things:<br/>
1) It's alternative code to 7-Zip's code . So it can be simpler to find any errors of one of these versions.<br/>
2) XZ Utils works in linux world mostly. So It can provide better integration in low level code like kernel or SquashFS code. </p>
<p>But usual linux user can use p7zip also as I suppose. </p></div></div>&nbsp;
<div class="reactions" style="user-select: none; cursor: default">
</div>
</div>
</div>
<div class="shortlink_popup modal" style="display: none">
<a class="icon close" href="#" title="Close"><i class="fa fa-close"></i></a>
<div>If you would like to refer to this comment somewhere else in this project, copy and paste the following link:</div>
<input type="text" style="width:100%;" value="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#a76c">
</div>
</div>
<ul>
<li>
</li>
</ul>
</div>
</div>
<script>
$('.attachment_toolbar #remove-attachment').on('click', function(e){
    $(this).closest('form').submit();
})
</script>

<ul>
</ul>

</li>

</ul>
<ul>

<li>
<div>
<div id="f8f8" class="discussion-post">
<div class="comment-row">
<div class="grid-2 tcenter gravatar">
<p class="gravatar">
<img src="https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png" alt="Lasse Collin" title="Lasse Collin" class="emboss x48">
</p>
</div>
<div class="grid-16 post-content bubble" style="width: 652px;  ">
<div class="header">
<a href="/u/larhzu/profile/" class="user-mention">
Lasse Collin
</a>
- <i style="color: #777">
<span title="Fri Dec 17, 2010 08:06 PM UTC">
2010-12-17
</span>
</i>
<div class="tools">
<a href="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#f8f8" title="Link" class="little_link shortlink icon btn ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
<span><i class="fa fa-link" aria-hidden="true"></i></span></a>
</div>
</div>
<div class="display_post">
<div><div class="markdown_content"><p>ipavlov's suggestion to use p7zip is the easiest option for now: </p>
<p>cmd1 … | 7z a -txz -si -so /dev/null | cmd2 … &gt; foo.xz </p>
<p>Make that a script so you can use it easily in a pipe. It uses match finder threading and parallel compression of blocks inside the LZMA2 stream. It creates a single .xz Stream with a single Block. </p>
<p>If you want to create your own tool using liblzma, here are answers to your questions: </p>
<p>I suggest 2-4 times the dictionary size for the input buffer size. A sane value is at least equal to the dictionary size (the last chunk of the file is an exception). Look for "DictSize" on the xz man page to see the dictionary sizes associated with the compression levels. 0 uses 256 KiB and 9 uses 64 MiB, so for 0 you could use 512-1024 KiB input buffer and for 9 128-256 MiB. Note that 7-Zip/p7zip use slightly different presets. </p>
<p>The worst compression ratio for lzma_easy_buffer_encode() can be calculated with lzma_stream_buffer_bound(). If you use multi-call mode i.e. lzma_easy_encoder() and lzma_code(), lzma_stream_buffer_bound() doesn't work. If you use only LZMA2 in the .xz stream, the following should be enough (in reality you don't need even that much but I'll keep this simple): </p>
<p>out_buffer_size = uncompressed_size + (uncompressed_size &gt;&gt; 12) + 128 </p>
<p>Creating many .xz Streams isn't too bad although it isn't that hard to create multiple Blocks in a single Stream. Multiple Streams is quicker to code though. If there are hundreds of Streams, there will be hundreds of seeks to read all the Index fields, which can be slow. Currently this matters mostly for "xz -list". Another use case is random-access reading support but that isn't used by anything yet, I think. </p>
<p>Your API usage looks good. Delaying lzma_end() is good. That way you avoid reallocating memory and thus might avoid many page faults. Using lzma_easy_buffer_encode() would be simpler API to use, but it reallocates the memory for every call. </p>
<p>LZMA_FULL_FLUSH isn't useful for this at all. If you want to create a single Stream, you need to create Stream Header, Blocks, Index, and Stream Footer separately. It's not much code, but since I don't yet have any good example programs about how to do it, learning the API could take some time. </p>
<p>Have you seen this: </p>
<p><a href="http://tukaani.org/xz/lzma2-openmp.c" rel="nofollow">http://tukaani.org/xz/lzma2-openmp.c</a> </p>
<p>It compresses chunks in parallel with only a tiny effect on the compression ratio. It uses the preset dictionary feature in liblzma and the ability to fairly easily concatenate certain types of LZMA2 streams (it cannot be done with plain LZMA without extending the stream format). </p>
<p>This demo code doesn't give the very best speed though. The problem is that different chunks take different amount of time to compress. There are as many input/output buffer pairs as there are threads. It's not uncommon that some threads will idle waiting for their turn to write the compressed data to stdout. There should be more buffers than there are threads. Memory usage could be reduced by using unused memory from already finished chunks.</p></div></div>&nbsp;
<div class="reactions" style="user-select: none; cursor: default">
</div>
</div>
</div>
<div class="shortlink_popup modal" style="display: none">
<a class="icon close" href="#" title="Close"><i class="fa fa-close"></i></a>
<div>If you would like to refer to this comment somewhere else in this project, copy and paste the following link:</div>
<input type="text" style="width:100%;" value="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#f8f8">
</div>
</div>
<ul>
<li>
</li>
</ul>
</div>
</div>
<script>
$('.attachment_toolbar #remove-attachment').on('click', function(e){
    $(this).closest('form').submit();
})
</script>

<ul>
</ul>

</li>

</ul>
<ul>

<li>
<div>
<div id="654b" class="discussion-post">
<div class="comment-row">
<div class="grid-2 tcenter gravatar">
<p class="gravatar">
<img src="https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png" alt="Laszlo Ersek" title="Laszlo Ersek" class="emboss x48">
</p>
</div>
<div class="grid-16 post-content bubble" style="width: 652px;  ">
<div class="header">
<a href="/u/lacos-hu/profile/" class="user-mention">
Laszlo Ersek
</a>
- <i style="color: #777">
<span title="Sat Dec 18, 2010 12:37 AM UTC">
2010-12-18
</span>
</i>
<div class="tools">
<a href="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#654b" title="Link" class="little_link shortlink icon btn ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
<span><i class="fa fa-link" aria-hidden="true"></i></span></a>
</div>
</div>
<div class="display_post">
<div><div class="markdown_content"><blockquote>
<p>ipavlov's suggestion to use p7zip is the easiest option for now: </p>
</blockquote>
<p>cmd1 … | 7z a -txz -si -so /dev/null | cmd2 … &gt; foo.xz</p>
<p>Agreed, "7z a -txz -mmt=4 -si -so /dev/null" works well as a filter. </p>
<blockquote>
<p>If you want to create your own tool using liblzma, here are answers to your questions:</p>
</blockquote>
<p>Thanks a lot for taking the time to respond! </p>
<blockquote>
<p>The worst compression ratio for lzma_easy_buffer_encode() can be calculated with lzma_stream_buffer_bound()</p>
</blockquote>
<p>I'm not sure how I could be so blind as not to notice lzma_easy_buffer_encode() - it provides everything I need and is supported by lzma_stream_buffer_bound(). I guess I was a bit clumsy navigating the header files. </p>
<p>(You write in the PACKAGERS file: "it might be simpler to just let people read docs directly from the .h files for now". Would you consider adding a Makefile target that simply calls "doxygen"? The header files are littered with compatibility goo (which was probably necessary, no doubt about that), and their organization is not obvious for documentation purposes (to me anyway). I find the doxygen output much nicer to look at (links, colors, layout, and so on).) </p>
<p>I think I'll stick to lzma_stream_buffer_bound() and whatever follows from its use. </p>
<blockquote>
<p>Have you seen this: </p>
</blockquote>
<p><a href="http://tukaani.org/xz/lzma2-openmp.c" rel="nofollow">http://tukaani.org/xz/lzma2-openmp.c</a></p>
<p>No, not yet; though now I googled what links to it and found the other topic here (<a class href="https://sourceforge.net/projects/sevenzip/forums/forum/45797/topic/3853303%29.">https://sourceforge.net/projects/sevenzip/forums/forum/45797/topic/3853303).</a> </p>
<p>I never used OpenMP before; it took me a while until I understood all the directives of the parallel for construct (I had to look at the OpenMP API spec). I like how expressive that region is. </p>
<blockquote>
<p>This demo code doesn't give the very best speed though. The problem is that different chunks take different amount of time to compress. There are as many input/output buffer pairs as there are threads. It's not uncommon that some threads will idle waiting for their turn to write the compressed data to stdout. There should be more buffers than there are threads. Memory usage could be reduced by using unused memory from already finished chunks.</p>
</blockquote>
<p>If you detach the multiplexer (the component that reorders the randomly produced compressed blocks and writes them out in order) from the workers, then you can spin the workers to the max. This is what lbzip2 does, and what lxz would inherit from it. </p>
<div class="codehilite"><pre><span></span><span class="gh">Compressor design</span>
<span class="gh">=================</span>
The splitter reads fixed size blocks from the input file, and passes them to
the workers using a regular queue. For each block, the splitter needs a
previously returned slot from the muxer.
Each worker takes one input block from the queue, compresses it, and passes it
to the muxer, using a head-only (unordered) list. Each single input block
results in one compressed block (or, to be more exact, one full bzip2 stream
containing one bzip2 block).
The muxer regularly fetches the accumulated compressed blocks, reorders them in
an internal red-black tree, and writes them to the output file. For each
compressed block written, it returns one slot to the splitter. If the muxer is
held up for some reason, it will stall the splitter, and that in turn will
eventually stall the workers.
The splitter and the muxer should be IO-bound, the workers CPU-bound.
</pre></div>
<p>The queue depth between the splitter and the workers is four times the number of threads. (Arbitrary factor.) Because in compression mode for each individual chunk a single, bounded size compressed chunk is produced, both the element depth and the memory footprint of the workers-to-muxer queue is known and bounded. </p>
<p>lbzip2 currently uses a red-black tree for the reordering. This is not really necessary in compression mode, a randomly filled sliding window / ring buffer would do. plzip works like that. I left the rbtree in lbzip2 because it is essential for decompression mode (see below), and I didn't want to have so many different queue structures. </p>
<p>During MT-decompression, out of each individual input chunk (compressed block etc) an unbounded amount of decompressed data can be produced. This makes the reordering more complex (with sub-blocks) and a flat ring buffer won't do. Additionally, memory gets treated as an unbounded resource. If one wishes to add a memory throttle to this decompressor design, he has to implement the exact same restriction that you described and that is captured by the "ordered" OpenMP construct: workers must not create holes in the output buffer. Without this restriction, the memory throttle can deadlock the process. </p>
<p>(Eg. the muxer holds decompressed (sub-)blocks #4 and #5, and waits for some thread to produce #3. Blocks #1 and #2 have already been flushed. The thread wishing to allocate memory for #3 is blocked on the memory throttle. The splitter is waiting for the muxer or blocked on the memory throttle, each worker is waiting for the splitter or blocked on the memory throttle - this is a possible situation. Deadlock.) </p>
<p>*Unless*, of course, you either have stored the decompressed size within the compressed block, or are willing to decompress twice (first into the bit bucket, just to compute the decompressed size.) That way you can again have a fixed size sliding window in the muxer, and workers have to reserve space before actually decompressing. Some workers would block on the reservation, but those that wouldn't could decompress independently. </p>
<p>Another thought: in compression mode, the input blocks could be reference counted. All blocks would start with refcount=2, except the last one, which would start with refcount=1. Each input block except the last would be used for (1) compression, and (2) as dictionary for the next block. The last would only be compressed. Whichever kind of use finishes with a given block last would release the block. (lbzip2 does something like that in MT-decompression mode, when an input chunk is scanned by two threads for block delimiters in a partially overlapping fashion.) </p>
<p>Thanks again!</p></div></div>&nbsp;
<div class="reactions" style="user-select: none; cursor: default">
</div>
</div>
</div>
<div class="shortlink_popup modal" style="display: none">
<a class="icon close" href="#" title="Close"><i class="fa fa-close"></i></a>
<div>If you would like to refer to this comment somewhere else in this project, copy and paste the following link:</div>
<input type="text" style="width:100%;" value="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#654b">
</div>
</div>
<ul>
<li>
</li>
</ul>
</div>
</div>
<script>
$('.attachment_toolbar #remove-attachment').on('click', function(e){
    $(this).closest('form').submit();
})
</script>

<ul>
</ul>

</li>

</ul>
<ul>

<li>
<div>
<div id="73c4" class="discussion-post">
<div class="comment-row">
<div class="grid-2 tcenter gravatar">
<p class="gravatar">
<img src="https://a.fsdn.com/con/images/sandiego/icons/default-avatar.png" alt="Laszlo Ersek" title="Laszlo Ersek" class="emboss x48">
</p>
</div>
<div class="grid-16 post-content bubble" style="width: 652px;  ">
<div class="header">
<a href="/u/lacos-hu/profile/" class="user-mention">
Laszlo Ersek
</a>
- <i style="color: #777">
<span title="Sat Dec 18, 2010 11:37 PM UTC">
2010-12-18
</span>
</i>
<div class="tools">
<a href="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#73c4" title="Link" class="little_link shortlink icon btn ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">
<span><i class="fa fa-link" aria-hidden="true"></i></span></a>
</div>
</div>
<div class="display_post">
<div><div class="markdown_content"><p>I released lxz-0.01 and did some completely non-scientific testing. </p>
<p>Input file (usr.tar) size: 2,872,135,680 bytes </p>
<p>The commands were: </p>
<div class="codehilite"><pre><span></span>$ cat usr.tar &gt;/dev/null
$ pv usr.tar <span class="p">|</span> <span class="se">\t</span>ime -v xz &gt;usr.tar.xz <span class="m">2</span>&gt;xz.log
$ cat usr.tar &gt;/dev/null
$ pv usr.tar <span class="se">\</span>
<span class="p">|</span> <span class="se">\t</span>ime -v 7z a /dev/null -bd -txz -si -so -mmt &gt;usr.tar.7z.xz <span class="m">2</span>&gt;7z.log
$ cat usr.tar &gt;/dev/null
$ pv usr.tar <span class="p">|</span> <span class="se">\t</span>ime -v lxz &gt;usr.tar.lxz.xz <span class="m">2</span>&gt;lxz.log
$ cat usr.tar &gt;/dev/null
$ pv usr.tar <span class="p">|</span> <span class="se">\t</span>ime -v lxz -7 &gt;usr.tar.lxz.7.xz <span class="m">2</span>&gt;lxz.7.log
</pre></div>
<p>The output files were verified like this: </p>
<div class="codehilite"><pre><span></span>$ <span class="k">for</span> I in *.xz<span class="p">;</span> <span class="k">do</span> xz -d -v -c <span class="nv">$I</span> <span class="p">|</span> cmp - usr.tar<span class="p">;</span> <span class="k">done</span>
</pre></div>
<p>The decompression wall clock time measured by xz was recorded in the table<br/>
below. </p>
<p>Here's a diagram about the machine architecture (Xeon E5520), generated by<br/>
hwloc: <a href="http://i.imgur.com/tYniz.png" rel="nofollow">http://i.imgur.com/tYniz.png</a> </p>
<p>Some version numbers affecting more than one test run:<br/>
- liblzma: 5.0.0<br/>
- gcc: Debian 4.3.2-1.1<br/>
- glibc: 2.7-18lenny2<br/>
- linux: 2.6.26-2-amd64 </p>
<p>Results: </p>
<div class="codehilite"><pre><span></span>+------------------+----------------+-------------+-------------+------------+
|                  | p7zip          | xz          | lxz         | lxz -7     |
+------------------+----------------+-------------+-------------+------------+
|version           | [64] 9.13 beta | 5.0.0       | 0.01        | 0.01       |
+------------------+----------------+-------------+-------------+------------+
|compressed size   |    728,005,120 | 739,843,716 | 776,352,280 | 737,421,076|
+------------------+----------------+-------------+-------------+------------+
+# of Streams      |              1 |           1 |         172 |          86|
+------------------+----------------+-------------+-------------+------------+
|user (s)          |        1669.66 |     1627.38 |     1826.75 |     1914.25|
|sys (s)           |           6.68 |        2.47 |        9.48 |        9.84|
|wall clock (m:ss) |        4:47.95 |    27:12.79 |     3:55.46 |     4:12.37|
+------------------+----------------+-------------+-------------+------------+
|cpu (%)           |            582 |          99 |         779 |         762|
+------------------+----------------+-------------+-------------+------------+
|xz decompression  |                |             |             |            |
|wall clock (m:ss) |           1:10 |        1:19 |        1:14 |        1:16|
+------------------+----------------+-------------+-------------+------------+
</pre></div>
<p>For input chunks, lxz uses the dictionary size doubled, and I chose CRC32 for<br/>
checksumming, because (based on the former) the input size can't exceed 128<br/>
MiB. I went with lzma_easy_buffer_encode() and lzma_stream_buffer_bound(). </p>
<p>I think lxz won't be entirely useless for me, at least until xz grows multiple<br/>
threads. </p>
<p>Thank you very much for your help!</p></div></div>&nbsp;
<div class="reactions" style="user-select: none; cursor: default">
</div>
</div>
</div>
<div class="shortlink_popup modal" style="display: none">
<a class="icon close" href="#" title="Close"><i class="fa fa-close"></i></a>
<div>If you would like to refer to this comment somewhere else in this project, copy and paste the following link:</div>
<input type="text" style="width:100%;" value="https://sourceforge.net/p/lzmautils/discussion/708858/thread/3b2bddfb/#73c4">
</div>
</div>
<ul>
<li>
</li>
</ul>
</div>
</div>
<script>
$('.attachment_toolbar #remove-attachment').on('click', function(e){
    $(this).closest('form').submit();
})
</script>

<ul>
</ul>

</li>

</ul>
</div>
<div style="clear:both"></div>
<div style="clear:both"></div>
</div>
</div>
<hr>
<p>
<a href="/auth/">Log in</a> to post a comment.
</p>
</div>
</div>
</div>
</section>
<footer class="sandiego">
<div class="as-row">
<div class="footer-wrapper">
<nav aria-label="Site Links" role="navigation">
<section>
<div class="as-h2">SourceForge</div>
<ul>
<li><a href="/create/" title="Create a Project">Create a Project</a></li>
<li><a href="/directory/" title="Open Source Software Directory">Open Source Software</a></li>
<li><a href="/software/" title="Business Software Directory">Business Software</a></li>
<li><a href="/top" title="Top Open Source Projects">Top Downloaded Projects</a></li>
</ul>
</section>
</nav>
<nav aria-label="Company Links" role="navigation">
<section>
<div class="as-h2">Company</div>
<ul>
<li><a href="/about">About</a></li>
<li><a href="/about/leadership" title="Open Source Software Directory">Team</a></li>
<li class="h-card">
<address>
<span class="p-name p-org">SourceForge Headquarters</span><br>
<span class="p-street-address">225 Broadway Suite 1600</span><br>
<span class="p-locality">San Diego, CA <span class="p-postal-code">92101</span></span><br>
<span class="p-tel">+1 (858) 454-5900</span><br>
</address>
</li>
<li id="social">
<span></span>
<a href="https://twitter.com/sourceforge" class="twitter" rel="nofollow" target="_blank">
<svg class="vertical-icon-fix" data-name="twitter" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z" /></svg></a>
<a href="https://fosstodon.org/@sourceforge" rel="me nofollow" target="_blank">
<svg class="vertical-icon-fix" data-name="mastodon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z" /></svg></a>
<a href="https://www.facebook.com/sourceforgenet/" class="facebook" rel="nofollow" target="_blank">
<svg data-name="facebook" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z" /></svg></a>
<a href="https://www.linkedin.com/company/sourceforge.net" class="linkedin" rel="nofollow" target="_blank">
<svg data-name="linkedin" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z" /></svg></a>
<span></span>
</li>
</ul>
</section>
</nav>
<nav aria-label="Resources Links" role="navigation">
<section>
<div class="as-h2">Resources</div>
<ul>
<li><a href="/support" title="Support Section">Support</a></li>
<li><a href="/p/forge/documentation/Docs%20Home/" title="Site Documentation">Site Documentation</a></li>
<li><a href="https://fosstodon.org/@sourceforgestatus" title="Site Status" rel="me nofollow">Site Status</a></li>
</ul>
</section>
</nav>
<section class="footer-logo">
<a href="/" title="Home" class="sf-logo">
<img src="https://a.fsdn.com/con/images/sandiego/sf-logo-full.svg" alt="SourceForge logo" class="sf-logo-full" />
</a>
</section>
</div>
</div>
<section class="l-nav-bottom">
<nav class="row">
<div class="columns small-12 large-6 copyright-notice">
&copy; 2024 Slashdot Media. All Rights Reserved.
</div>
<div class="columns large-6 links links-right">
<a href="https://slashdotmedia.com/terms-of-use" title="Terms" rel="nofollow">Terms</a>
<a href="https://slashdotmedia.com/privacy-statement/" title="Privacy" rel="nofollow">Privacy</a>
<a href="#" title="Privacy Choices" id="privacy-choices" class="btn-privay-choices">Privacy Choices</a>
<a href="https://slashdotmedia.com/contact/" target="_blank" title="Advertise" rel="nofollow">Advertise</a>
</div>
</nav>
</section>
</footer>
</div>
<div id="messages">
</div>

<script type="text/javascript" src="https://a.fsdn.com/allura/nf/1720797364/_ew_/_slim/js?href=allura%2Fjs%2Fjquery.notify.js%3Ballura%2Fjs%2Fjquery.tooltipster.js%3Ballura%2Fjs%2Fallura-base.js%3Ballura%2Fjs%2Fchecklist.js%3Ballura%2Fjs%2Fadmin_modal.js%3Bjs%2Fjquery.lightbox_me.js%3Ballura%2Fjs%2Fmemorable.js%3Bjs%2Fjquery.tagsinput.js%3Bjs%2Feasymde.min.js%3Bjs%2Fsf_markitup.js%3Bjs%2Fshow-hint.js%3Bjs%2Fusermentions-helper.js%3Bjs%2Fpost.js%3Bjs%2Freactions.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fshared.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fsticky.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fsandiego%2Fchrome.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fsandiego%2Futilities.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.core.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.util.mediaQuery.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.util.keyboard.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.util.box.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.util.nest.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.dropdownMenu.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.offcanvas.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.toggler.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fsandiego%2Fproject.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Fjquery.typeahead.min.js%3Ballura%2Fjs%2Freact.production.min.js%3Ballura%2Fjs%2Freact-dom.production.min.js%3Ballura%2Fjs%2Fcreate-react-class.min.js%3Ballura%2Fjs%2Fprop-types.min.js"></script>


<script type="text/javascript">$(function () {
            $('select.results_per_page').change(function () {
                this.form.submit();});});
$(function () {
          $('input.label_edit').tagsInput({
              'height':'100%',
              'width':'100%',
              'autocomplete_url':'/p/lzmautils/discussion/tags'
          });
          $('form').on('blur', '.ui-autocomplete-input', function() {
              setTimeout(function(){
                  var clicked = $(document.activeElement); // This is the element that has focus
                  if (clicked.is('#ui-active-menuitem')) {
                      return false;
                  } else {
                      var value = $('div.tagsinput div input').val();
                      var exists = $('input.label_edit').tagExist(value);
                      var default_value = $('div.tagsinput div input').attr('data-default');
                      if ((value !== default_value) && (!exists) && value !== '') {
                          $('input.label_edit').addTag(value);
                      }
                      $('input[type=submit]', this).prop('disabled', true);
                  }
                }, 1);
            });
        });
$(function () {getProjectUsers('/p/lzmautils//users')});
$(document).ready(function () {
            $("a.attachment_form_add_button").click(function(evt){
                $(this).hide();
                $(".attachment_form_fields", this.parentNode).show();
                evt.preventDefault();
            });
            $("a.cancel_edit_post").click(function(evt){
                evt.preventDefault();
                var form = this.parentNode;
                var orig_val = $("input.original_value", form).val();
                $("textarea", form).val(orig_val);
                get_cm(form).setValue(orig_val);
                $("input.attachment_form_fields", form).val('');
                $(this).closest('.reply_post_form').hide();
            });
         });

        $(document).ready(function () {
            var thread_tag = $('a.thread_tag');
            var thread_spam = $('a.sidebar_thread_spam');
            var tag_thread_holder = $('#tag_thread_holder');
            var allow_moderate = $('#allow_moderate');
            var mod_thread_link = $('#mod_thread_link');
            var mod_thread_form = $('#mod_thread_form');
            if (mod_thread_link.length) {
                if (mod_thread_form.length) {
                    mod_thread_link.click(function (e) {
                        mod_thread_form.toggle();
                        return false;
                    });
                }
            }
            if (thread_tag.length) {
                if (tag_thread_holder.length) {
                    var submit_button = $('input[type="submit"]', tag_thread_holder);
                    var cancel_button = $('<a href="#" class="btn link">Cancel</a>').click(function(evt){
                        evt.preventDefault();
                        tag_thread_holder.hide();
                        thread_tag.removeClass('active');
                    });
                    submit_button.after(cancel_button);
                    thread_tag.click(function (e) {
                        tag_thread_holder.show();
                        thread_tag.addClass('active');
                        // focus the submit to scroll to the form, then focus the subject for them to start typing
                        submit_button.focus();
                        $('input[type="text"]', tag_thread_holder).focus();
                        return false;
                    });
                }
            }
            if (thread_spam.length) {
                if (allow_moderate.length) {
                    thread_spam[0].style.display='block';
                }
            }
        });
        

            var global_reactions = {":+1:": "\ud83d\udc4d", ":-1:": "\ud83d\udc4e", ":smile:": "\ud83d\ude04", ":tada:": "\ud83c\udf89", ":confused:": "\ud83d\ude15", ":heart:": "\u2764\ufe0f"};
        </script>
<script type="text/javascript" src="https://a.fsdn.com/allura/nf/1720797364/_ew_/_slim/js?href=theme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.util.triggers.min.js%3Btheme%2Fsftheme%2Fjs%2Fsftheme%2Fvendor%2Ffoundation6%2Fplugins%2Ffoundation.reveal.min.js"></script>

<script>
    bizx.cmp.ifConsent('', ['all', 'google-ads'], function () {}, function(){
        $('body').addClass('no-ads-consent'); 
    });
</script>
<script>
        $(document).foundation();
    </script>

<script>
    (function () {
        bizx.cmp.ifConsent({ purposes: 'all', vendors: 'bombora'}, function () {
            /*global _ml:true, window */
            _ml = window._ml || {};
            _ml.eid = '771';
            _ml.fp = '49274a03-34cc-42cc-b6f5-2520776e440f';  
            var s = document.getElementsByTagName('script')[0], cd = new Date(), mltag = document.createElement('script');
            mltag.type = 'text/javascript';
            mltag.async = true;
            mltag.defer = true;
            mltag.src = '//ml314.com/tag.aspx?' + cd.getDate() + cd.getMonth() + cd.getFullYear();
            s.parentNode.insertBefore(mltag, s);
        });
    })();
</script>

<script>
    $(document).ready(function () {
        $(".tooltip, .m-tooltip").each(function(){
            let $el = $(this);
            $el.tooltipster({
                animation: 'fade',
                delay: 200,
                theme: 'tooltipster-light',
                trigger: 'hover',
                position: $el.data('position') || 'right',
                iconCloning: false,
                maxWidth: 300,
                contentAsHTML: true,
                interactive: true
            }).focus(function () {
                $(this).tooltipster('show');
            }).blur(function () {
                $(this).tooltipster('hide');
            });
        });
    });
</script>
</script>
</body>
</html>