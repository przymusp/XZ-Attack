{"id":"30155649762","type":"IssuesEvent","actor":{"id":46091994,"login":"kostadinsh","display_login":"kostadinsh","gravatar_id":"","url":"https://api.github.com/users/kostadinsh","avatar_url":"https://avatars.githubusercontent.com/u/46091994?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"opened","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/55","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/55/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/55/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/55/events","html_url":"https://github.com/tukaani-project/xz/issues/55","id":1785719237,"node_id":"I_kwDOIQBEvs5qb-nF","number":55,"title":"[Bug]: warnings about missing symbols when building with the mold linker and lto","user":{"login":"kostadinsh","id":46091994,"node_id":"MDQ6VXNlcjQ2MDkxOTk0","avatar_url":"https://avatars.githubusercontent.com/u/46091994?v=4","gravatar_id":"","url":"https://api.github.com/users/kostadinsh","html_url":"https://github.com/kostadinsh","followers_url":"https://api.github.com/users/kostadinsh/followers","following_url":"https://api.github.com/users/kostadinsh/following{/other_user}","gists_url":"https://api.github.com/users/kostadinsh/gists{/gist_id}","starred_url":"https://api.github.com/users/kostadinsh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kostadinsh/subscriptions","organizations_url":"https://api.github.com/users/kostadinsh/orgs","repos_url":"https://api.github.com/users/kostadinsh/repos","events_url":"https://api.github.com/users/kostadinsh/events{/privacy}","received_events_url":"https://api.github.com/users/kostadinsh/received_events","type":"User","site_admin":false},"labels":[{"id":4687621022,"node_id":"LA_kwDOIQBEvs8AAAABF2drng","url":"https://api.github.com/repos/tukaani-project/xz/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-07-03T09:13:02Z","updated_at":"2023-07-03T09:13:02Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Describe the bug\n\nWhen building with the mold linker and -flto added to CFLAGS, this package seems to have some issues in the linking phase regarding symbols not being found. I've turned mold's warnings into errors with `-Wl,--fatal-warnings`, so I can catch them more easily.\r\n\r\nGCC version used is gcc (Gentoo 13.1.1_p20230527 p3) 13.1.1 20230527\r\nMold is built from git at commit `b04aba89d3a1931470983212925443e7aefca1e1`\r\n\r\nSteps to reproduce: \r\n1. Clone this repo and cd into the xz folder\r\n2. run `export CFLAGS=\"-O2 -pipe -flto=auto\"` and `export LDFLAGS=\"-fuse-ld=mold -Wl,--fatal-warnings\"`\r\n3. run `autoreconf -vfi`\r\n4. run `./configure --enable-threads --prefix=/usr`\r\n5. build the package with `make V=1`\r\n\r\nIn the log output I am only going to only add the last few lines of the log as I think the entire log would be way too much, and then add the full logs from `./configure` and `make` as an attachment\r\n\r\n[xz-configure.log](https://github.com/tukaani-project/xz/files/11935128/xz-configure.log)\r\n[xz-make.log](https://github.com/tukaani-project/xz/files/11935130/xz-make.log)\r\n\n\n### Version\n\ncommit 66bdcfa85fef2911cc80f5f30fed3f9610faccb4\n\n### Operating System\n\nGentoo Linux\n\n### Relevant log output\n\n```shell\nlibtool: link: gcc -shared  -fPIC -DPIC  .libs/liblzma_la-tuklib_physmem.o .libs/liblzma_la-tuklib_cpucores.o .libs/liblzma_la-common.o .libs/liblzma_la-block_util.o .libs/liblzma_la-easy_preset.o .libs/liblzma_la-filter_common.o .libs/liblzma_la-hardware_physmem.o .libs/liblzma_la-index.o .libs/liblzma_la-stream_flags_common.o .libs/liblzma_la-string_conversion.o .libs/liblzma_la-vli_size.o .libs/liblzma_la-hardware_cputhreads.o .libs/liblzma_la-outqueue.o .libs/liblzma_la-alone_encoder.o .libs/liblzma_la-block_buffer_encoder.o .libs/liblzma_la-block_encoder.o .libs/liblzma_la-block_header_encoder.o .libs/liblzma_la-easy_buffer_encoder.o .libs/liblzma_la-easy_encoder.o .libs/liblzma_la-easy_encoder_memusage.o .libs/liblzma_la-filter_buffer_encoder.o .libs/liblzma_la-filter_encoder.o .libs/liblzma_la-filter_flags_encoder.o .libs/liblzma_la-index_encoder.o .libs/liblzma_la-stream_buffer_encoder.o .libs/liblzma_la-stream_encoder.o .libs/liblzma_la-stream_flags_encoder.o .libs/liblzma_la-vli_encoder.o .libs/liblzma_la-stream_encoder_mt.o .libs/liblzma_la-microlzma_encoder.o .libs/liblzma_la-alone_decoder.o .libs/liblzma_la-auto_decoder.o .libs/liblzma_la-block_buffer_decoder.o .libs/liblzma_la-block_decoder.o .libs/liblzma_la-block_header_decoder.o .libs/liblzma_la-easy_decoder_memusage.o .libs/liblzma_la-file_info.o .libs/liblzma_la-filter_buffer_decoder.o .libs/liblzma_la-filter_decoder.o .libs/liblzma_la-filter_flags_decoder.o .libs/liblzma_la-index_decoder.o .libs/liblzma_la-index_hash.o .libs/liblzma_la-stream_buffer_decoder.o .libs/liblzma_la-stream_decoder.o .libs/liblzma_la-stream_flags_decoder.o .libs/liblzma_la-vli_decoder.o .libs/liblzma_la-stream_decoder_mt.o .libs/liblzma_la-microlzma_decoder.o .libs/liblzma_la-lzip_decoder.o .libs/liblzma_la-check.o .libs/liblzma_la-crc32_table.o .libs/liblzma_la-crc32_fast.o .libs/liblzma_la-crc64_table.o .libs/liblzma_la-crc64_fast.o .libs/liblzma_la-sha256.o .libs/liblzma_la-lz_encoder.o .libs/liblzma_la-lz_encoder_mf.o .libs/liblzma_la-lz_decoder.o .libs/liblzma_la-lzma_encoder_presets.o .libs/liblzma_la-lzma_encoder.o .libs/liblzma_la-lzma_encoder_optimum_fast.o .libs/liblzma_la-lzma_encoder_optimum_normal.o .libs/liblzma_la-fastpos_table.o .libs/liblzma_la-lzma_decoder.o .libs/liblzma_la-lzma2_encoder.o .libs/liblzma_la-lzma2_decoder.o .libs/liblzma_la-price_table.o .libs/liblzma_la-delta_common.o .libs/liblzma_la-delta_encoder.o .libs/liblzma_la-delta_decoder.o .libs/liblzma_la-simple_coder.o .libs/liblzma_la-simple_encoder.o .libs/liblzma_la-simple_decoder.o .libs/liblzma_la-x86.o .libs/liblzma_la-powerpc.o .libs/liblzma_la-ia64.o .libs/liblzma_la-arm.o .libs/liblzma_la-armthumb.o .libs/liblzma_la-arm64.o .libs/liblzma_la-sparc.o   -lpthread  -O2 -flto=auto -Wl,--version-script=../../src/liblzma/liblzma_linux.map -fuse-ld=mold -Wl,--fatal-warnings   -pthread -Wl,-soname -Wl,liblzma.so.5 -o .libs/liblzma.so.5.5.99\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2` to symbol `lzma_block_uncomp_encode`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2` to symbol `lzma_cputhreads`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2` to symbol `lzma_get_progress`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2` to symbol `lzma_stream_encoder_mt`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2` to symbol `lzma_stream_encoder_mt_memusage`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.1.2alpha` to symbol `lzma_stream_encoder_mt`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.1.2alpha` to symbol `lzma_stream_encoder_mt_memusage`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2.2` to symbol `lzma_block_uncomp_encode`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2.2` to symbol `lzma_cputhreads`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2.2` to symbol `lzma_get_progress`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2.2` to symbol `lzma_stream_encoder_mt`: symbol not found\r\nmold: error: ../../src/liblzma/liblzma_linux.map: cannot assign version `XZ_5.2.2` to symbol `lzma_stream_encoder_mt_memusage`: symbol not found\r\ncollect2: error: ld returned 1 exit status\r\nmake[4]: *** [Makefile:963: liblzma.la] Error 1\r\nmake[4]: Leaving directory '/home/kostadin/xz/src/liblzma'\r\nmake[3]: *** [Makefile:1747: all-recursive] Error 1\r\nmake[3]: Leaving directory '/home/kostadin/xz/src/liblzma'\r\nmake[2]: *** [Makefile:429: all-recursive] Error 1\r\nmake[2]: Leaving directory '/home/kostadin/xz/src'\r\nmake[1]: *** [Makefile:624: all-recursive] Error 1\r\nmake[1]: Leaving directory '/home/kostadin/xz'\r\nmake: *** [Makefile:493: all] Error 2\n```\n","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/55/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/55/timeline","performed_via_github_app":null,"state_reason":null}},"public":true,"created_at":"2023-07-03T09:13:03Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
