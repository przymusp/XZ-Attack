<div dir="ltr"><div>Hi, all,</div><div><br></div><div>i&#39;m currently switching to xz for some downloads on my website and i&#39;m a bit befuddled and troubled by one result set i&#39;m seeing and cannot explain:</div><div><br></div><div>xz 5.2.4 produces, on the same input set, wildly different archive sizes on a Raspberry Pi 4B (ARM) running Raspberry Pi OS than it does on Linux Mint 20 on an x64 machine.</div><div><br></div><div>To reproduce:</div><div><br></div><div>1) Fetch the test data set:</div><div><br></div><div>wget <a href="https://fossil.wanderinghorse.net/r/.flickfleet/tarball/xztest.tar.gz?name=aff99f5779">https://fossil.wanderinghorse.net/r/.flickfleet/tarball/xztest.tar.gz?name=aff99f5779</a> -O foo.tar.gz</div><div><br></div><div>approx 6.2MB.<br></div><div><br></div><div>2) Reduce it to just a tar file:<br></div><div><br></div><div>gunzip foo.tar.gz</div><div><br></div><div>approx 22MB of SVG files.</div><div><br></div><div>Now here are the results of packing that on my two machines:</div><div><br></div><div>Compressing the tar file directly provides the same results on both system, as expected:<br></div><div><br></div><div>x86/64:</div><div><br></div><div>[stephan@lapdog:~/tmp]$ xz foo.tar<br>[stephan@lapdog:~/tmp]$ l foo.tar.xz<br>-rw-rw-r-- 1 stephan stephan 2348712 Sep  1 10:11 foo.tar.xz</div><div><br></div><div>==&gt; 2.3MB, with the exact same results on the pi.</div><div><br></div><div>However, running it via tar (GNU 1.30 on both systems) to compress a directory of identical contents...</div><div><br></div><div>x64:</div><div>[stephan@lapdog:~/tmp]$ tar xf foo.tar<br>[stephan@lapdog:~/tmp]$ ls -d xztest<br>xztest<br>[stephan@lapdog:~/tmp]$ tar cf foo.tar.xz xztest --xz; l foo.tar.xz<br>-rw-rw-r-- 1 stephan stephan 2335360 Sep  1 10:18 foo.tar.xz</div><div>[stephan@lapdog:~/tmp]$ uname -a<br>Linux lapdog 5.4.0-42-generic #46-Ubuntu SMP Fri Jul 10 00:24:02 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</div><div><br></div><div>==&gt; 2.3MB<br></div><div><br></div><div>pi:</div><div>[pi@pi4b8:~/tmp]$ tar xf foo.tar <br>[pi@pi4b8:~/tmp]$ ls -d xztest<br>xztest<br>[pi@pi4b8:~/tmp]$ tar cf foo.tar.xz xztest --xz; l foo.tar.xz<br>-rw-r--r-- 1 pi pi 1601588 Sep  1 10:19 foo.tar.xz<br></div><div>[pi@pi4b8:~/tmp]$ uname -a<br>Linux pi4b8 5.4.51-v7l+ #1333 SMP Mon Aug 10 16:51:40 BST 2020 armv7l GNU/Linux</div><div><br></div><div>==&gt; 1.6MB</div><div><br></div><div>i&#39;ve unpackaged and compared the results, and they&#39;re identical - this is 100% reproducible and not a case of corruption or truncation.</div><br><div>How do i account for these differences and how to i get that same level of compression when running xz outside of tar and on my x64 system? Both have xz 5.2.4 and tar is spawning the external xz binary on both (as opposed to using a linked-in copy of xz).<br></div><div><br></div><div>:-?<br></div><div><br></div><div>Thank you for your time!<br></div><div><br></div><div><div>-- <br><div dir="ltr" class="gmail_signature" data-smartmail="gmail_signature"><div dir="ltr"><div><div dir="ltr"><div><div dir="ltr">----- stephan beal<br><a href="http://wanderinghorse.net/home/stephan/" target="_blank">https://wanderinghorse.net/home/stephan/</a><div><span style="font-size:12.8px">&quot;Freedom is sloppy. But since tyranny&#39;s the only guaranteed byproduct of those who insist on a perfect world, freedom will have to do.&quot; -- Bigby Wolf</span><br></div></div></div></div></div></div></div></div></div></div>
