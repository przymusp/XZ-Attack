{"id":"29078713786","type":"IssuesEvent","actor":{"id":78642,"login":"ssvb","display_login":"ssvb","gravatar_id":"","url":"https://api.github.com/users/ssvb","avatar_url":"https://avatars.githubusercontent.com/u/78642?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"opened","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/50","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/50/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/50/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/50/events","html_url":"https://github.com/tukaani-project/xz/issues/50","id":1710506817,"node_id":"I_kwDOIQBEvs5l9ENB","number":50,"title":"[Feature Request]: A new filter for better compression of UTF-8 text (primarily Cyrillic, Greek or anything non-English)","user":{"login":"ssvb","id":78642,"node_id":"MDQ6VXNlcjc4NjQy","avatar_url":"https://avatars.githubusercontent.com/u/78642?v=4","gravatar_id":"","url":"https://api.github.com/users/ssvb","html_url":"https://github.com/ssvb","followers_url":"https://api.github.com/users/ssvb/followers","following_url":"https://api.github.com/users/ssvb/following{/other_user}","gists_url":"https://api.github.com/users/ssvb/gists{/gist_id}","starred_url":"https://api.github.com/users/ssvb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssvb/subscriptions","organizations_url":"https://api.github.com/users/ssvb/orgs","repos_url":"https://api.github.com/users/ssvb/repos","events_url":"https://api.github.com/users/ssvb/events{/privacy}","received_events_url":"https://api.github.com/users/ssvb/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-05-15T17:21:07Z","updated_at":"2023-05-15T17:21:07Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Describe the Feature\n\nSimilar to BCJ filters for executables, UTF-8 text compression can be also potentially improved by applying a filter before compressing data with LZMA. Each Cyrillic letter needs 2 bytes in UTF-8 format. And it's easy to demonstrate that converting UTF-8 to legacy 8-bit encoding improves compression. Some examples are below.\r\n\r\nUrkainian text is **~7%** better compressible in a 8-bit cp1124 encoding:\r\n```\r\nwget wget https://archive.org/stream/ukrainskakuhnya1998/ukrainskakuhnya1998_djvu.txt\r\niconv -f utf-8 -t CP1124//TRANSLIT ukrainskakuhnya1998_djvu.txt > ukrainskakuhnya1998_djvu.txt.cp1124\r\nxz -k ukrainskakuhnya1998_djvu.txt\r\nxz -k ukrainskakuhnya1998_djvu.txt.cp1124\r\nls -l ukrainskakuhnya1998_djvu*\r\n-rw-r--r-- 1 ssvb ssvb 2860770 May 15 19:44 ukrainskakuhnya1998_djvu.txt\r\n-rw-r--r-- 1 ssvb ssvb 1682011 May 15 19:47 ukrainskakuhnya1998_djvu.txt.cp1124\r\n-rw-r--r-- 1 ssvb ssvb  418940 May 15 19:47 ukrainskakuhnya1998_djvu.txt.cp1124.xz\r\n-rw-r--r-- 1 ssvb ssvb  448944 May 15 19:44 ukrainskakuhnya1998_djvu.txt.xz\r\n```\r\n\r\nFinnish text is **~0.8%** better compressible in a 8-bit latin1 encoding:\r\n```\r\nwget https://www.gutenberg.org/cache/epub/70694/pg70694.html\r\niconv -f utf-8 -t latin1//TRANSLIT pg70694.html > pg70694.html.latin1\r\nxz -k pg70694.html\r\nxz -k pg70694.html.latin1\r\nls -l pg70694*\r\n-rw-r--r-- 1 ssvb ssvb 742324 May  4 03:00 pg70694.html\r\n-rw-r--r-- 1 ssvb ssvb 709415 May 15 19:16 pg70694.html.latin1\r\n-rw-r--r-- 1 ssvb ssvb 223924 May 15 19:16 pg70694.html.latin1.xz\r\n-rw-r--r-- 1 ssvb ssvb 225720 May  4 03:00 pg70694.html.xz\r\n```\r\n\r\nNow regarding the filter itself. It needs to be perfectly reversible without any possible data loss during conversion. So I would suggest to use a small set of legacy 8-bit codepages, such as latin1, cp1124, cp1251 and so on. But still reserve one special character for escape sequences (to switch between the available 8-bit codepages or for injecting arbitrary binary data). I can implement a prototype of such filter if anyone is interested. But the main question is how to integrate it into XZ? And whether such filter would be accepted in principle?\n\n### Expected Complications\n\nThat's a format extension. So older releases of `xz-utils` won't be able to decompress newly created `xz` files with this new filter.\n\n### Will I try to implement this new feature?\n\nYes","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/50/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/50/timeline","performed_via_github_app":null,"state_reason":null}},"public":true,"created_at":"2023-05-15T17:21:07Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
{"id":"29078751066","type":"PushEvent","actor":{"id":78042786,"login":"JiaT75","display_login":"JiaT75","gravatar_id":"","url":"https://api.github.com/users/JiaT75","avatar_url":"https://avatars.githubusercontent.com/u/78042786?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"repository_id":553665726,"push_id":13642085215,"size":17,"distinct_size":16,"ref":"refs/heads/filter_to_str_cli","head":"55680d3e40b3eaddf306cc3867c3f30e25ba2560","before":"5c4e31c151008a58734434f8b743c8ee1bacb4ae","commits":[{"sha":"f36ca7982f6bd5e9827219ed4f3c5a1fbf5d7bdf","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"liblzma: Slightly rewords lzma_str_list_filters() documentation.\n\nReword \"options required\" to \"supported options\". The previous may have\nsuggested that the options listed were all required anytime a filter is\nused for encoding or decoding. The reword makes this more clear that\nadjusting the options is optional.","distinct":false,"url":"https://api.github.com/repos/tukaani-project/xz/commits/f36ca7982f6bd5e9827219ed4f3c5a1fbf5d7bdf"},{"sha":"5262faaf088dbd11df464f676ee3ad1dd3138b09","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Adds --filters option to CLI.\n\nThe --filters option uses the new lzma_str_to_filters() function\nto convert a string into a full chain of filters. Using this option\nwill reset all previous filters set by --preset, --[filter], or\n--filters.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/5262faaf088dbd11df464f676ee3ad1dd3138b09"},{"sha":"7b1ff929827e5065c68b32118a6b17aba66c12af","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Updates --long-help and man page for new --filters option.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/7b1ff929827e5065c68b32118a6b17aba66c12af"},{"sha":"16ec23ec55dbfbf92b425e25a976d7e62ecbf751","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"Tests: Use new --filter option in test_compress.sh","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/16ec23ec55dbfbf92b425e25a976d7e62ecbf751"},{"sha":"389409ad4790a81f63c6ae5d11b17a2e4e8bf537","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Separates string to filter conversion into a helper function.\n\nConverting from string to filter will also need to be done for block\nspecific filter chains.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/389409ad4790a81f63c6ae5d11b17a2e4e8bf537"},{"sha":"a21a48acafa075c0e3db8aef9bd3572d0165614e","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Creates command line options for filters[1-9].\n\nThe new command line options are meant to be combined with --block-list.\nThey work as an optional extension to --block-list to specify a custom\nfilter chain for each block listed. The new options allow the creation\nof up to 9 reusable filter chains. For instance:\n\nxz --block-list=1:10MiB,3:5MiB,,2:5MiB,1:0 --filters1=delta--lzma2 \\\n--filters2=x86--lzma2 --filters3=arm64--lzma2\n\nWill create the following blocks:\n1. A block of size 10 MiB with filter chain delta, lzma2.\n2. A block of size 5 MiB with filter chain arm64, lzma2.\n3. A block of size 5 MiB with filter chain arm64, lzma2.\n4. A block of size 5 MiB with filter chain x86, lzma2.\n5. A block containing the rest of the file contents with filter chain\n   delta, lzma2.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/a21a48acafa075c0e3db8aef9bd3572d0165614e"},{"sha":"8daed1bf715db9e91dddb767215fe4783fd38592","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Adds a message if --block-list is used outside of xz compresssion.\n\n--block-list is only supported with compression in xz format. This avoids\nsilently ignoring when --block-list is unused.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/8daed1bf715db9e91dddb767215fe4783fd38592"},{"sha":"d454c0a644b0de7e1247ec13d98100c621d5934f","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Uses lzma_filters_free() in forget_filter_chain().\n\nThis is a little cleaner than the previous implementation of\nforget_filter_chain(). It is also more consistent since\nlzma_str_to_filters() will always terminate the filter chain so there\nis no need to terminate it later in coder_set_compression_settings().","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/d454c0a644b0de7e1247ec13d98100c621d5934f"},{"sha":"c84d1613e3e794c3aa19aabfbd56d8e1e6453faa","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Frees filters[] in debug mode.\n\nThis will only free filter chains created with --filters1-9 since the\ndefault filter chain may be set from a static function variable. The\ncomplexity to free the default filter chain is not worth the burden on\ncode maintenance.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/c84d1613e3e794c3aa19aabfbd56d8e1e6453faa"},{"sha":"001a6c08d96ec1d061eeaa50f386c2111390c1a5","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Do not include block splitting if encoders are disabled.\n\nThe block splitting logic and split_block() function are not needed if\nencoders are disabled. This will help slightly reduce the binary size\nwhen built without encoders and allow split_block() to use functions\nthat require encoders being enabled.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/001a6c08d96ec1d061eeaa50f386c2111390c1a5"},{"sha":"e90fff0bb22068cef0367dff1a07a61f49f936ba","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Allows --block-list filters to scale down memory usage.\n\nPreviously, only the default filter chain could have its memory usage\nadjusted. The filter chains specified with --filtersX were not checked\nfor memory usage. Now, all used filter chains can be adjusted and will\nbe reported in verbose mode if adjusted.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/e90fff0bb22068cef0367dff1a07a61f49f936ba"},{"sha":"3ecebaa7a7b813507795c8ca9c2412dbda78a86e","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Validates --flush-timeout for all specified filter chains.\n\nA side-effect of this is that if a filter chain is specified but not\nused, this will still cause a fatal error.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/3ecebaa7a7b813507795c8ca9c2412dbda78a86e"},{"sha":"20bb2f9c6f1bfde6957c8639b4ba8daf0bd02970","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Sets the Block size for mt encoding correctly.\n\nWhen opt_block_size is not used, the Block size for mt encoder is\nderived from the minimum of the largest Block specified by\n--block-list and the recommended Block size on all filter chains\ncalculated by lzma_mt_block_size(). This avoids using unnecessary\nmemory and ensures that all Blocks are large enough for the most memory\nneedy filter chain.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/20bb2f9c6f1bfde6957c8639b4ba8daf0bd02970"},{"sha":"da4ee82e39dfda687936f67d4632035f3281d76f","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Updates --long-help for the new --filtersX option.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/da4ee82e39dfda687936f67d4632035f3281d76f"},{"sha":"9f70f216b0b0693600c783d703f73b92d8aa2269","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Updates the man page for --block-list and --filters1...9.\n\nThe --block-list option description needed updating since the new\n--filters1...9 option changes how it can be used. The new entry for\n--filters1...9 was created right after the --filters option.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/9f70f216b0b0693600c783d703f73b92d8aa2269"},{"sha":"9f84e2822cabb3fa48e3120ad0f777c62ca1acc2","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Adds a new --filters-help option.\n\nThe --filters-help can be used to help create filter chains with the\n--filters and --filtersX options. The message in --long-help is too\nshort to fully explain the syntax to construct complex filter chains.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/9f84e2822cabb3fa48e3120ad0f777c62ca1acc2"},{"sha":"55680d3e40b3eaddf306cc3867c3f30e25ba2560","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"xz: Updates man page for new --filters-help option.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/55680d3e40b3eaddf306cc3867c3f30e25ba2560"}]},"public":true,"created_at":"2023-05-15T17:22:44Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
