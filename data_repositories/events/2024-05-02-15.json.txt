{"id":"38032157703","type":"IssueCommentEvent","actor":{"id":120408189,"login":"Larhzu","display_login":"Larhzu","gravatar_id":"","url":"https://api.github.com/users/Larhzu","avatar_url":"https://avatars.githubusercontent.com/u/120408189?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/120","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/120/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/120/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/120/events","html_url":"https://github.com/tukaani-project/xz/pull/120","id":2274549047,"node_id":"PR_kwDOIQBEvs5uTnYR","number":120,"title":"WIP: meson build","user":{"login":"vtorri","id":1422401,"node_id":"MDQ6VXNlcjE0MjI0MDE=","avatar_url":"https://avatars.githubusercontent.com/u/1422401?v=4","gravatar_id":"","url":"https://api.github.com/users/vtorri","html_url":"https://github.com/vtorri","followers_url":"https://api.github.com/users/vtorri/followers","following_url":"https://api.github.com/users/vtorri/following{/other_user}","gists_url":"https://api.github.com/users/vtorri/gists{/gist_id}","starred_url":"https://api.github.com/users/vtorri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vtorri/subscriptions","organizations_url":"https://api.github.com/users/vtorri/orgs","repos_url":"https://api.github.com/users/vtorri/repos","events_url":"https://api.github.com/users/vtorri/events{/privacy}","received_events_url":"https://api.github.com/users/vtorri/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-05-02T04:06:00Z","updated_at":"2024-05-02T15:44:09Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tukaani-project/xz/pulls/120","html_url":"https://github.com/tukaani-project/xz/pull/120","diff_url":"https://github.com/tukaani-project/xz/pull/120.diff","patch_url":"https://github.com/tukaani-project/xz/pull/120.patch","merged_at":null},"body":null,"reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/120/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/120/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/2090846841","html_url":"https://github.com/tukaani-project/xz/pull/120#issuecomment-2090846841","issue_url":"https://api.github.com/repos/tukaani-project/xz/issues/120","id":2090846841,"node_id":"IC_kwDOIQBEvs58n8p5","user":{"login":"Larhzu","id":120408189,"node_id":"U_kgDOBy1IfQ","avatar_url":"https://avatars.githubusercontent.com/u/120408189?v=4","gravatar_id":"","url":"https://api.github.com/users/Larhzu","html_url":"https://github.com/Larhzu","followers_url":"https://api.github.com/users/Larhzu/followers","following_url":"https://api.github.com/users/Larhzu/following{/other_user}","gists_url":"https://api.github.com/users/Larhzu/gists{/gist_id}","starred_url":"https://api.github.com/users/Larhzu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Larhzu/subscriptions","organizations_url":"https://api.github.com/users/Larhzu/orgs","repos_url":"https://api.github.com/users/Larhzu/repos","events_url":"https://api.github.com/users/Larhzu/events{/privacy}","received_events_url":"https://api.github.com/users/Larhzu/received_events","type":"User","site_admin":false},"created_at":"2024-05-02T15:44:07Z","updated_at":"2024-05-02T15:44:07Z","author_association":"MEMBER","body":"The following is relevant only when other things have already been finished. I'm writing it here so that it won't be forgotten.\r\n\r\nThe tuklib files are a bit similar to Gnulib in sense that a subset of the files is meant to be reusable in other projects somewhat easily. With Autotools and CMake, one can copy the relevant `m4/tuklib_*.m4` or `cmake/tuklib_*.cmake` files along with the `.h` and `.c` files.\r\n\r\nMeson's language is intentionally more restrictive so it's OK that the first iterations put all tuklib checks into a single `meson.build`. This is not ideal in the long term though as it makes it difficult to reuse a subset of the modules.\r\n\r\nOne method would be to have a separate repository for the tuklib modules, each module having a `meson.build` snippet file. Then a script would take a list of modules to use and generate a single `meson.build` from the snippets (in the right order, handling possible dependencies). The downside is that each project using a different subset of the modules would end up with _a different generated build system file_ in the source package (simpler than `configure` but still).\r\n\r\nAnother idea could be to have a variable, for example, `tuklib_modules` which would contain a list of modules to use. Top-level `meson.build` would set that variable and then do `subdir(src/common/tuklib_meson)` which would further do `subdir(modulename123)` for each module name that was found in `tuklib_modules` (in dependency order).\r\n\r\nThis way the checks of each module would be in their own `meson.build` files. In the parent directory the `meson.build` file would list all modules, including those that a specific project doesn't need. It would be just a boring chain of if-subdir-endif lines in the correct order to satisfy possible cross-module dependencies. This way no generated files would be needed to use a subset of the modules in another project.\r\n\r\n(The if-subdir-endif file might still be a generated file in the module repository. However, it would be the same for all projects that use the modules, thus there wouldn't be as many versions of the generated file, making reviews easier.)\r\n\r\nThe set of tuklib modules is tiny so in this sense this is silly overthinking. But I'm curious how this would have to be done with bigger number of reusable modules (like Gnulib). It seems essential to split the per-module checks into separate files if there are tens of modules and different projects use a different set of modules. A per-project generated `meson.build` that contains checks for tens of modules sounds too similar to a generated `configure`. Avoiding such per-project generated files is a big reason why this Meson discussion in XZ Utils is happening in the first place.\r\n","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/2090846841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-05-02T15:44:09Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
