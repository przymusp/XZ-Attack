{"id":"35989619480","type":"IssueCommentEvent","actor":{"id":2996845,"login":"bokken","display_login":"bokken","gravatar_id":"","url":"https://api.github.com/users/bokken","avatar_url":"https://avatars.githubusercontent.com/u/2996845?"},"repo":{"id":553668398,"name":"tukaani-project/xz-java","url":"https://api.github.com/repos/tukaani-project/xz-java"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/tukaani-project/xz-java/issues/13","repository_url":"https://api.github.com/repos/tukaani-project/xz-java","labels_url":"https://api.github.com/repos/tukaani-project/xz-java/issues/13/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz-java/issues/13/comments","events_url":"https://api.github.com/repos/tukaani-project/xz-java/issues/13/events","html_url":"https://github.com/tukaani-project/xz-java/pull/13","id":2152921308,"node_id":"PR_kwDOIQBPLs5n2VAk","number":13,"title":"XZ compression improvements by optimizing array pattern matching","user":{"login":"bokken","id":2996845,"node_id":"MDQ6VXNlcjI5OTY4NDU=","avatar_url":"https://avatars.githubusercontent.com/u/2996845?v=4","gravatar_id":"","url":"https://api.github.com/users/bokken","html_url":"https://github.com/bokken","followers_url":"https://api.github.com/users/bokken/followers","following_url":"https://api.github.com/users/bokken/following{/other_user}","gists_url":"https://api.github.com/users/bokken/gists{/gist_id}","starred_url":"https://api.github.com/users/bokken/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bokken/subscriptions","organizations_url":"https://api.github.com/users/bokken/orgs","repos_url":"https://api.github.com/users/bokken/repos","events_url":"https://api.github.com/users/bokken/events{/privacy}","received_events_url":"https://api.github.com/users/bokken/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-02-25T20:10:22Z","updated_at":"2024-02-25T21:08:51Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tukaani-project/xz-java/pulls/13","html_url":"https://github.com/tukaani-project/xz-java/pull/13","diff_url":"https://github.com/tukaani-project/xz-java/pull/13.diff","patch_url":"https://github.com/tukaani-project/xz-java/pull/13.patch","merged_at":null},"body":"This is incremental changes to simplify code review process. This first set of changes introduces the array mismatch abstraction and initial changes using Unsafe to read unaligned longs for x86 and aarch64.\r\n\r\nThis is similar to https://github.com/tukaani-project/xz-java/pull/12, but presents a smaller set of changes to simplify review.\r\n\r\n## Pull request checklist\r\n\r\nPlease check if your PR fulfills the following requirements:\r\n- [ ] Tests for the changes have been added (for bug fixes / features)\r\n- [ ] Docs have been reviewed and added / updated if needed (for bug fixes / features)\r\n- [ ] Build was run locally and without warnings or errors\r\n- [ ] All previous and new tests pass\r\n\r\n\r\n## Pull request type\r\n\r\n<!-- Please try to limit your pull request to one type, submit multiple\r\npull requests if needed. --> \r\n\r\nPlease check the type of change your PR introduces:\r\n- [ ] Bugfix\r\n- [ ] Feature\r\n- [ ] Code style update (formatting, renaming, typo fix)\r\n- [ ] Refactoring (no functional changes, no api changes)\r\n- [ ] Build related changes\r\n- [ ] Documentation content changes\r\n- [ ] Other (please describe): \r\n\r\n\r\n## What is the current behavior?\r\n<!-- Please describe the current behavior that you are modifying. -->\r\n\r\n\r\n<!-- Related issue this PR addresses, if applicable -->\r\nRelated Issue URL: \r\n\r\n\r\n## What is the new behavior?\r\n<!-- Please describe the behavior or changes that are being added by this\r\nPR. -->\r\n\r\n-\r\n-\r\n-\r\n\r\n## Does this introduce a breaking change?\r\n\r\n- [ ] Yes\r\n- [ ] No\r\n\r\n<!-- If this introduces a breaking change, please describe the impact and\r\nmigration path for existing applications below. -->\r\n\r\n\r\n## Other information\r\n\r\n<!-- Any other information that is important to this PR. -->","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz-java/issues/13/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz-java/issues/13/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/tukaani-project/xz-java/issues/comments/1963062026","html_url":"https://github.com/tukaani-project/xz-java/pull/13#issuecomment-1963062026","issue_url":"https://api.github.com/repos/tukaani-project/xz-java/issues/13","id":1963062026,"node_id":"IC_kwDOIQBPLs51AfMK","user":{"login":"bokken","id":2996845,"node_id":"MDQ6VXNlcjI5OTY4NDU=","avatar_url":"https://avatars.githubusercontent.com/u/2996845?v=4","gravatar_id":"","url":"https://api.github.com/users/bokken","html_url":"https://github.com/bokken","followers_url":"https://api.github.com/users/bokken/followers","following_url":"https://api.github.com/users/bokken/following{/other_user}","gists_url":"https://api.github.com/users/bokken/gists{/gist_id}","starred_url":"https://api.github.com/users/bokken/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bokken/subscriptions","organizations_url":"https://api.github.com/users/bokken/orgs","repos_url":"https://api.github.com/users/bokken/repos","events_url":"https://api.github.com/users/bokken/events{/privacy}","received_events_url":"https://api.github.com/users/bokken/received_events","type":"User","site_admin":false},"created_at":"2024-02-25T21:08:50Z","updated_at":"2024-02-25T21:08:50Z","author_association":"NONE","body":"These benchmark results are from windows 11 13th Gen Intel(R) Core(TM) i7-1370P .\r\nThe 3 different files are:\r\nihe_ovly_pr.dcm is a acr/nema dicom format presentation state - sized ~66KB.\r\nimage1.dcm  is a acr/nema dicom formated uncompressed image sized ~26MB.\r\nlarge.xml is an xml file sized ~52MB.\r\n\r\nThey show regression of up to 10% for the \"legacy\"/compatibility case.\r\nThey show performance improvements ranging from ~0% -> ~30% depending on the content and preset level.\r\nIn general, preset 6 saw larger improvements than preset 3.\r\n\r\n\r\njdk 8\r\n```\r\nBenchmark                                             (file)  (preset)  Mode  Cnt     Score      Error  Units\r\nXZCompressionBenchmark.baseline              ihe_ovly_pr.dcm         3  avgt    3     0.598 ±    0.065  ms/op\r\nXZCompressionBenchmark.compress_legacy       ihe_ovly_pr.dcm         3  avgt    3     0.650 ±    0.195  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long  ihe_ovly_pr.dcm         3  avgt    3     0.545 ±    0.097  ms/op\r\nXZCompressionBenchmark.baseline              ihe_ovly_pr.dcm         6  avgt    3     2.848 ±    0.401  ms/op\r\nXZCompressionBenchmark.compress_legacy       ihe_ovly_pr.dcm         6  avgt    3     2.725 ±    0.242  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long  ihe_ovly_pr.dcm         6  avgt    3     1.866 ±    0.451  ms/op\r\nXZCompressionBenchmark.baseline                   image1.dcm         3  avgt    3  2036.300 ±   82.683  ms/op\r\nXZCompressionBenchmark.compress_legacy            image1.dcm         3  avgt    3  2136.215 ± 1500.816  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long       image1.dcm         3  avgt    3  1929.697 ±  678.446  ms/op\r\nXZCompressionBenchmark.baseline                   image1.dcm         6  avgt    3  4124.933 ±  773.943  ms/op\r\nXZCompressionBenchmark.compress_legacy            image1.dcm         6  avgt    3  4333.171 ±  576.123  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long       image1.dcm         6  avgt    3  3692.338 ±  162.947  ms/op\r\nXZCompressionBenchmark.baseline                    large.xml         3  avgt    3   760.670 ±  147.354  ms/op\r\nXZCompressionBenchmark.compress_legacy             large.xml         3  avgt    3   787.818 ±  127.012  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long        large.xml         3  avgt    3   694.098 ±   63.862  ms/op\r\nXZCompressionBenchmark.baseline                    large.xml         6  avgt    3  6601.508 ± 1201.524  ms/op\r\nXZCompressionBenchmark.compress_legacy             large.xml         6  avgt    3  7352.783 ± 1461.493  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long        large.xml         6  avgt    3  5279.845 ±  834.122  ms/op\r\n```\r\n\r\njdk 11\r\n```\r\nBenchmark                                             (file)  (preset)  Mode  Cnt      Score           Error  Units\r\nXZCompressionBenchmark.baseline              ihe_ovly_pr.dcm         3  avgt    3       0.590 ±        0.136  ms/op\r\nXZCompressionBenchmark.compress_legacy       ihe_ovly_pr.dcm         3  avgt    3       0.587 ±        0.106  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long  ihe_ovly_pr.dcm         3  avgt    3       0.542 ±        0.076  ms/op\r\nXZCompressionBenchmark.baseline              ihe_ovly_pr.dcm         6  avgt    3       2.914 ±        1.259  ms/op\r\nXZCompressionBenchmark.compress_legacy       ihe_ovly_pr.dcm         6  avgt    3       2.760 ±        0.254  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long  ihe_ovly_pr.dcm         6  avgt    3       1.933 ±        0.157  ms/op\r\nXZCompressionBenchmark.baseline                   image1.dcm         3  avgt    3    2113.911 ±      815.591  ms/op\r\nXZCompressionBenchmark.compress_legacy            image1.dcm         3  avgt    3    2197.521 ±     1398.848  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long       image1.dcm         3  avgt    3    2084.317 ±      904.885  ms/op\r\nXZCompressionBenchmark.baseline                   image1.dcm         6  avgt    3    4088.532 ±      847.937  ms/op\r\nXZCompressionBenchmark.compress_legacy            image1.dcm         6  avgt    3    4137.546 ±       88.137  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long       image1.dcm         6  avgt    3    3991.293 ±     1587.101  ms/op\r\nXZCompressionBenchmark.baseline                    large.xml         3  avgt    3     699.659 ±      270.399  ms/op\r\nXZCompressionBenchmark.compress_legacy             large.xml         3  avgt    3     707.156 ±      165.419  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long        large.xml         3  avgt    3     665.311 ±       36.397  ms/op\r\nXZCompressionBenchmark.baseline                    large.xml         6  avgt    3    6901.331 ±     9032.103  ms/op\r\nXZCompressionBenchmark.compress_legacy             large.xml         6  avgt    3    7338.866 ±     4002.768  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long        large.xml         6  avgt    3    5932.740 ±      383.178  ms/op\r\n```\r\n\r\njdk 17\r\n```\r\nBenchmark                                             (file)  (preset)  Mode  Cnt     Score      Error  Units\r\nXZCompressionBenchmark.baseline              ihe_ovly_pr.dcm         3  avgt    3     0.598 ±    0.029  ms/op\r\nXZCompressionBenchmark.compress_legacy       ihe_ovly_pr.dcm         3  avgt    3     0.606 ±    0.054  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long  ihe_ovly_pr.dcm         3  avgt    3     0.553 ±    0.247  ms/op\r\nXZCompressionBenchmark.baseline              ihe_ovly_pr.dcm         6  avgt    3     2.836 ±    0.701  ms/op\r\nXZCompressionBenchmark.compress_legacy       ihe_ovly_pr.dcm         6  avgt    3     2.820 ±    0.179  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long  ihe_ovly_pr.dcm         6  avgt    3     1.959 ±    0.431  ms/op\r\nXZCompressionBenchmark.baseline                   image1.dcm         3  avgt    3  2116.691 ±  743.495  ms/op\r\nXZCompressionBenchmark.compress_legacy            image1.dcm         3  avgt    3  2268.474 ±  667.310  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long       image1.dcm         3  avgt    3  2150.507 ± 1549.747  ms/op\r\nXZCompressionBenchmark.baseline                   image1.dcm         6  avgt    3  4144.431 ± 1380.345  ms/op\r\nXZCompressionBenchmark.compress_legacy            image1.dcm         6  avgt    3  4481.542 ± 1059.997  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long       image1.dcm         6  avgt    3  4044.453 ±  461.817  ms/op\r\nXZCompressionBenchmark.baseline                    large.xml         3  avgt    3   739.495 ±  166.726  ms/op\r\nXZCompressionBenchmark.compress_legacy             large.xml         3  avgt    3   734.365 ±  137.722  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long        large.xml         3  avgt    3   684.531 ±   89.739  ms/op\r\nXZCompressionBenchmark.baseline                    large.xml         6  avgt    3  6847.095 ±  904.741  ms/op\r\nXZCompressionBenchmark.compress_legacy             large.xml         6  avgt    3  7686.943 ± 2843.518  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long        large.xml         6  avgt    3  5957.280 ±  338.260  ms/op\r\n```\r\n\r\njdk 21\r\n```\r\nBenchmark                                             (file)  (preset)  Mode  Cnt     Score      Error  Units\r\nXZCompressionBenchmark.baseline              ihe_ovly_pr.dcm         3  avgt    3     0.589 ┬▒    0.064  ms/op\r\nXZCompressionBenchmark.compress_legacy       ihe_ovly_pr.dcm         3  avgt    3     0.578 ┬▒    0.264  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long  ihe_ovly_pr.dcm         3  avgt    3     0.543 ┬▒    0.068  ms/op\r\nXZCompressionBenchmark.baseline              ihe_ovly_pr.dcm         6  avgt    3     2.842 ┬▒    2.348  ms/op\r\nXZCompressionBenchmark.compress_legacy       ihe_ovly_pr.dcm         6  avgt    3     2.637 ┬▒    0.621  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long  ihe_ovly_pr.dcm         6  avgt    3     1.860 ┬▒    0.137  ms/op\r\nXZCompressionBenchmark.baseline                   image1.dcm         3  avgt    3  2013.813 ┬▒ 2111.947  ms/op\r\nXZCompressionBenchmark.compress_legacy            image1.dcm         3  avgt    3  2022.160 ┬▒  244.838  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long       image1.dcm         3  avgt    3  2079.494 ┬▒  559.869  ms/op\r\nXZCompressionBenchmark.baseline                   image1.dcm         6  avgt    3  4200.710 ┬▒  559.429  ms/op\r\nXZCompressionBenchmark.compress_legacy            image1.dcm         6  avgt    3  4318.551 ┬▒  224.317  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long       image1.dcm         6  avgt    3  4000.231 ┬▒  122.133  ms/op\r\nXZCompressionBenchmark.baseline                    large.xml         3  avgt    3   741.106 ┬▒  304.118  ms/op\r\nXZCompressionBenchmark.compress_legacy             large.xml         3  avgt    3   762.184 ┬▒  193.266  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long        large.xml         3  avgt    3   707.872 ┬▒  217.096  ms/op\r\nXZCompressionBenchmark.baseline                    large.xml         6  avgt    3  6644.706 ┬▒   71.733  ms/op\r\nXZCompressionBenchmark.compress_legacy             large.xml         6  avgt    3  7490.776 ┬▒ 1352.132  ms/op\r\nXZCompressionBenchmark.compress_unsafe_long        large.xml         6  avgt    3  5125.599 ┬▒  723.249  ms/op\r\n```","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz-java/issues/comments/1963062026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-02-25T21:08:51Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
