{"id":"37148370934","type":"IssueCommentEvent","actor":{"id":79667753,"login":"aikooo7","display_login":"aikooo7","gravatar_id":"","url":"https://api.github.com/users/aikooo7","avatar_url":"https://avatars.githubusercontent.com/u/79667753?"},"repo":{"id":4542716,"name":"NixOS/nixpkgs","url":"https://api.github.com/repos/NixOS/nixpkgs"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/NixOS/nixpkgs/issues/300055","repository_url":"https://api.github.com/repos/NixOS/nixpkgs","labels_url":"https://api.github.com/repos/NixOS/nixpkgs/issues/300055/labels{/name}","comments_url":"https://api.github.com/repos/NixOS/nixpkgs/issues/300055/comments","events_url":"https://api.github.com/repos/NixOS/nixpkgs/issues/300055/events","html_url":"https://github.com/NixOS/nixpkgs/issues/300055","id":2215862146,"node_id":"I_kwDOAEVQ_M6EE1-C","number":300055,"title":"xz-5.6.x is trojaned","user":{"login":"dfoxfranke","id":4708206,"node_id":"MDQ6VXNlcjQ3MDgyMDY=","avatar_url":"https://avatars.githubusercontent.com/u/4708206?v=4","gravatar_id":"","url":"https://api.github.com/users/dfoxfranke","html_url":"https://github.com/dfoxfranke","followers_url":"https://api.github.com/users/dfoxfranke/followers","following_url":"https://api.github.com/users/dfoxfranke/following{/other_user}","gists_url":"https://api.github.com/users/dfoxfranke/gists{/gist_id}","starred_url":"https://api.github.com/users/dfoxfranke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dfoxfranke/subscriptions","organizations_url":"https://api.github.com/users/dfoxfranke/orgs","repos_url":"https://api.github.com/users/dfoxfranke/repos","events_url":"https://api.github.com/users/dfoxfranke/events{/privacy}","received_events_url":"https://api.github.com/users/dfoxfranke/received_events","type":"User","site_admin":false},"labels":[{"id":6314750,"node_id":"MDU6TGFiZWw2MzE0NzUw","url":"https://api.github.com/repos/NixOS/nixpkgs/labels/0.kind:%20bug","name":"0.kind: bug","color":"84b6eb","default":false,"description":null},{"id":126506420,"node_id":"MDU6TGFiZWwxMjY1MDY0MjA=","url":"https://api.github.com/repos/NixOS/nixpkgs/labels/1.severity:%20security","name":"1.severity: security","color":"e11d21","default":false,"description":null}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":52,"created_at":"2024-03-29T18:52:54Z","updated_at":"2024-04-04T01:56:46Z","closed_at":null,"author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"See https://www.openwall.com/lists/oss-security/2024/03/29/4.\r\n\r\nThe trojaned source package is not in 23.11 but has been in unstable since https://github.com/NixOS/nixpkgs/commit/5c7c19cc7ef416b2f4a154263c6d04a50bbac86c. I'm trying to verify whether NixOS users are impacted by the exploit. I think we may be okay because NixOS doesn't have the openssh patch for systemd notification, and therefore openssh has no hook into liblzma.","reactions":{"url":"https://api.github.com/repos/NixOS/nixpkgs/issues/300055/reactions","total_count":119,"+1":118,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/NixOS/nixpkgs/issues/300055/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/NixOS/nixpkgs/issues/comments/2035994897","html_url":"https://github.com/NixOS/nixpkgs/issues/300055#issuecomment-2035994897","issue_url":"https://api.github.com/repos/NixOS/nixpkgs/issues/300055","id":2035994897,"node_id":"IC_kwDOAEVQ_M55WtER","user":{"login":"aikooo7","id":79667753,"node_id":"MDQ6VXNlcjc5NjY3NzUz","avatar_url":"https://avatars.githubusercontent.com/u/79667753?v=4","gravatar_id":"","url":"https://api.github.com/users/aikooo7","html_url":"https://github.com/aikooo7","followers_url":"https://api.github.com/users/aikooo7/followers","following_url":"https://api.github.com/users/aikooo7/following{/other_user}","gists_url":"https://api.github.com/users/aikooo7/gists{/gist_id}","starred_url":"https://api.github.com/users/aikooo7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikooo7/subscriptions","organizations_url":"https://api.github.com/users/aikooo7/orgs","repos_url":"https://api.github.com/users/aikooo7/repos","events_url":"https://api.github.com/users/aikooo7/events{/privacy}","received_events_url":"https://api.github.com/users/aikooo7/received_events","type":"User","site_admin":false},"created_at":"2024-04-04T01:56:45Z","updated_at":"2024-04-04T01:56:45Z","author_association":"CONTRIBUTOR","body":"> in reply\r\n> \r\n> [to above](https://github.com/NixOS/nixpkgs/issues/300055#issuecomment-2034546410)\r\n> \r\n> I put the following in `/etc/nixos/configuration.nix`:\r\n> \r\n> ```nix\r\n>     #initially from: https://github.com/NixOS/nixpkgs/issues/300055#issuecomment-2034546410\r\n>     system.replaceRuntimeDependencies = [({\r\n>         original = pkgs.xz;\r\n>         replacement = pkgs.xz.overrideAttrs (finalAttrs: prevAttrs: {\r\n>         #(rec {\r\n>             version = \"5.4.6\";\r\n>             src = pkgs.fetchurl {\r\n>             url = with finalAttrs;\r\n>             # The original URL has been taken down.\r\n>             # \"https://github.com/tukaani-project/xz/releases/download/v${version}/xz-${version}.tar.bz2\";\r\n>             \"mirror://sourceforge/lzmautils/xz-5.4.6.tar.bz2\";\r\n>             sha256 = \"sha256-kThRsnTo4dMXgeyUnxwj6NvPDs9uc6JDbcIXad0+b0k=\";\r\n>             };\r\n> \r\n> #Can't use this due to no Makefile or something like that:                                                \r\n> #            src = pkgs.fetchgit {\r\n> #            url = \"https://git.tukaani.org/xz.git\";\r\n> #            rev = \"v${finalAttrs.version}\";\r\n> #            hash = \"sha256-uMUwR1I42R4hip5bJ1KOBKLZd9bb683z7xKeyB3M1Qg=\";\r\n> #            };\r\n>             });\r\n>         })];\r\n> ```\r\n> \r\n> (note that I can use `${finalAttrs.version}` in the `url` instead, and/or can use `rec` instead of `finalAttrs: prevAttrs:`, it won't change anything, I just tried it with hardcoded `5.4.6` last time to be sure)\r\n> \r\n> It did something for 3 minutes after `# nixos-rebuild switch` the first time I tried it, but how do I know it worked?\r\n> \r\n> Thanks.\r\n\r\nHey using your config with flake.nix I get:\r\n\r\nerror:\r\n       … while calling the 'head' builtin\r\n\r\n         at /nix/store/wx38bcq0bi8xhia8yq21syxlkf65fk4j-source/lib/attrsets.nix:1541:11:\r\n\r\n         1540|         || pred here (elemAt values 1) (head values) then\r\n         1541|           head values\r\n             |           ^\r\n         1542|         else\r\n\r\n       … while evaluating the attribute 'value'\r\n\r\n         at /nix/store/wx38bcq0bi8xhia8yq21syxlkf65fk4j-source/lib/modules.nix:809:9:\r\n\r\n          808|     in warnDeprecation opt //\r\n          809|       { value = builtins.addErrorContext \"while evaluating the option `${showOption loc}':\" value;\r\n             |         ^\r\n          810|         inherit (res.defsFinal') highestPrio;\r\n\r\n       (stack trace truncated; use '--show-trace' to show the full trace)\r\n\r\n       error: 'builtins.storePath' is not allowed in pure evaluation mode\r\n\r\n       at «none»:0: (source not available)","reactions":{"url":"https://api.github.com/repos/NixOS/nixpkgs/issues/comments/2035994897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-04-04T01:56:46Z","org":{"id":487568,"login":"NixOS","gravatar_id":"","url":"https://api.github.com/orgs/NixOS","avatar_url":"https://avatars.githubusercontent.com/u/487568?"}}
