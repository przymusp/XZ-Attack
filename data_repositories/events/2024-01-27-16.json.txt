{"id":"35171164857","type":"CreateEvent","actor":{"id":78042786,"login":"JiaT75","display_login":"JiaT75","gravatar_id":"","url":"https://api.github.com/users/JiaT75","avatar_url":"https://avatars.githubusercontent.com/u/78042786?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"ref":"arm64_crc32","ref_type":"branch","master_branch":"master","description":"XZ Utils","pusher_type":"user"},"public":true,"created_at":"2024-01-27T16:05:38Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
{"id":"35171224807","type":"PushEvent","actor":{"id":78042786,"login":"JiaT75","display_login":"JiaT75","gravatar_id":"","url":"https://api.github.com/users/JiaT75","avatar_url":"https://avatars.githubusercontent.com/u/78042786?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"repository_id":553665726,"push_id":16821562248,"size":8,"distinct_size":8,"ref":"refs/heads/arm64_crc32","head":"942059980d41bee68c3f660a3981190a7e3ee0e0","before":"e9418d318358f79dc47b2720f56cfa33757bb5b9","commits":[{"sha":"010a9d14c3bcbb0eb9c5db7fdefeb1a290f1b069","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"Build: Add support for ARM64 CRC32 instruction detection.\n\nThis adds --enable_arm64_crc32/--disable_arm64_crc32 (enabled by\ndefault) for using the ARM64 CRC32 instruction. This can be disabled if\none knows the binary will never need to run on an ARM64 machine\nwith this instruction extension.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/010a9d14c3bcbb0eb9c5db7fdefeb1a290f1b069"},{"sha":"2d4f5b1d8668faab8c6e9cac8c85e0bf2dd92b58","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"CMake: Add support for ARM64 CRC32 instruction detection.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/2d4f5b1d8668faab8c6e9cac8c85e0bf2dd92b58"},{"sha":"668463637f014d65e86f27eb701dd7951dd31946","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"liblzma: Refactor crc_common.h.\n\nThe CRC_GENERIC is now split into CRC32_GENERIC and CRC64_GENERIC, since\nthe ARM64 optimizations will be different between CRC32 and CRC64.\n\nFor the same reason, CRC_ARCH_OPTIMIZED is split into\nCRC32_ARCH_OPTIMIZED and CRC64_ARCH_OPTIMIZED.\n\nifunc will only be used with x86-64 CLMUL because the runtime detection\nmethods needed with ARM64 are not compatible with ifunc.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/668463637f014d65e86f27eb701dd7951dd31946"},{"sha":"582a34da98ff94acecf41f80260bc8320f497d79","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"liblzma: Rename crc32_aarch64.h to crc32_arm64.h.\n\nEven though the proper name for the architecture is aarch64, this\nproject uses ARM64 throughout. So the rename is for consistency.\n\nAdditionally, crc32_arm64.h was slightly refactored for the following\nchanges:\n\n   * Added MSVC and FreeBSD support for is_arch_extension_supported().\n\n   * crc32_arch_optimized() now checks the size when aligning the\n     buffer.\n\n   * crc32_arch_optimized() loop conditions were slightly modified to\n     avoid both decrementing the size and incrementing the buffer\n     pointer .\n\n   * Use the intrinsic wrappers defined in <arm_acle.h> because GCC and\n     Clang name them differently.\n\n   * Minor spacing and comment changes.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/582a34da98ff94acecf41f80260bc8320f497d79"},{"sha":"f923675d96e7719cf6cee66f4896ef17e63bbb36","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"liblzma: Omit CRC tables when not needed with ARM64 optimizations.\n\nThis is similar to the existing x86-64 CLMUL conditions to omit the\ntables. They were slightly refactored to improve readability.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/f923675d96e7719cf6cee66f4896ef17e63bbb36"},{"sha":"52b6c4158a74a5e1b410a02a5485c86eb04ee126","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"Docs: Add --disable-arm64-crc32 description to INSTALL.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/52b6c4158a74a5e1b410a02a5485c86eb04ee126"},{"sha":"d6c345176bbd1f433bd6c03fdc2da388157ac93d","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"liblzma: Only use ifunc in crcXX_fast.c if its needed.\n\nThe code was using HAVE_FUNC_ATTRIBUTE_IFUNC instead of CRC_USE_IFUNC.\nWith ARM64, ifunc cannot be used because it requires non-inline\nfunction calls for runtime detection.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/d6c345176bbd1f433bd6c03fdc2da388157ac93d"},{"sha":"942059980d41bee68c3f660a3981190a7e3ee0e0","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"liblzma: Check HAVE_USABLE_CLMUL before omitting CRC tables.\n\nIf liblzma is configured with --disable-clmul-crc\nCFLAGS=\"-msse4.1 -mpclmul\", then it will fail to compile because the\ngeneric version must be used but the CRC tables were not included.","distinct":true,"url":"https://api.github.com/repos/tukaani-project/xz/commits/942059980d41bee68c3f660a3981190a7e3ee0e0"}]},"public":true,"created_at":"2024-01-27T16:12:13Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
{"id":"35171295017","type":"IssueCommentEvent","actor":{"id":78042786,"login":"JiaT75","display_login":"JiaT75","gravatar_id":"","url":"https://api.github.com/users/JiaT75","avatar_url":"https://avatars.githubusercontent.com/u/78042786?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/77","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/77/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/77/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/77/events","html_url":"https://github.com/tukaani-project/xz/pull/77","id":2071987912,"node_id":"PR_kwDOIQBEvs5jjrrh","number":77,"title":"Speed up CRC32 calculation on ARM64","user":{"login":"parheliamm","id":3759678,"node_id":"MDQ6VXNlcjM3NTk2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/3759678?v=4","gravatar_id":"","url":"https://api.github.com/users/parheliamm","html_url":"https://github.com/parheliamm","followers_url":"https://api.github.com/users/parheliamm/followers","following_url":"https://api.github.com/users/parheliamm/following{/other_user}","gists_url":"https://api.github.com/users/parheliamm/gists{/gist_id}","starred_url":"https://api.github.com/users/parheliamm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/parheliamm/subscriptions","organizations_url":"https://api.github.com/users/parheliamm/orgs","repos_url":"https://api.github.com/users/parheliamm/repos","events_url":"https://api.github.com/users/parheliamm/events{/privacy}","received_events_url":"https://api.github.com/users/parheliamm/received_events","type":"User","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2024-01-09T09:38:00Z","updated_at":"2024-01-27T16:20:00Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/tukaani-project/xz/pulls/77","html_url":"https://github.com/tukaani-project/xz/pull/77","diff_url":"https://github.com/tukaani-project/xz/pull/77.diff","patch_url":"https://github.com/tukaani-project/xz/pull/77.patch","merged_at":null},"body":"The CRC32 instructions in ARM64 can calculate the CRC32 result for 8 bytes in a single operation, making the use of ARM64 instructions much faster compared to the general CRC32 algorithm.\r\n\r\nOptimized CRC32 will be enabled if ARM64 has CRC extension running on Linux.\r\n\r\n## Pull request checklist\r\n\r\nPlease check if your PR fulfills the following requirements:\r\n\r\n- [ ] Tests for the changes have been added (for bug fixes / features)\r\n- [ ] Docs have been reviewed and added / updated if needed (for bug fixes / features)\r\n- [x] Build was run locally and without warnings or errors\r\n- [ ] All previous and new tests pass\r\n\r\n\r\n## Pull request type\r\n\r\n<!-- Please try to limit your pull request to one type, submit multiple\r\npull requests if needed. --> \r\n\r\nPlease check the type of change your PR introduces:\r\n\r\n- [ ] Bugfix\r\n- [x] Feature\r\n- [ ] Code style update (formatting, renaming, typo fix)\r\n- [ ] Refactoring (no functional changes, no api changes)\r\n- [ ] Build related changes\r\n- [ ] Documentation content changes\r\n- [ ] Other (please describe): \r\n\r\n\r\n## What is the current behavior?\r\n\r\n<!-- Please describe the current behavior that you are modifying. -->\r\n\r\n\r\n<!-- Related issue this PR addresses, if applicable -->\r\nRelated Issue URL: \r\n\r\n\r\n## What is the new behavior?\r\n\r\n<!-- Please describe the behavior or changes that are being added by this\r\nPR. -->\r\n\r\n- Enable optimized CRC32 algorithm if ARM64 support CRC extension.\r\n  -\r\n  -\r\n\r\n## Does this introduce a breaking change?\r\n\r\n- [ ] Yes\r\n- [ ] No\r\n\r\n<!-- If this introduces a breaking change, please describe the impact and\r\nmigration path for existing applications below. -->\r\n\r\n\r\n## Other information\r\n\r\nBenchmark data will be updated soon","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/77/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/77/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/1913236380","html_url":"https://github.com/tukaani-project/xz/pull/77#issuecomment-1913236380","issue_url":"https://api.github.com/repos/tukaani-project/xz/issues/77","id":1913236380,"node_id":"IC_kwDOIQBEvs5yCauc","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"created_at":"2024-01-27T16:19:58Z","updated_at":"2024-01-27T16:19:58Z","author_association":"MEMBER","body":"@parheliamm @hansjans162 Thank you for your patience on this review. We had a few other things we were focusing on (new website, release, etc.). I promise I did not forget about this :)\r\n\r\nI created a [branch](https://github.com/tukaani-project/xz/tree/arm64_crc32) with some additions to this PR that will also be helpful for the CRC64 CLMUL. The extent of the edits should be clear from the commit messages and code changes, but let me know if you have questions about the changes.\r\n\r\nCan you both test this on your hardware to be sure it works correctly (and is still fast)? I was able to cross-compile it with GCC, Clang, and MSVC but I do not have an ARM64 device so I have not run the code. Thanks!","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/1913236380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-01-27T16:20:00Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
