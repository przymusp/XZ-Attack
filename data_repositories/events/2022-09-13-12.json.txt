{"id":"23977313259","type":"PushEvent","actor":{"id":78042786,"login":"JiaT75","display_login":"JiaT75","gravatar_id":"","url":"https://api.github.com/users/JiaT75","avatar_url":"https://avatars.githubusercontent.com/u/78042786?"},"repo":{"id":453091377,"name":"JiaT75/XZ_Utils_Unofficial","url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial"},"payload":{"push_id":11008116407,"size":10,"distinct_size":1,"ref":"refs/heads/cmake_xz_scripts","head":"184aab4fb245da30eefb21a1dfaad647cd60ab83","before":"0557a51a0e6cb543cc778dc5d90a5cbadbe0aa8d","commits":[{"sha":"a4193bb6d85d7765b1b87faeab3e50106d3ab2e9","author":{"email":"lasse.collin@tukaani.org","name":"Lasse Collin"},"message":"CMake: Put xz man page install under if(UNIX) like is for xzdec.\n\nThanks to Jia Tan.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/a4193bb6d85d7765b1b87faeab3e50106d3ab2e9"},{"sha":"80a1a8bb838842a2be343bd88ad1462c21c5e2c9","author":{"email":"lasse.collin@tukaani.org","name":"Lasse Collin"},"message":"CMake: Add xz symlinks.\n\nThese are a minor thing especially since the xz build has\nsome real problems still like lack of large file support\non 32-bit systems but I'll commit this since the code exists.\n\nThanks to Jia Tan.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/80a1a8bb838842a2be343bd88ad1462c21c5e2c9"},{"sha":"913ddc5572b9455fa0cf299be2e35c708840e922","author":{"email":"lasse.collin@tukaani.org","name":"Lasse Collin"},"message":"liblzma: Vaccinate against an ill patch from RHEL/CentOS 7.\n\nRHEL/CentOS 7 shipped with 5.1.2alpha, including the threaded\nencoder that is behind #ifdef LZMA_UNSTABLE in the API headers.\nIn 5.1.2alpha these symbols are under XZ_5.1.2alpha in liblzma.map.\nAPI/ABI compatibility tracking isn't done between development\nreleases so newer releases didn't have XZ_5.1.2alpha anymore.\n\nLater RHEL/CentOS 7 updated xz to 5.2.2 but they wanted to keep\nthe exported symbols compatible with 5.1.2alpha. After checking\nthe ABI changes it turned out that >= 5.2.0 ABI is backward\ncompatible with the threaded encoder functions from 5.1.2alpha\n(but not vice versa as fixes and extensions to these functions\nwere made between 5.1.2alpha and 5.2.0).\n\nIn RHEL/CentOS 7, XZ Utils 5.2.2 was patched with\nxz-5.2.2-compat-libs.patch to modify liblzma.map:\n\n  - XZ_5.1.2alpha was added with lzma_stream_encoder_mt and\n    lzma_stream_encoder_mt_memusage. This matched XZ Utils 5.1.2alpha.\n\n  - XZ_5.2 was replaced with XZ_5.2.2. It is clear that this was\n    an error; the intention was to keep using XZ_5.2 (XZ_5.2.2\n    has never been used in XZ Utils). So XZ_5.2.2 lists all\n    symbols that were listed under XZ_5.2 before the patch.\n    lzma_stream_encoder_mt and _mt_memusage are included too so\n    they are listed both here and under XZ_5.1.2alpha.\n\nThe patch didn't add any __asm__(\".symver ...\") lines to the .c\nfiles. Thus the resulting liblzma.so exports the threaded encoder\nfunctions under XZ_5.1.2alpha only. Listing the two functions\nalso under XZ_5.2.2 in liblzma.map has no effect without\nmatching .symver lines.\n\nThe lack of XZ_5.2 in RHEL/CentOS 7 means that binaries linked\nagainst unpatched XZ Utils 5.2.x won't run on RHEL/CentOS 7.\nThis is unfortunate but this alone isn't too bad as the problem\nis contained within RHEL/CentOS 7 and doesn't affect users\nof other distributions. It could also be fixed internally in\nRHEL/CentOS 7.\n\nThe second problem is more serious: In XZ Utils 5.2.2 the API\nheaders don't have #ifdef LZMA_UNSTABLE for obvious reasons.\nThis is true in RHEL/CentOS 7 version too. Thus now programs\nusing new APIs can be compiled without an extra #define. However,\nthe programs end up depending on symbol version XZ_5.1.2alpha\n(and possibly also XZ_5.2.2) instead of XZ_5.2 as they would\nwith an unpatched XZ Utils 5.2.2. This means that such binaries\nwon't run on other distributions shipping XZ Utils >= 5.2.0 as\nthey don't provide XZ_5.1.2alpha or XZ_5.2.2; they only provide\nXZ_5.2 (and XZ_5.0). (This includes RHEL/CentOS 8 as the patch\nluckily isn't included there anymore with XZ Utils 5.2.4.)\n\nBinaries built by RHEL/CentOS 7 users get distributed and then\npeople wonder why they don't run on some other distribution.\nSeems that people have found out about the patch and been copying\nit to some build scripts, seemingly curing the symptoms but\nactually spreading the illness further and outside RHEL/CentOS 7.\n\nThe ill patch seems to be from late 2016 (RHEL 7.3) and in 2017 it\nhad spread at least to EasyBuild. I heard about the events only\nrecently. :-(\n\nThis commit splits liblzma.map into two versions: one for\nGNU/Linux and another for other OSes that can use symbol versioning\n(FreeBSD, Solaris, maybe others). The Linux-specific file and the\nmatching additions to .c files add full compatibility with binaries\nthat have been built against a RHEL/CentOS-patched liblzma. Builds\nfor OSes other than GNU/Linux won't get the vaccine as they should\nbe immune to the problem (I really hope that no build script uses\nthe RHEL/CentOS 7 patch outside GNU/Linux).\n\nThe RHEL/CentOS compatibility symbols XZ_5.1.2alpha and XZ_5.2.2\nare intentionally put *after* XZ_5.2 in liblzma_linux.map. This way\nif one forgets to #define HAVE_SYMBOL_VERSIONS_LINUX when building,\nthe resulting liblzma.so.5 will have lzma_stream_encoder_mt@@XZ_5.2\nsince XZ_5.2 {...} is the first one that lists that function.\nWithout HAVE_SYMBOL_VERSIONS_LINUX @XZ_5.1.2alpha and @XZ_5.2.2\nwill be missing but that's still a minor problem compared to\nonly having lzma_stream_encoder_mt@@XZ_5.1.2alpha!\n\nThe \"local: *;\" line was moved to XZ_5.0 so that it doesn't need\nto be moved around. It doesn't matter where it is put.\n\nHaving two similar liblzma_*.map files is a bit silly as it is,\nat least for now, easily possible to generate the generic one\nfrom the Linux-specific file. But that adds extra steps and\nincreases the risk of mistakes when supporting more than one\nbuild system. So I rather maintain two files in parallel and let\nvalidate_map.sh check that they are in sync when \"make mydist\"\nis run.\n\nThis adds .symver lines for lzma_stream_encoder_mt@XZ_5.2.2 and\nlzma_stream_encoder_mt_memusage@XZ_5.2.2 even though these\nweren't exported by RHEL/CentOS 7 (only @@XZ_5.1.2alpha was\nfor these two). I added these anyway because someone might\nmisunderstand the RHEL/CentOS 7 patch and think that @XZ_5.2.2\n(@@XZ_5.2.2) versions were exported too.\n\nAt glance one could suggest using __typeof__ to copy the function\nprototypes when making aliases. However, this doesn't work trivially\nbecause __typeof__ won't copy attributes (lzma_nothrow, lzma_pure)\nand it won't change symbol visibility from hidden to default (done\nby LZMA_API()). Attributes could be copied with __copy__ attribute\nbut that needs GCC 9 and a fallback method would be needed anyway.\n\nThis uses __symver__ attribute with GCC >= 10 and\n__asm__(\".symver ...\") with everything else. The attribute method\nis required for LTO (-flto) support with GCC. Using -flto with\nGCC older than 10 is now broken on GNU/Linux and will not be fixed\n(can silently result in a broken liblzma build that has dangerously\nincorrect symbol versions). LTO builds with Clang seem to work\nwith the traditional __asm__(\".symver ...\") method.\n\nThanks to Boud Roukema for reporting the problem and discussing\nthe details and testing the fix.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/913ddc5572b9455fa0cf299be2e35c708840e922"},{"sha":"17485e884ce5c74315f29a8a1507bc706cd5cd1d","author":{"email":"lasse.collin@tukaani.org","name":"Lasse Collin"},"message":"CMake: Update for liblzma_*.map files and fix wrong common_w32res.rc dep.\n\nThe previous commit split liblzma.map into liblzma_linux.map and\nliblzma_generic.map. This commit updates the CMake build for those.\n\ncommon_w32res.rc dependency was listed under Linux/FreeBSD while\nobviously it belongs to Windows when building a DLL.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/17485e884ce5c74315f29a8a1507bc706cd5cd1d"},{"sha":"ba3e4ba2de034ae93a513f9c3a0823b80cdb66dc","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"CMake: Clarify a comment about Windows symlinks without file extension.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/ba3e4ba2de034ae93a513f9c3a0823b80cdb66dc"},{"sha":"9ac06cb5b85274d18f9f70d82cf2d8c9c1151bd4","author":{"email":"lasse.collin@tukaani.org","name":"Lasse Collin"},"message":"Update THANKS.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/9ac06cb5b85274d18f9f70d82cf2d8c9c1151bd4"},{"sha":"18d7facd3802b55c287581405c4d49c98708c136","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"liblzma: lzma_index_append: Add missing integer overflow check.\n\nThe documentation in src/liblzma/api/lzma/index.h suggests that\nboth the unpadded (compressed) size and the uncompressed size\nare checked for overflow, but only the unpadded size was checked.\nThe uncompressed check is done first since that is more likely to\noccur than the unpadded or index field size overflows.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/18d7facd3802b55c287581405c4d49c98708c136"},{"sha":"f8ee61e74eb40600445fdb601c374d582e1e9c8a","author":{"email":"lasse.collin@tukaani.org","name":"Lasse Collin"},"message":"liblzma: lzma_filters_copy: Keep dest[] unmodified if an error occurs.\n\nlzma_stream_encoder() and lzma_stream_encoder_mt() always assumed\nthis. Before this patch, failing lzma_filters_copy() could result\nin free(invalid_pointer) or invalid memory reads in stream_encoder.c\nor stream_encoder_mt.c.\n\nTo trigger this, allocating memory for a filter options structure\nhas to fail. These are tiny allocations so in practice they very\nrarely fail.\n\nCertain badness in the filter chain array could also make\nlzma_filters_copy() fail but both stream_encoder.c and\nstream_encoder_mt.c validate the filter chain before\ntrying to copy it, so the crash cannot occur this way.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/f8ee61e74eb40600445fdb601c374d582e1e9c8a"},{"sha":"f2d084fe3f0d6d71488bfc6987f26542f67bfd99","author":{"email":"lasse.collin@tukaani.org","name":"Lasse Collin"},"message":"Tests: Silence warnings about unused functions from tuktest.h.\n\nWarnings about unused tuktest_run_test conveniently tell which\ntest programs haven't been converted to tuktest.h yet but I\nsilenced that warning too for now anyway.\n\nIt is fine to use __attribute__((__unused__)) even when the\nfunction is actually used because the attribute only means\nthat the function might be unused.","distinct":false,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/f2d084fe3f0d6d71488bfc6987f26542f67bfd99"},{"sha":"184aab4fb245da30eefb21a1dfaad647cd60ab83","author":{"email":"jiat0218@gmail.com","name":"Jia Tan"},"message":"Merge branch 'master' into cmake_xz_scripts","distinct":true,"url":"https://api.github.com/repos/JiaT75/XZ_Utils_Unofficial/commits/184aab4fb245da30eefb21a1dfaad647cd60ab83"}]},"public":true,"created_at":"2022-09-13T12:39:26Z"}
