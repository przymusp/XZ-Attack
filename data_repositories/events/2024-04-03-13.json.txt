{"id":"37126666293","type":"PullRequestReviewEvent","actor":{"id":31354670,"login":"jonathanmetzman","display_login":"jonathanmetzman","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","avatar_url":"https://avatars.githubusercontent.com/u/31354670?"},"repo":{"id":63809205,"name":"google/oss-fuzz","url":"https://api.github.com/repos/google/oss-fuzz"},"payload":{"action":"created","review":{"id":1518981986,"node_id":"PRR_kwDOA82mtc5aidNi","user":{"login":"jonathanmetzman","id":31354670,"node_id":"MDQ6VXNlcjMxMzU0Njcw","avatar_url":"https://avatars.githubusercontent.com/u/31354670?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","html_url":"https://github.com/jonathanmetzman","followers_url":"https://api.github.com/users/jonathanmetzman/followers","following_url":"https://api.github.com/users/jonathanmetzman/following{/other_user}","gists_url":"https://api.github.com/users/jonathanmetzman/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanmetzman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanmetzman/subscriptions","organizations_url":"https://api.github.com/users/jonathanmetzman/orgs","repos_url":"https://api.github.com/users/jonathanmetzman/repos","events_url":"https://api.github.com/users/jonathanmetzman/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanmetzman/received_events","type":"User","site_admin":false},"body":"UPDATE:\r\nThere is no backdoor in this patch.\r\nThis repo provides a testing service to open source developers to help them find bugs in their code.\r\nWe allow developers to control 100% of what gets tested by our service. They own the code they submit to us, our reviews only mean we verified this is a project maintainer, which unfortunately, \"Jia Tan\" was. \r\nIf they don't want code tested, an automated tool like this can't stop them and was never intended to.\r\n\r\nOSS-Fuzz could not find the backdoor and never would have even if this patch was not accepted. The patch disabled testing of a feature (ifuncs) due to an actual [bug in ASAN when using ifuncs](https://github.com/google/sanitizers/issues/342).\r\nIt is totally normal for developers to disable/change testing due to false positives. If this PR was not accepted the build would have remained broken and OSS-Fuzz would have only tested XZ's code from before the ifuncs change.\r\nBut even if the ifunc code was tested in OSS-Fuzz, the backdoor would not be discoverable because the backdoor was only included in deb or RPM builds of XZ, which OSS-Fuzz has never done.\r\n\r\nFinally, OSS-Fuzz is not impacted by the backdoor, because the backdoor never ran on OSS-Fuzz. In addition, OSS-Fuzz runs code in a sandboxed environment so malicious developers/projects cannot harm OSS-Fuzz.\r\n\r\nUPDATE 2:\r\nI wanted to highlight the half-dozen reasons why the backdoor would never have been discovered by OSS-Fuzz. It's totally implausible that it would have been discovered here.\r\n\r\n1. This pull request fixed a build breakage caused by a compiler issue. The compiler issue was never fixed, so without this pull request, OSS-Fuzz would have never fuzzed an XZ version after June.\r\n2. The XZ backdoor only built in the tarballs included in the 5.6.0 and 5.6.1 branches and not in the master branch of the git repo that OSS-Fuzz was cloning.\r\n3. The XZ backdoor was only built when using build options for DEB or RPM packages. OSS-Fuzz was using neither: https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=Running%20as%20part%20of%20a%20debian%20or%20RPM%20package%20build\r\n(this analysis is from the person who discovered the backdoor).\r\n4. The XZ backdoor only ran when `argv[0]` was `/usr/sbin/sshd` This would never happen in OSS-Fuzz, only in a real environment https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=argv%5B0%5D%20needs%20to%20be%20/usr/sbin/sshd\r\n5. Nothing OSS-Fuzz does is secret, all the tests and code are public. This was a well planned attack and if the backdoor was going to be run on OSS-Fuzz (which it was not), it is very likely \"Jia Tan\" would have made sure the tests passed. This is very similar to malware writers who test their malware against antivirus until it is undetectable.\r\n6. OSS-Fuzz does not detect backdoors and it never has detected one. The backdoor's buginess did lead to it being discovered by Valgrind. However OSS-Fuzz's bug detectors would not have found the same issues. OSS-Fuzz uses ASAN to detect memory corruption bugs. ASAN requires instrumentation of a binary to detect bugs in the binary. This is not the case with Valgrind. The backdoor was not instrumented with ASAN, so OSS-Fuzz would not be able to detect bugs in the backdoor (in this case), though someone using Valgrind could detect them.\r\n\r\nUPDATE 3:\r\nThis patch fixes an actual false positive in ASAN.\r\nIf you change the old XZ dockerfile to check out the XZ source at the time of this PR, you can see how the fuzzers segfault immediately like all other users of ASAN and ifuncs.\r\nASAN's false positives can still be reproduced using this test file in OSS-Fuzz (and possibly other clang-15 builds)\r\n```\r\nvoid crunch1(void) {}\r\nvoid crunch2(void) {}\r\n\r\n__attribute__((__ifunc__(\"resolve_crunch\")))\r\nvoid crunch(void);\r\n\r\n// __attribute__((__used__,__no_sanitize_address__))\r\nstatic __typeof__(crunch)* resolve_crunch(void)\r\n{\r\n\t__builtin_cpu_init();\r\n\treturn __builtin_cpu_supports(\"avx\") ? crunch1 : crunch2;\r\n}\r\n\r\nint main(void)\r\n{\r\n\tcrunch();\r\n}\r\n```\r\n","commit_id":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","submitted_at":"2023-07-07T14:00:55Z","state":"approved","html_url":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986","pull_request_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","author_association":"CONTRIBUTOR","_links":{"html":{"href":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986"},"pull_request":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"}}},"pull_request":{"url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","id":1424714538,"node_id":"PR_kwDOA82mtc5U62sq","html_url":"https://github.com/google/oss-fuzz/pull/10667","diff_url":"https://github.com/google/oss-fuzz/pull/10667.diff","patch_url":"https://github.com/google/oss-fuzz/pull/10667.patch","issue_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667","number":10667,"state":"closed","locked":true,"title":"xz: Disable ifunc to fix Issue 60259.","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"body":"Indirect function support was added to xz on machines that support it for function dispatching. ifunc is not compatible with -fsanitize=address, so this should be disabled for fuzzing builds.","created_at":"2023-07-07T13:49:31Z","updated_at":"2024-04-03T13:07:54Z","closed_at":"2023-07-07T14:01:16Z","merged_at":"2023-07-07T14:01:16Z","merge_commit_sha":"d2e42b2e489eac6fe6268e381b7db151f4c892c5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[{"id":5560466969,"node_id":"LA_kwDOA82mtc8AAAABS23-GQ","url":"https://api.github.com/repos/google/oss-fuzz/labels/ready%20to%20merge","name":"ready to merge","color":"0E8A16","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits","review_comments_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments","review_comment_url":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}","comments_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d","head":{"label":"JiaT75:jiatan_xz_updates","ref":"jiatan_xz_updates","sha":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"repo":{"id":616460661,"node_id":"R_kgDOJL5xdQ","name":"oss-fuzz","full_name":"JiaT75/oss-fuzz","private":false,"owner":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"html_url":"https://github.com/JiaT75/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":true,"url":"https://api.github.com/repos/JiaT75/oss-fuzz","forks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/forks","keys_url":"https://api.github.com/repos/JiaT75/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/JiaT75/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/JiaT75/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/events","assignees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/JiaT75/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/JiaT75/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/JiaT75/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/JiaT75/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/JiaT75/oss-fuzz/merges","archive_url":"https://api.github.com/repos/JiaT75/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/JiaT75/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/JiaT75/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/JiaT75/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/JiaT75/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/JiaT75/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/JiaT75/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/deployments","created_at":"2023-03-20T12:41:49Z","updated_at":"2024-04-01T13:50:25Z","pushed_at":"2024-02-12T12:43:36Z","git_url":"git://github.com/JiaT75/oss-fuzz.git","ssh_url":"git@github.com:JiaT75/oss-fuzz.git","clone_url":"https://github.com/JiaT75/oss-fuzz.git","svn_url":"https://github.com/JiaT75/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":42338,"stargazers_count":1,"watchers_count":1,"language":"Shell","has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":1,"default_branch":"master"}},"base":{"label":"google:master","ref":"master","sha":"451c04cf8c2ae4654d8188ab23859a1b27b4bce1","user":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"repo":{"id":63809205,"node_id":"MDEwOlJlcG9zaXRvcnk2MzgwOTIwNQ==","name":"oss-fuzz","full_name":"google/oss-fuzz","private":false,"owner":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/google/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":false,"url":"https://api.github.com/repos/google/oss-fuzz","forks_url":"https://api.github.com/repos/google/oss-fuzz/forks","keys_url":"https://api.github.com/repos/google/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/google/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/google/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/google/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/google/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/google/oss-fuzz/events","assignees_url":"https://api.github.com/repos/google/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/google/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/google/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/google/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/google/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/google/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/google/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/google/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/google/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/google/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/google/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/google/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/google/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/google/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/google/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/google/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/google/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/google/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/google/oss-fuzz/merges","archive_url":"https://api.github.com/repos/google/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/google/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/google/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/google/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/google/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/google/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/google/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/google/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/google/oss-fuzz/deployments","created_at":"2016-07-20T19:39:50Z","updated_at":"2024-04-03T11:54:21Z","pushed_at":"2024-04-03T09:33:34Z","git_url":"git://github.com/google/oss-fuzz.git","ssh_url":"git@github.com:google/oss-fuzz.git","clone_url":"https://github.com/google/oss-fuzz.git","svn_url":"https://github.com/google/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":44507,"stargazers_count":9774,"watchers_count":9774,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":2086,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":473,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["fuzz-testing","fuzzing","oss-fuzz","security","stability","vulnerabilities"],"visibility":"public","forks":2086,"open_issues":473,"watchers":9774,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"},"html":{"href":"https://github.com/google/oss-fuzz/pull/10667"},"issue":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667"},"comments":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments"},"review_comments":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments"},"review_comment":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits"},"statuses":{"href":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":"off-topic"}},"public":true,"created_at":"2024-04-03T13:07:55Z","org":{"id":1342004,"login":"google","gravatar_id":"","url":"https://api.github.com/orgs/google","avatar_url":"https://avatars.githubusercontent.com/u/1342004?"}}
{"id":"37126810056","type":"PullRequestReviewEvent","actor":{"id":31354670,"login":"jonathanmetzman","display_login":"jonathanmetzman","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","avatar_url":"https://avatars.githubusercontent.com/u/31354670?"},"repo":{"id":63809205,"name":"google/oss-fuzz","url":"https://api.github.com/repos/google/oss-fuzz"},"payload":{"action":"created","review":{"id":1518981986,"node_id":"PRR_kwDOA82mtc5aidNi","user":{"login":"jonathanmetzman","id":31354670,"node_id":"MDQ6VXNlcjMxMzU0Njcw","avatar_url":"https://avatars.githubusercontent.com/u/31354670?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","html_url":"https://github.com/jonathanmetzman","followers_url":"https://api.github.com/users/jonathanmetzman/followers","following_url":"https://api.github.com/users/jonathanmetzman/following{/other_user}","gists_url":"https://api.github.com/users/jonathanmetzman/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanmetzman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanmetzman/subscriptions","organizations_url":"https://api.github.com/users/jonathanmetzman/orgs","repos_url":"https://api.github.com/users/jonathanmetzman/repos","events_url":"https://api.github.com/users/jonathanmetzman/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanmetzman/received_events","type":"User","site_admin":false},"body":"UPDATE:\r\nThere is no backdoor in this patch.\r\nThis repo provides a testing service to open source developers to help them find bugs in their code.\r\nWe allow developers to control 100% of what gets tested by our service. They own the code they submit to us, our reviews only mean we verified this is a project maintainer. Unfortunately we were told by the other XZ maintainer that \"Jia Tan\" was a maintainer. \r\nIf they don't want code tested, an automated tool like this can't stop them and was never intended to.\r\n\r\nOSS-Fuzz is not impacted by the backdoor, because the backdoor never ran on OSS-Fuzz. In addition, OSS-Fuzz runs code in a sandboxed environment so malicious developers/projects cannot harm OSS-Fuzz.\r\n\r\nUPDATE 2:\r\nI wanted to highlight the half-dozen reasons why the backdoor would never have been discovered by OSS-Fuzz. It's totally implausible that it would have been discovered here.\r\n\r\n1. This pull request fixed a build breakage caused by a compiler issue. The compiler issue was never fixed, so without this pull request, OSS-Fuzz would have never fuzzed an XZ version after June.\r\n2. The XZ backdoor only built in the tarballs included in the 5.6.0 and 5.6.1 branches and not in the master branch of the git repo that OSS-Fuzz was cloning.\r\n3. The XZ backdoor was only built when using build options for DEB or RPM packages. OSS-Fuzz was using neither: https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=Running%20as%20part%20of%20a%20debian%20or%20RPM%20package%20build\r\n(this analysis is from the person who discovered the backdoor).\r\n4. The XZ backdoor only ran when `argv[0]` was `/usr/sbin/sshd` This would never happen in OSS-Fuzz, only in a real environment https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=argv%5B0%5D%20needs%20to%20be%20/usr/sbin/sshd\r\n5. Nothing OSS-Fuzz does is secret, all the tests and code are public. This was a well planned attack and if the backdoor was going to be run on OSS-Fuzz (which it was not), it is very likely \"Jia Tan\" would have made sure the tests passed. This is very similar to malware writers who test their malware against antivirus until it is undetectable.\r\n6. OSS-Fuzz does not detect backdoors and it never has detected one. The backdoor's buginess did lead to it being discovered by Valgrind. However OSS-Fuzz's bug detectors would not have found the same issues. OSS-Fuzz uses ASAN to detect memory corruption bugs. ASAN requires instrumentation of a binary to detect bugs in the binary. This is not the case with Valgrind. The backdoor was not instrumented with ASAN, so OSS-Fuzz would not be able to detect bugs in the backdoor (in this case), though someone using Valgrind could detect them.\r\n\r\nUPDATE 3:\r\nThis patch fixes an actual false positive in ASAN.\r\nIf you change the old XZ dockerfile to check out the XZ source at the time of this PR, you can see how the fuzzers segfault immediately like all other users of ASAN and ifuncs.\r\nASAN's false positives can still be reproduced using this test file in OSS-Fuzz (and possibly other clang-15 builds)\r\n```\r\nvoid crunch1(void) {}\r\nvoid crunch2(void) {}\r\n\r\n__attribute__((__ifunc__(\"resolve_crunch\")))\r\nvoid crunch(void);\r\n\r\n// __attribute__((__used__,__no_sanitize_address__))\r\nstatic __typeof__(crunch)* resolve_crunch(void)\r\n{\r\n\t__builtin_cpu_init();\r\n\treturn __builtin_cpu_supports(\"avx\") ? crunch1 : crunch2;\r\n}\r\n\r\nint main(void)\r\n{\r\n\tcrunch();\r\n}\r\n```\r\n","commit_id":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","submitted_at":"2023-07-07T14:00:55Z","state":"approved","html_url":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986","pull_request_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","author_association":"CONTRIBUTOR","_links":{"html":{"href":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986"},"pull_request":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"}}},"pull_request":{"url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","id":1424714538,"node_id":"PR_kwDOA82mtc5U62sq","html_url":"https://github.com/google/oss-fuzz/pull/10667","diff_url":"https://github.com/google/oss-fuzz/pull/10667.diff","patch_url":"https://github.com/google/oss-fuzz/pull/10667.patch","issue_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667","number":10667,"state":"closed","locked":true,"title":"xz: Disable ifunc to fix Issue 60259.","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"body":"Indirect function support was added to xz on machines that support it for function dispatching. ifunc is not compatible with -fsanitize=address, so this should be disabled for fuzzing builds.","created_at":"2023-07-07T13:49:31Z","updated_at":"2024-04-03T13:11:39Z","closed_at":"2023-07-07T14:01:16Z","merged_at":"2023-07-07T14:01:16Z","merge_commit_sha":"d2e42b2e489eac6fe6268e381b7db151f4c892c5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[{"id":5560466969,"node_id":"LA_kwDOA82mtc8AAAABS23-GQ","url":"https://api.github.com/repos/google/oss-fuzz/labels/ready%20to%20merge","name":"ready to merge","color":"0E8A16","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits","review_comments_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments","review_comment_url":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}","comments_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d","head":{"label":"JiaT75:jiatan_xz_updates","ref":"jiatan_xz_updates","sha":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"repo":{"id":616460661,"node_id":"R_kgDOJL5xdQ","name":"oss-fuzz","full_name":"JiaT75/oss-fuzz","private":false,"owner":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"html_url":"https://github.com/JiaT75/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":true,"url":"https://api.github.com/repos/JiaT75/oss-fuzz","forks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/forks","keys_url":"https://api.github.com/repos/JiaT75/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/JiaT75/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/JiaT75/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/events","assignees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/JiaT75/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/JiaT75/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/JiaT75/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/JiaT75/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/JiaT75/oss-fuzz/merges","archive_url":"https://api.github.com/repos/JiaT75/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/JiaT75/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/JiaT75/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/JiaT75/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/JiaT75/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/JiaT75/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/JiaT75/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/deployments","created_at":"2023-03-20T12:41:49Z","updated_at":"2024-04-01T13:50:25Z","pushed_at":"2024-02-12T12:43:36Z","git_url":"git://github.com/JiaT75/oss-fuzz.git","ssh_url":"git@github.com:JiaT75/oss-fuzz.git","clone_url":"https://github.com/JiaT75/oss-fuzz.git","svn_url":"https://github.com/JiaT75/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":42338,"stargazers_count":1,"watchers_count":1,"language":"Shell","has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":1,"default_branch":"master"}},"base":{"label":"google:master","ref":"master","sha":"451c04cf8c2ae4654d8188ab23859a1b27b4bce1","user":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"repo":{"id":63809205,"node_id":"MDEwOlJlcG9zaXRvcnk2MzgwOTIwNQ==","name":"oss-fuzz","full_name":"google/oss-fuzz","private":false,"owner":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/google/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":false,"url":"https://api.github.com/repos/google/oss-fuzz","forks_url":"https://api.github.com/repos/google/oss-fuzz/forks","keys_url":"https://api.github.com/repos/google/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/google/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/google/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/google/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/google/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/google/oss-fuzz/events","assignees_url":"https://api.github.com/repos/google/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/google/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/google/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/google/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/google/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/google/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/google/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/google/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/google/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/google/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/google/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/google/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/google/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/google/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/google/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/google/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/google/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/google/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/google/oss-fuzz/merges","archive_url":"https://api.github.com/repos/google/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/google/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/google/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/google/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/google/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/google/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/google/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/google/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/google/oss-fuzz/deployments","created_at":"2016-07-20T19:39:50Z","updated_at":"2024-04-03T11:54:21Z","pushed_at":"2024-04-03T09:33:34Z","git_url":"git://github.com/google/oss-fuzz.git","ssh_url":"git@github.com:google/oss-fuzz.git","clone_url":"https://github.com/google/oss-fuzz.git","svn_url":"https://github.com/google/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":44507,"stargazers_count":9774,"watchers_count":9774,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":2086,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":473,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["fuzz-testing","fuzzing","oss-fuzz","security","stability","vulnerabilities"],"visibility":"public","forks":2086,"open_issues":473,"watchers":9774,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"},"html":{"href":"https://github.com/google/oss-fuzz/pull/10667"},"issue":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667"},"comments":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments"},"review_comments":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments"},"review_comment":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits"},"statuses":{"href":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":"off-topic"}},"public":true,"created_at":"2024-04-03T13:11:40Z","org":{"id":1342004,"login":"google","gravatar_id":"","url":"https://api.github.com/orgs/google","avatar_url":"https://avatars.githubusercontent.com/u/1342004?"}}
{"id":"37126816568","type":"PullRequestReviewEvent","actor":{"id":31354670,"login":"jonathanmetzman","display_login":"jonathanmetzman","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","avatar_url":"https://avatars.githubusercontent.com/u/31354670?"},"repo":{"id":63809205,"name":"google/oss-fuzz","url":"https://api.github.com/repos/google/oss-fuzz"},"payload":{"action":"created","review":{"id":1518981986,"node_id":"PRR_kwDOA82mtc5aidNi","user":{"login":"jonathanmetzman","id":31354670,"node_id":"MDQ6VXNlcjMxMzU0Njcw","avatar_url":"https://avatars.githubusercontent.com/u/31354670?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","html_url":"https://github.com/jonathanmetzman","followers_url":"https://api.github.com/users/jonathanmetzman/followers","following_url":"https://api.github.com/users/jonathanmetzman/following{/other_user}","gists_url":"https://api.github.com/users/jonathanmetzman/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanmetzman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanmetzman/subscriptions","organizations_url":"https://api.github.com/users/jonathanmetzman/orgs","repos_url":"https://api.github.com/users/jonathanmetzman/repos","events_url":"https://api.github.com/users/jonathanmetzman/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanmetzman/received_events","type":"User","site_admin":false},"body":"UPDATE:\r\nThere is no backdoor in this patch.\r\nThis repo provides a testing service to open source developers to help them find bugs in their code.\r\nWe allow developers to control 100% of what gets tested by our service. They own the code they submit to us, our reviews only mean we verified this is a project maintainer. Unfortunately we were told by the other XZ maintainer that \"Jia Tan\" was a maintainer. \r\nIf users don't want code tested, an automated tool like this can't stop them and was never intended to.\r\n\r\nOSS-Fuzz is not impacted by the backdoor, because the backdoor never ran on OSS-Fuzz. In addition, OSS-Fuzz runs code in a sandboxed environment so malicious developers/projects cannot harm OSS-Fuzz.\r\n\r\nUPDATE 2:\r\nI wanted to highlight the half-dozen reasons why the backdoor would never have been discovered by OSS-Fuzz. It's totally implausible that it would have been discovered here.\r\n\r\n1. This pull request fixed a build breakage caused by a compiler issue. The compiler issue was never fixed, so without this pull request, OSS-Fuzz would have never fuzzed an XZ version after June.\r\n2. The XZ backdoor only built in the tarballs included in the 5.6.0 and 5.6.1 branches and not in the master branch of the git repo that OSS-Fuzz was cloning.\r\n3. The XZ backdoor was only built when using build options for DEB or RPM packages. OSS-Fuzz was using neither: https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=Running%20as%20part%20of%20a%20debian%20or%20RPM%20package%20build\r\n(this analysis is from the person who discovered the backdoor).\r\n4. The XZ backdoor only ran when `argv[0]` was `/usr/sbin/sshd` This would never happen in OSS-Fuzz, only in a real environment https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=argv%5B0%5D%20needs%20to%20be%20/usr/sbin/sshd\r\n5. Nothing OSS-Fuzz does is secret, all the tests and code are public. This was a well planned attack and if the backdoor was going to be run on OSS-Fuzz (which it was not), it is very likely \"Jia Tan\" would have made sure the tests passed. This is very similar to malware writers who test their malware against antivirus until it is undetectable.\r\n6. OSS-Fuzz does not detect backdoors and it never has detected one. The backdoor's buginess did lead to it being discovered by Valgrind. However OSS-Fuzz's bug detectors would not have found the same issues. OSS-Fuzz uses ASAN to detect memory corruption bugs. ASAN requires instrumentation of a binary to detect bugs in the binary. This is not the case with Valgrind. The backdoor was not instrumented with ASAN, so OSS-Fuzz would not be able to detect bugs in the backdoor (in this case), though someone using Valgrind could detect them.\r\n\r\nUPDATE 3:\r\nThis patch fixes an actual false positive in ASAN.\r\nIf you change the old XZ dockerfile to check out the XZ source at the time of this PR, you can see how the fuzzers segfault immediately like all other users of ASAN and ifuncs.\r\nASAN's false positives can still be reproduced using this test file in OSS-Fuzz (and possibly other clang-15 builds)\r\n```\r\nvoid crunch1(void) {}\r\nvoid crunch2(void) {}\r\n\r\n__attribute__((__ifunc__(\"resolve_crunch\")))\r\nvoid crunch(void);\r\n\r\n// __attribute__((__used__,__no_sanitize_address__))\r\nstatic __typeof__(crunch)* resolve_crunch(void)\r\n{\r\n\t__builtin_cpu_init();\r\n\treturn __builtin_cpu_supports(\"avx\") ? crunch1 : crunch2;\r\n}\r\n\r\nint main(void)\r\n{\r\n\tcrunch();\r\n}\r\n```\r\n","commit_id":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","submitted_at":"2023-07-07T14:00:55Z","state":"approved","html_url":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986","pull_request_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","author_association":"CONTRIBUTOR","_links":{"html":{"href":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986"},"pull_request":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"}}},"pull_request":{"url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","id":1424714538,"node_id":"PR_kwDOA82mtc5U62sq","html_url":"https://github.com/google/oss-fuzz/pull/10667","diff_url":"https://github.com/google/oss-fuzz/pull/10667.diff","patch_url":"https://github.com/google/oss-fuzz/pull/10667.patch","issue_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667","number":10667,"state":"closed","locked":true,"title":"xz: Disable ifunc to fix Issue 60259.","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"body":"Indirect function support was added to xz on machines that support it for function dispatching. ifunc is not compatible with -fsanitize=address, so this should be disabled for fuzzing builds.","created_at":"2023-07-07T13:49:31Z","updated_at":"2024-04-03T13:11:50Z","closed_at":"2023-07-07T14:01:16Z","merged_at":"2023-07-07T14:01:16Z","merge_commit_sha":"d2e42b2e489eac6fe6268e381b7db151f4c892c5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[{"id":5560466969,"node_id":"LA_kwDOA82mtc8AAAABS23-GQ","url":"https://api.github.com/repos/google/oss-fuzz/labels/ready%20to%20merge","name":"ready to merge","color":"0E8A16","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits","review_comments_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments","review_comment_url":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}","comments_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d","head":{"label":"JiaT75:jiatan_xz_updates","ref":"jiatan_xz_updates","sha":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"repo":{"id":616460661,"node_id":"R_kgDOJL5xdQ","name":"oss-fuzz","full_name":"JiaT75/oss-fuzz","private":false,"owner":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"html_url":"https://github.com/JiaT75/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":true,"url":"https://api.github.com/repos/JiaT75/oss-fuzz","forks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/forks","keys_url":"https://api.github.com/repos/JiaT75/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/JiaT75/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/JiaT75/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/events","assignees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/JiaT75/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/JiaT75/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/JiaT75/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/JiaT75/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/JiaT75/oss-fuzz/merges","archive_url":"https://api.github.com/repos/JiaT75/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/JiaT75/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/JiaT75/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/JiaT75/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/JiaT75/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/JiaT75/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/JiaT75/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/deployments","created_at":"2023-03-20T12:41:49Z","updated_at":"2024-04-01T13:50:25Z","pushed_at":"2024-02-12T12:43:36Z","git_url":"git://github.com/JiaT75/oss-fuzz.git","ssh_url":"git@github.com:JiaT75/oss-fuzz.git","clone_url":"https://github.com/JiaT75/oss-fuzz.git","svn_url":"https://github.com/JiaT75/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":42338,"stargazers_count":1,"watchers_count":1,"language":"Shell","has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":1,"default_branch":"master"}},"base":{"label":"google:master","ref":"master","sha":"451c04cf8c2ae4654d8188ab23859a1b27b4bce1","user":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"repo":{"id":63809205,"node_id":"MDEwOlJlcG9zaXRvcnk2MzgwOTIwNQ==","name":"oss-fuzz","full_name":"google/oss-fuzz","private":false,"owner":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/google/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":false,"url":"https://api.github.com/repos/google/oss-fuzz","forks_url":"https://api.github.com/repos/google/oss-fuzz/forks","keys_url":"https://api.github.com/repos/google/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/google/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/google/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/google/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/google/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/google/oss-fuzz/events","assignees_url":"https://api.github.com/repos/google/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/google/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/google/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/google/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/google/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/google/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/google/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/google/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/google/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/google/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/google/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/google/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/google/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/google/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/google/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/google/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/google/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/google/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/google/oss-fuzz/merges","archive_url":"https://api.github.com/repos/google/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/google/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/google/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/google/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/google/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/google/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/google/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/google/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/google/oss-fuzz/deployments","created_at":"2016-07-20T19:39:50Z","updated_at":"2024-04-03T11:54:21Z","pushed_at":"2024-04-03T09:33:34Z","git_url":"git://github.com/google/oss-fuzz.git","ssh_url":"git@github.com:google/oss-fuzz.git","clone_url":"https://github.com/google/oss-fuzz.git","svn_url":"https://github.com/google/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":44507,"stargazers_count":9774,"watchers_count":9774,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":2086,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":473,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["fuzz-testing","fuzzing","oss-fuzz","security","stability","vulnerabilities"],"visibility":"public","forks":2086,"open_issues":473,"watchers":9774,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"},"html":{"href":"https://github.com/google/oss-fuzz/pull/10667"},"issue":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667"},"comments":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments"},"review_comments":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments"},"review_comment":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits"},"statuses":{"href":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":"off-topic"}},"public":true,"created_at":"2024-04-03T13:11:51Z","org":{"id":1342004,"login":"google","gravatar_id":"","url":"https://api.github.com/orgs/google","avatar_url":"https://avatars.githubusercontent.com/u/1342004?"}}
{"id":"37126929719","type":"PullRequestReviewEvent","actor":{"id":31354670,"login":"jonathanmetzman","display_login":"jonathanmetzman","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","avatar_url":"https://avatars.githubusercontent.com/u/31354670?"},"repo":{"id":63809205,"name":"google/oss-fuzz","url":"https://api.github.com/repos/google/oss-fuzz"},"payload":{"action":"created","review":{"id":1518981986,"node_id":"PRR_kwDOA82mtc5aidNi","user":{"login":"jonathanmetzman","id":31354670,"node_id":"MDQ6VXNlcjMxMzU0Njcw","avatar_url":"https://avatars.githubusercontent.com/u/31354670?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","html_url":"https://github.com/jonathanmetzman","followers_url":"https://api.github.com/users/jonathanmetzman/followers","following_url":"https://api.github.com/users/jonathanmetzman/following{/other_user}","gists_url":"https://api.github.com/users/jonathanmetzman/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanmetzman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanmetzman/subscriptions","organizations_url":"https://api.github.com/users/jonathanmetzman/orgs","repos_url":"https://api.github.com/users/jonathanmetzman/repos","events_url":"https://api.github.com/users/jonathanmetzman/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanmetzman/received_events","type":"User","site_admin":false},"body":"UPDATE:\r\nThere is no backdoor in this patch.\r\nThis repo provides a testing service to open source developers to help them find bugs in their code.\r\nWe allow developers to control 100% of what gets tested by our service. They own the code they submit to us, our reviews only mean we verified this is a project maintainer. Unfortunately we were told by the other XZ maintainer that \"Jia Tan\" was a maintainer. \r\nIf users don't want code tested, an automated tool like this can't stop them and was never intended to.\r\n\r\nOSS-Fuzz is not impacted by the backdoor, because the backdoor never ran on OSS-Fuzz. In addition, OSS-Fuzz runs code in a sandboxed environment so malicious developers/projects cannot harm OSS-Fuzz.\r\n\r\nUPDATE 2:\r\nI wanted to highlight the half-dozen reasons why the backdoor would never have been discovered by OSS-Fuzz. It's totally implausible that it would have been discovered here.\r\n\r\n1. This pull request fixed a build breakage caused by a compiler issue. The compiler issue was never fixed, so without this pull request, OSS-Fuzz would have never fuzzed an XZ version after June 2023, the backdoor was added in March 2024.\r\n2. The XZ backdoor only built in the tarballs included in the 5.6.0 and 5.6.1 branches and not in the master branch of the git repo that OSS-Fuzz was cloning.\r\n3. The XZ backdoor was only built when using build options for DEB or RPM packages. OSS-Fuzz was using neither: https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=Running%20as%20part%20of%20a%20debian%20or%20RPM%20package%20build\r\n(this analysis is from the person who discovered the backdoor).\r\n4. The XZ backdoor only ran when `argv[0]` was `/usr/sbin/sshd` This would never happen in OSS-Fuzz, only in a real environment https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=argv%5B0%5D%20needs%20to%20be%20/usr/sbin/sshd\r\n5. Nothing OSS-Fuzz does is secret, all the tests and code are public. This was a well planned attack and if the backdoor was going to be run on OSS-Fuzz (which it was not), it is very likely \"Jia Tan\" would have made sure the tests passed. This is very similar to malware writers who test their malware against antivirus until it is undetectable.\r\n6. OSS-Fuzz does not detect backdoors and it never has detected one. The backdoor's buginess did lead to it being discovered by Valgrind. However OSS-Fuzz's bug detectors would not have found the same issues. OSS-Fuzz uses ASAN to detect memory corruption bugs. ASAN requires instrumentation of a binary to detect bugs in the binary. This is not the case with Valgrind. The backdoor was not instrumented with ASAN, so OSS-Fuzz would not be able to detect bugs in the backdoor (in this case), though someone using Valgrind could detect them.\r\n\r\nTo summarize: the backdoor never ran on OSS-Fuzz, and even if it did OSS-Fuzz would not detect it.\r\n\r\nUPDATE 3:\r\nThis patch fixes an actual false positive in ASAN.\r\nIf you change the old XZ dockerfile to check out the XZ source at the time of this PR, you can see how the fuzzers segfault immediately like all other users of ASAN and ifuncs.\r\nASAN's false positives can still be reproduced using this test file in OSS-Fuzz (and possibly other clang-15 builds)\r\n```\r\nvoid crunch1(void) {}\r\nvoid crunch2(void) {}\r\n\r\n__attribute__((__ifunc__(\"resolve_crunch\")))\r\nvoid crunch(void);\r\n\r\n// __attribute__((__used__,__no_sanitize_address__))\r\nstatic __typeof__(crunch)* resolve_crunch(void)\r\n{\r\n\t__builtin_cpu_init();\r\n\treturn __builtin_cpu_supports(\"avx\") ? crunch1 : crunch2;\r\n}\r\n\r\nint main(void)\r\n{\r\n\tcrunch();\r\n}\r\n```\r\n","commit_id":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","submitted_at":"2023-07-07T14:00:55Z","state":"approved","html_url":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986","pull_request_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","author_association":"CONTRIBUTOR","_links":{"html":{"href":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986"},"pull_request":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"}}},"pull_request":{"url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","id":1424714538,"node_id":"PR_kwDOA82mtc5U62sq","html_url":"https://github.com/google/oss-fuzz/pull/10667","diff_url":"https://github.com/google/oss-fuzz/pull/10667.diff","patch_url":"https://github.com/google/oss-fuzz/pull/10667.patch","issue_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667","number":10667,"state":"closed","locked":true,"title":"xz: Disable ifunc to fix Issue 60259.","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"body":"Indirect function support was added to xz on machines that support it for function dispatching. ifunc is not compatible with -fsanitize=address, so this should be disabled for fuzzing builds.","created_at":"2023-07-07T13:49:31Z","updated_at":"2024-04-03T13:14:29Z","closed_at":"2023-07-07T14:01:16Z","merged_at":"2023-07-07T14:01:16Z","merge_commit_sha":"d2e42b2e489eac6fe6268e381b7db151f4c892c5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[{"id":5560466969,"node_id":"LA_kwDOA82mtc8AAAABS23-GQ","url":"https://api.github.com/repos/google/oss-fuzz/labels/ready%20to%20merge","name":"ready to merge","color":"0E8A16","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits","review_comments_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments","review_comment_url":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}","comments_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d","head":{"label":"JiaT75:jiatan_xz_updates","ref":"jiatan_xz_updates","sha":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"repo":{"id":616460661,"node_id":"R_kgDOJL5xdQ","name":"oss-fuzz","full_name":"JiaT75/oss-fuzz","private":false,"owner":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"html_url":"https://github.com/JiaT75/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":true,"url":"https://api.github.com/repos/JiaT75/oss-fuzz","forks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/forks","keys_url":"https://api.github.com/repos/JiaT75/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/JiaT75/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/JiaT75/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/events","assignees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/JiaT75/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/JiaT75/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/JiaT75/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/JiaT75/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/JiaT75/oss-fuzz/merges","archive_url":"https://api.github.com/repos/JiaT75/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/JiaT75/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/JiaT75/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/JiaT75/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/JiaT75/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/JiaT75/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/JiaT75/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/deployments","created_at":"2023-03-20T12:41:49Z","updated_at":"2024-04-01T13:50:25Z","pushed_at":"2024-02-12T12:43:36Z","git_url":"git://github.com/JiaT75/oss-fuzz.git","ssh_url":"git@github.com:JiaT75/oss-fuzz.git","clone_url":"https://github.com/JiaT75/oss-fuzz.git","svn_url":"https://github.com/JiaT75/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":42338,"stargazers_count":1,"watchers_count":1,"language":"Shell","has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":1,"default_branch":"master"}},"base":{"label":"google:master","ref":"master","sha":"451c04cf8c2ae4654d8188ab23859a1b27b4bce1","user":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"repo":{"id":63809205,"node_id":"MDEwOlJlcG9zaXRvcnk2MzgwOTIwNQ==","name":"oss-fuzz","full_name":"google/oss-fuzz","private":false,"owner":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/google/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":false,"url":"https://api.github.com/repos/google/oss-fuzz","forks_url":"https://api.github.com/repos/google/oss-fuzz/forks","keys_url":"https://api.github.com/repos/google/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/google/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/google/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/google/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/google/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/google/oss-fuzz/events","assignees_url":"https://api.github.com/repos/google/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/google/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/google/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/google/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/google/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/google/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/google/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/google/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/google/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/google/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/google/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/google/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/google/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/google/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/google/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/google/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/google/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/google/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/google/oss-fuzz/merges","archive_url":"https://api.github.com/repos/google/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/google/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/google/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/google/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/google/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/google/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/google/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/google/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/google/oss-fuzz/deployments","created_at":"2016-07-20T19:39:50Z","updated_at":"2024-04-03T11:54:21Z","pushed_at":"2024-04-03T09:33:34Z","git_url":"git://github.com/google/oss-fuzz.git","ssh_url":"git@github.com:google/oss-fuzz.git","clone_url":"https://github.com/google/oss-fuzz.git","svn_url":"https://github.com/google/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":44507,"stargazers_count":9774,"watchers_count":9774,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":2086,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":473,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["fuzz-testing","fuzzing","oss-fuzz","security","stability","vulnerabilities"],"visibility":"public","forks":2086,"open_issues":473,"watchers":9774,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"},"html":{"href":"https://github.com/google/oss-fuzz/pull/10667"},"issue":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667"},"comments":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments"},"review_comments":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments"},"review_comment":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits"},"statuses":{"href":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":"off-topic"}},"public":true,"created_at":"2024-04-03T13:14:30Z","org":{"id":1342004,"login":"google","gravatar_id":"","url":"https://api.github.com/orgs/google","avatar_url":"https://avatars.githubusercontent.com/u/1342004?"}}
{"id":"37126948334","type":"PullRequestReviewEvent","actor":{"id":31354670,"login":"jonathanmetzman","display_login":"jonathanmetzman","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","avatar_url":"https://avatars.githubusercontent.com/u/31354670?"},"repo":{"id":63809205,"name":"google/oss-fuzz","url":"https://api.github.com/repos/google/oss-fuzz"},"payload":{"action":"created","review":{"id":1518981986,"node_id":"PRR_kwDOA82mtc5aidNi","user":{"login":"jonathanmetzman","id":31354670,"node_id":"MDQ6VXNlcjMxMzU0Njcw","avatar_url":"https://avatars.githubusercontent.com/u/31354670?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","html_url":"https://github.com/jonathanmetzman","followers_url":"https://api.github.com/users/jonathanmetzman/followers","following_url":"https://api.github.com/users/jonathanmetzman/following{/other_user}","gists_url":"https://api.github.com/users/jonathanmetzman/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanmetzman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanmetzman/subscriptions","organizations_url":"https://api.github.com/users/jonathanmetzman/orgs","repos_url":"https://api.github.com/users/jonathanmetzman/repos","events_url":"https://api.github.com/users/jonathanmetzman/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanmetzman/received_events","type":"User","site_admin":false},"body":"UPDATE:\r\nThere is no backdoor in this patch.\r\nThis repo provides a testing service to open source developers to help them find bugs in their code.\r\nWe allow developers to control 100% of what gets tested by our service. They own the code they submit to us, our reviews only mean we verified this is a project maintainer. Unfortunately we were told by the other XZ maintainer that \"Jia Tan\" was a maintainer. \r\nIf users don't want code tested, an automated tool like this can't stop them and was never intended to.\r\n\r\nOSS-Fuzz is not impacted by the backdoor, because the backdoor never ran on OSS-Fuzz. In addition, OSS-Fuzz runs code in a sandboxed environment so malicious developers/projects cannot harm OSS-Fuzz.\r\n\r\nUPDATE 2:\r\nI wanted to highlight the half-dozen reasons why the backdoor would never have been discovered by OSS-Fuzz. It's totally implausible that it would have been discovered here.\r\n\r\n1. This pull request fixed a build breakage caused by a compiler issue. The compiler issue was never fixed, so without this pull request, OSS-Fuzz would have never fuzzed an XZ version after June 2023, the backdoor was added in March 2024.\r\n2. The XZ backdoor only built in the tarballs included in the 5.6.0 and 5.6.1 branches and not in the master branch of the git repo that OSS-Fuzz was cloning.\r\n3. The XZ backdoor was only built when using build options for DEB or RPM packages. OSS-Fuzz was using neither: https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=Running%20as%20part%20of%20a%20debian%20or%20RPM%20package%20build\r\n(this analysis is from the person who discovered the backdoor).\r\n4. The XZ backdoor only ran when `argv[0]` was `/usr/sbin/sshd` This would never happen in OSS-Fuzz, only in a real environment https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=argv%5B0%5D%20needs%20to%20be%20/usr/sbin/sshd\r\n5. Nothing OSS-Fuzz does is secret, all the tests and code are public. This was a well planned attack and if the backdoor was going to be run on OSS-Fuzz (which it was not), it is very likely \"Jia Tan\" would have made sure the tests passed. This is very similar to malware writers who test their malware against antivirus until it is undetectable.\r\n6. OSS-Fuzz does not detect backdoors and it never has detected one. The backdoor's buginess did lead to it being discovered by Valgrind. However OSS-Fuzz's bug detectors would not have found the same issues. OSS-Fuzz uses ASAN to detect memory corruption bugs. ASAN requires instrumentation of a binary to detect bugs in the binary. This is not the case with Valgrind. The backdoor was not instrumented with ASAN, so OSS-Fuzz would not be able to detect bugs in the backdoor (in this case), though someone using Valgrind could detect them.\r\n\r\nTo summarize: the backdoor never ran on OSS-Fuzz and OSS-Fuzz would not detect the backdoor if it magically ran on OSS-Fuzz.\r\n\r\nUPDATE 3:\r\nThis patch fixes an actual false positive in ASAN.\r\nIf you change the old XZ dockerfile to check out the XZ source at the time of this PR, you can see how the fuzzers segfault immediately like all other users of ASAN and ifuncs.\r\nASAN's false positives can still be reproduced using this test file in OSS-Fuzz (and possibly other clang-15 builds)\r\n```\r\nvoid crunch1(void) {}\r\nvoid crunch2(void) {}\r\n\r\n__attribute__((__ifunc__(\"resolve_crunch\")))\r\nvoid crunch(void);\r\n\r\n// __attribute__((__used__,__no_sanitize_address__))\r\nstatic __typeof__(crunch)* resolve_crunch(void)\r\n{\r\n\t__builtin_cpu_init();\r\n\treturn __builtin_cpu_supports(\"avx\") ? crunch1 : crunch2;\r\n}\r\n\r\nint main(void)\r\n{\r\n\tcrunch();\r\n}\r\n```\r\n","commit_id":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","submitted_at":"2023-07-07T14:00:55Z","state":"approved","html_url":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986","pull_request_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","author_association":"CONTRIBUTOR","_links":{"html":{"href":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986"},"pull_request":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"}}},"pull_request":{"url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","id":1424714538,"node_id":"PR_kwDOA82mtc5U62sq","html_url":"https://github.com/google/oss-fuzz/pull/10667","diff_url":"https://github.com/google/oss-fuzz/pull/10667.diff","patch_url":"https://github.com/google/oss-fuzz/pull/10667.patch","issue_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667","number":10667,"state":"closed","locked":true,"title":"xz: Disable ifunc to fix Issue 60259.","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"body":"Indirect function support was added to xz on machines that support it for function dispatching. ifunc is not compatible with -fsanitize=address, so this should be disabled for fuzzing builds.","created_at":"2023-07-07T13:49:31Z","updated_at":"2024-04-03T13:14:58Z","closed_at":"2023-07-07T14:01:16Z","merged_at":"2023-07-07T14:01:16Z","merge_commit_sha":"d2e42b2e489eac6fe6268e381b7db151f4c892c5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[{"id":5560466969,"node_id":"LA_kwDOA82mtc8AAAABS23-GQ","url":"https://api.github.com/repos/google/oss-fuzz/labels/ready%20to%20merge","name":"ready to merge","color":"0E8A16","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits","review_comments_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments","review_comment_url":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}","comments_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d","head":{"label":"JiaT75:jiatan_xz_updates","ref":"jiatan_xz_updates","sha":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"repo":{"id":616460661,"node_id":"R_kgDOJL5xdQ","name":"oss-fuzz","full_name":"JiaT75/oss-fuzz","private":false,"owner":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"html_url":"https://github.com/JiaT75/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":true,"url":"https://api.github.com/repos/JiaT75/oss-fuzz","forks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/forks","keys_url":"https://api.github.com/repos/JiaT75/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/JiaT75/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/JiaT75/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/events","assignees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/JiaT75/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/JiaT75/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/JiaT75/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/JiaT75/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/JiaT75/oss-fuzz/merges","archive_url":"https://api.github.com/repos/JiaT75/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/JiaT75/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/JiaT75/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/JiaT75/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/JiaT75/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/JiaT75/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/JiaT75/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/deployments","created_at":"2023-03-20T12:41:49Z","updated_at":"2024-04-01T13:50:25Z","pushed_at":"2024-02-12T12:43:36Z","git_url":"git://github.com/JiaT75/oss-fuzz.git","ssh_url":"git@github.com:JiaT75/oss-fuzz.git","clone_url":"https://github.com/JiaT75/oss-fuzz.git","svn_url":"https://github.com/JiaT75/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":42338,"stargazers_count":1,"watchers_count":1,"language":"Shell","has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":1,"default_branch":"master"}},"base":{"label":"google:master","ref":"master","sha":"451c04cf8c2ae4654d8188ab23859a1b27b4bce1","user":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"repo":{"id":63809205,"node_id":"MDEwOlJlcG9zaXRvcnk2MzgwOTIwNQ==","name":"oss-fuzz","full_name":"google/oss-fuzz","private":false,"owner":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/google/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":false,"url":"https://api.github.com/repos/google/oss-fuzz","forks_url":"https://api.github.com/repos/google/oss-fuzz/forks","keys_url":"https://api.github.com/repos/google/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/google/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/google/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/google/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/google/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/google/oss-fuzz/events","assignees_url":"https://api.github.com/repos/google/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/google/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/google/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/google/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/google/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/google/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/google/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/google/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/google/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/google/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/google/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/google/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/google/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/google/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/google/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/google/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/google/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/google/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/google/oss-fuzz/merges","archive_url":"https://api.github.com/repos/google/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/google/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/google/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/google/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/google/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/google/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/google/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/google/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/google/oss-fuzz/deployments","created_at":"2016-07-20T19:39:50Z","updated_at":"2024-04-03T11:54:21Z","pushed_at":"2024-04-03T09:33:34Z","git_url":"git://github.com/google/oss-fuzz.git","ssh_url":"git@github.com:google/oss-fuzz.git","clone_url":"https://github.com/google/oss-fuzz.git","svn_url":"https://github.com/google/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":44507,"stargazers_count":9774,"watchers_count":9774,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":2086,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":473,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["fuzz-testing","fuzzing","oss-fuzz","security","stability","vulnerabilities"],"visibility":"public","forks":2086,"open_issues":473,"watchers":9774,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"},"html":{"href":"https://github.com/google/oss-fuzz/pull/10667"},"issue":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667"},"comments":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments"},"review_comments":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments"},"review_comment":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits"},"statuses":{"href":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":"off-topic"}},"public":true,"created_at":"2024-04-03T13:14:59Z","org":{"id":1342004,"login":"google","gravatar_id":"","url":"https://api.github.com/orgs/google","avatar_url":"https://avatars.githubusercontent.com/u/1342004?"}}
{"id":"37127104623","type":"PullRequestReviewEvent","actor":{"id":31354670,"login":"jonathanmetzman","display_login":"jonathanmetzman","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","avatar_url":"https://avatars.githubusercontent.com/u/31354670?"},"repo":{"id":63809205,"name":"google/oss-fuzz","url":"https://api.github.com/repos/google/oss-fuzz"},"payload":{"action":"created","review":{"id":1518981986,"node_id":"PRR_kwDOA82mtc5aidNi","user":{"login":"jonathanmetzman","id":31354670,"node_id":"MDQ6VXNlcjMxMzU0Njcw","avatar_url":"https://avatars.githubusercontent.com/u/31354670?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","html_url":"https://github.com/jonathanmetzman","followers_url":"https://api.github.com/users/jonathanmetzman/followers","following_url":"https://api.github.com/users/jonathanmetzman/following{/other_user}","gists_url":"https://api.github.com/users/jonathanmetzman/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanmetzman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanmetzman/subscriptions","organizations_url":"https://api.github.com/users/jonathanmetzman/orgs","repos_url":"https://api.github.com/users/jonathanmetzman/repos","events_url":"https://api.github.com/users/jonathanmetzman/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanmetzman/received_events","type":"User","site_admin":false},"body":"tl;dr This patch did not prevent OSS-Fuzz from finding the backdoor, OSS-Fuzz would have never found the backdoor, this patch is not suspicious, and OSS-Fuzz is not meant to find bugs when users do not want them found.\r\n\r\nUPDATE:\r\nThere is no backdoor in this patch.\r\nThis repo provides a testing service to open source developers to help them find bugs in their code.\r\nWe allow developers to control 100% of what gets tested by our service. They own the code they submit to us, our reviews only mean we verified this is a project maintainer. Unfortunately we were told by the other XZ maintainer that \"Jia Tan\" was a maintainer. \r\nIf users don't want code tested, an automated tool like this can't stop them and was never intended to.\r\n\r\nOSS-Fuzz is not impacted by the backdoor, because the backdoor never ran on OSS-Fuzz. In addition, OSS-Fuzz runs code in a sandboxed environment so malicious developers/projects cannot harm OSS-Fuzz.\r\n\r\nUPDATE 2:\r\nI wanted to highlight the half-dozen reasons why the backdoor would never have been discovered by OSS-Fuzz. It's totally implausible that it would have been discovered here.\r\n\r\n1. This pull request fixed a build breakage caused by a compiler issue. The compiler issue was never fixed, so without this pull request, OSS-Fuzz would have never fuzzed an XZ version after June 2023, the backdoor was added in March 2024.\r\n2. The XZ backdoor only built in the tarballs included in the 5.6.0 and 5.6.1 branches and not in the master branch of the git repo that OSS-Fuzz was cloning.\r\n3. The XZ backdoor was only built when using build options for DEB or RPM packages. OSS-Fuzz was using neither: https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=Running%20as%20part%20of%20a%20debian%20or%20RPM%20package%20build\r\n(this analysis is from the person who discovered the backdoor).\r\n4. The XZ backdoor only ran when `argv[0]` was `/usr/sbin/sshd` This would never happen in OSS-Fuzz, only in a real environment https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=argv%5B0%5D%20needs%20to%20be%20/usr/sbin/sshd\r\n5. Nothing OSS-Fuzz does is secret, all the tests and code are public. This was a well planned attack and if the backdoor was going to be run on OSS-Fuzz (which it was not), it is very likely \"Jia Tan\" would have made sure the tests passed. This is very similar to malware writers who test their malware against antivirus until it is undetectable.\r\n6. OSS-Fuzz does not detect backdoors and it never has detected one. The backdoor's buginess did lead to it being discovered by Valgrind. However OSS-Fuzz's bug detectors would not have found the same issues. OSS-Fuzz uses ASAN to detect memory corruption bugs. ASAN requires instrumentation of a binary to detect bugs in the binary. This is not the case with Valgrind. The backdoor was not instrumented with ASAN, so OSS-Fuzz would not be able to detect bugs in the backdoor (in this case), though someone using Valgrind could detect them.\r\n\r\nTo summarize: the backdoor never ran on OSS-Fuzz and OSS-Fuzz would not detect the backdoor if it magically ran on OSS-Fuzz.\r\n\r\nUPDATE 3:\r\nThis patch fixes an actual false positive in ASAN.\r\nIf you change the old XZ dockerfile to check out the XZ source at the time of this PR, you can see how the fuzzers segfault immediately like all other users of ASAN and ifuncs.\r\nASAN's false positives can still be reproduced using this test file in OSS-Fuzz (and possibly other clang-15 builds)\r\n```\r\nvoid crunch1(void) {}\r\nvoid crunch2(void) {}\r\n\r\n__attribute__((__ifunc__(\"resolve_crunch\")))\r\nvoid crunch(void);\r\n\r\n// __attribute__((__used__,__no_sanitize_address__))\r\nstatic __typeof__(crunch)* resolve_crunch(void)\r\n{\r\n\t__builtin_cpu_init();\r\n\treturn __builtin_cpu_supports(\"avx\") ? crunch1 : crunch2;\r\n}\r\n\r\nint main(void)\r\n{\r\n\tcrunch();\r\n}\r\n```\r\n","commit_id":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","submitted_at":"2023-07-07T14:00:55Z","state":"approved","html_url":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986","pull_request_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","author_association":"CONTRIBUTOR","_links":{"html":{"href":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986"},"pull_request":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"}}},"pull_request":{"url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","id":1424714538,"node_id":"PR_kwDOA82mtc5U62sq","html_url":"https://github.com/google/oss-fuzz/pull/10667","diff_url":"https://github.com/google/oss-fuzz/pull/10667.diff","patch_url":"https://github.com/google/oss-fuzz/pull/10667.patch","issue_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667","number":10667,"state":"closed","locked":true,"title":"xz: Disable ifunc to fix Issue 60259.","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"body":"Indirect function support was added to xz on machines that support it for function dispatching. ifunc is not compatible with -fsanitize=address, so this should be disabled for fuzzing builds.","created_at":"2023-07-07T13:49:31Z","updated_at":"2024-04-03T13:19:10Z","closed_at":"2023-07-07T14:01:16Z","merged_at":"2023-07-07T14:01:16Z","merge_commit_sha":"d2e42b2e489eac6fe6268e381b7db151f4c892c5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[{"id":5560466969,"node_id":"LA_kwDOA82mtc8AAAABS23-GQ","url":"https://api.github.com/repos/google/oss-fuzz/labels/ready%20to%20merge","name":"ready to merge","color":"0E8A16","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits","review_comments_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments","review_comment_url":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}","comments_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d","head":{"label":"JiaT75:jiatan_xz_updates","ref":"jiatan_xz_updates","sha":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"repo":{"id":616460661,"node_id":"R_kgDOJL5xdQ","name":"oss-fuzz","full_name":"JiaT75/oss-fuzz","private":false,"owner":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"html_url":"https://github.com/JiaT75/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":true,"url":"https://api.github.com/repos/JiaT75/oss-fuzz","forks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/forks","keys_url":"https://api.github.com/repos/JiaT75/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/JiaT75/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/JiaT75/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/events","assignees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/JiaT75/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/JiaT75/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/JiaT75/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/JiaT75/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/JiaT75/oss-fuzz/merges","archive_url":"https://api.github.com/repos/JiaT75/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/JiaT75/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/JiaT75/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/JiaT75/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/JiaT75/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/JiaT75/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/JiaT75/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/deployments","created_at":"2023-03-20T12:41:49Z","updated_at":"2024-04-01T13:50:25Z","pushed_at":"2024-02-12T12:43:36Z","git_url":"git://github.com/JiaT75/oss-fuzz.git","ssh_url":"git@github.com:JiaT75/oss-fuzz.git","clone_url":"https://github.com/JiaT75/oss-fuzz.git","svn_url":"https://github.com/JiaT75/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":42338,"stargazers_count":1,"watchers_count":1,"language":"Shell","has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":1,"default_branch":"master"}},"base":{"label":"google:master","ref":"master","sha":"451c04cf8c2ae4654d8188ab23859a1b27b4bce1","user":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"repo":{"id":63809205,"node_id":"MDEwOlJlcG9zaXRvcnk2MzgwOTIwNQ==","name":"oss-fuzz","full_name":"google/oss-fuzz","private":false,"owner":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/google/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":false,"url":"https://api.github.com/repos/google/oss-fuzz","forks_url":"https://api.github.com/repos/google/oss-fuzz/forks","keys_url":"https://api.github.com/repos/google/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/google/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/google/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/google/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/google/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/google/oss-fuzz/events","assignees_url":"https://api.github.com/repos/google/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/google/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/google/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/google/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/google/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/google/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/google/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/google/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/google/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/google/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/google/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/google/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/google/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/google/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/google/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/google/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/google/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/google/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/google/oss-fuzz/merges","archive_url":"https://api.github.com/repos/google/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/google/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/google/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/google/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/google/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/google/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/google/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/google/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/google/oss-fuzz/deployments","created_at":"2016-07-20T19:39:50Z","updated_at":"2024-04-03T11:54:21Z","pushed_at":"2024-04-03T09:33:34Z","git_url":"git://github.com/google/oss-fuzz.git","ssh_url":"git@github.com:google/oss-fuzz.git","clone_url":"https://github.com/google/oss-fuzz.git","svn_url":"https://github.com/google/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":44507,"stargazers_count":9774,"watchers_count":9774,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":2086,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":473,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["fuzz-testing","fuzzing","oss-fuzz","security","stability","vulnerabilities"],"visibility":"public","forks":2086,"open_issues":473,"watchers":9774,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"},"html":{"href":"https://github.com/google/oss-fuzz/pull/10667"},"issue":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667"},"comments":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments"},"review_comments":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments"},"review_comment":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits"},"statuses":{"href":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":"off-topic"}},"public":true,"created_at":"2024-04-03T13:19:11Z","org":{"id":1342004,"login":"google","gravatar_id":"","url":"https://api.github.com/orgs/google","avatar_url":"https://avatars.githubusercontent.com/u/1342004?"}}
{"id":"37127189416","type":"PullRequestReviewEvent","actor":{"id":31354670,"login":"jonathanmetzman","display_login":"jonathanmetzman","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","avatar_url":"https://avatars.githubusercontent.com/u/31354670?"},"repo":{"id":63809205,"name":"google/oss-fuzz","url":"https://api.github.com/repos/google/oss-fuzz"},"payload":{"action":"created","review":{"id":1518981986,"node_id":"PRR_kwDOA82mtc5aidNi","user":{"login":"jonathanmetzman","id":31354670,"node_id":"MDQ6VXNlcjMxMzU0Njcw","avatar_url":"https://avatars.githubusercontent.com/u/31354670?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","html_url":"https://github.com/jonathanmetzman","followers_url":"https://api.github.com/users/jonathanmetzman/followers","following_url":"https://api.github.com/users/jonathanmetzman/following{/other_user}","gists_url":"https://api.github.com/users/jonathanmetzman/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanmetzman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanmetzman/subscriptions","organizations_url":"https://api.github.com/users/jonathanmetzman/orgs","repos_url":"https://api.github.com/users/jonathanmetzman/repos","events_url":"https://api.github.com/users/jonathanmetzman/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanmetzman/received_events","type":"User","site_admin":false},"body":"tl;dr This patch did not prevent OSS-Fuzz from finding the backdoor, OSS-Fuzz would have never found the backdoor, this patch is not suspicious, and OSS-Fuzz is not meant to find bugs when users do not want them found.\r\n\r\nUPDATE:\r\nThere is no backdoor in this patch.\r\nThis repo provides a testing service to open source developers to help them find bugs in their code.\r\nWe allow developers to control 100% of what gets tested by our service. They own the code they submit to us, our reviews only mean we verified this is a project maintainer. Unfortunately we were told by the other XZ maintainer that \"Jia Tan\" was a maintainer. \r\nIf users don't want code tested, an automated tool like this can't stop them and was never intended to.\r\n\r\nOSS-Fuzz is not impacted by the backdoor, because the backdoor never ran on OSS-Fuzz. In addition, OSS-Fuzz runs code in a sandboxed environment so malicious developers/projects cannot harm OSS-Fuzz.\r\n\r\nUPDATE 2:\r\nI wanted to highlight the half-dozen reasons why the backdoor would never have been discovered by OSS-Fuzz. It's totally implausible that it would have been discovered here.\r\n\r\n1. This pull request fixed a build breakage caused by a compiler issue. The compiler issue was never fixed, so without this pull request, OSS-Fuzz would have never fuzzed an XZ version after June 2023, the backdoor was added in March 2024.\r\n2. The XZ backdoor only built in the tarballs included in the 5.6.0 and 5.6.1 branches and not in the master branch of the git repo that OSS-Fuzz was cloning.\r\n3. The XZ backdoor was only built when using build options for DEB or RPM packages. OSS-Fuzz was using neither: https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=Running%20as%20part%20of%20a%20debian%20or%20RPM%20package%20build\r\n(this analysis is from the person who discovered the backdoor).\r\n4. The XZ backdoor only ran when `argv[0]` was `/usr/sbin/sshd` This would never happen in OSS-Fuzz, only in a real environment https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=argv%5B0%5D%20needs%20to%20be%20/usr/sbin/sshd\r\n5. Nothing OSS-Fuzz does is secret, all the tests and code are public. This was a well planned attack and if the backdoor was going to be run on OSS-Fuzz (which it was not), it is very likely \"Jia Tan\" would have made sure the tests passed. This is very similar to malware writers who test their malware against antivirus until it is undetectable. OSS-Fuzz is in the business of finding accidental bugs not intentional ones.\r\n6. OSS-Fuzz does not detect backdoors and it never has detected one. The backdoor's buginess did lead to it being discovered by Valgrind. However OSS-Fuzz's bug detectors would not have found the same issues. OSS-Fuzz uses ASAN to detect memory corruption bugs. ASAN requires instrumentation of a binary to detect bugs in the binary. This is not the case with Valgrind. The backdoor was not instrumented with ASAN, so OSS-Fuzz would not be able to detect bugs in the backdoor (in this case), though someone using Valgrind could detect them.\r\n\r\nTo summarize: the backdoor never ran on OSS-Fuzz and OSS-Fuzz would not detect the backdoor if it magically ran on OSS-Fuzz.\r\n\r\nUPDATE 3:\r\nThis patch fixes an actual false positive in ASAN.\r\nIf you change the old XZ dockerfile to check out the XZ source at the time of this PR, you can see how the fuzzers segfault immediately like all other users of ASAN and ifuncs.\r\nASAN's false positives can still be reproduced using this test file in OSS-Fuzz (and possibly other clang-15 builds)\r\n```\r\nvoid crunch1(void) {}\r\nvoid crunch2(void) {}\r\n\r\n__attribute__((__ifunc__(\"resolve_crunch\")))\r\nvoid crunch(void);\r\n\r\n// __attribute__((__used__,__no_sanitize_address__))\r\nstatic __typeof__(crunch)* resolve_crunch(void)\r\n{\r\n\t__builtin_cpu_init();\r\n\treturn __builtin_cpu_supports(\"avx\") ? crunch1 : crunch2;\r\n}\r\n\r\nint main(void)\r\n{\r\n\tcrunch();\r\n}\r\n```\r\n","commit_id":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","submitted_at":"2023-07-07T14:00:55Z","state":"approved","html_url":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986","pull_request_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","author_association":"CONTRIBUTOR","_links":{"html":{"href":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986"},"pull_request":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"}}},"pull_request":{"url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","id":1424714538,"node_id":"PR_kwDOA82mtc5U62sq","html_url":"https://github.com/google/oss-fuzz/pull/10667","diff_url":"https://github.com/google/oss-fuzz/pull/10667.diff","patch_url":"https://github.com/google/oss-fuzz/pull/10667.patch","issue_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667","number":10667,"state":"closed","locked":true,"title":"xz: Disable ifunc to fix Issue 60259.","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"body":"Indirect function support was added to xz on machines that support it for function dispatching. ifunc is not compatible with -fsanitize=address, so this should be disabled for fuzzing builds.","created_at":"2023-07-07T13:49:31Z","updated_at":"2024-04-03T13:21:30Z","closed_at":"2023-07-07T14:01:16Z","merged_at":"2023-07-07T14:01:16Z","merge_commit_sha":"d2e42b2e489eac6fe6268e381b7db151f4c892c5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[{"id":5560466969,"node_id":"LA_kwDOA82mtc8AAAABS23-GQ","url":"https://api.github.com/repos/google/oss-fuzz/labels/ready%20to%20merge","name":"ready to merge","color":"0E8A16","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits","review_comments_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments","review_comment_url":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}","comments_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d","head":{"label":"JiaT75:jiatan_xz_updates","ref":"jiatan_xz_updates","sha":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"repo":{"id":616460661,"node_id":"R_kgDOJL5xdQ","name":"oss-fuzz","full_name":"JiaT75/oss-fuzz","private":false,"owner":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"html_url":"https://github.com/JiaT75/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":true,"url":"https://api.github.com/repos/JiaT75/oss-fuzz","forks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/forks","keys_url":"https://api.github.com/repos/JiaT75/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/JiaT75/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/JiaT75/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/events","assignees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/JiaT75/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/JiaT75/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/JiaT75/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/JiaT75/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/JiaT75/oss-fuzz/merges","archive_url":"https://api.github.com/repos/JiaT75/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/JiaT75/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/JiaT75/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/JiaT75/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/JiaT75/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/JiaT75/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/JiaT75/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/deployments","created_at":"2023-03-20T12:41:49Z","updated_at":"2024-04-01T13:50:25Z","pushed_at":"2024-02-12T12:43:36Z","git_url":"git://github.com/JiaT75/oss-fuzz.git","ssh_url":"git@github.com:JiaT75/oss-fuzz.git","clone_url":"https://github.com/JiaT75/oss-fuzz.git","svn_url":"https://github.com/JiaT75/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":42338,"stargazers_count":1,"watchers_count":1,"language":"Shell","has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":1,"default_branch":"master"}},"base":{"label":"google:master","ref":"master","sha":"451c04cf8c2ae4654d8188ab23859a1b27b4bce1","user":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"repo":{"id":63809205,"node_id":"MDEwOlJlcG9zaXRvcnk2MzgwOTIwNQ==","name":"oss-fuzz","full_name":"google/oss-fuzz","private":false,"owner":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/google/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":false,"url":"https://api.github.com/repos/google/oss-fuzz","forks_url":"https://api.github.com/repos/google/oss-fuzz/forks","keys_url":"https://api.github.com/repos/google/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/google/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/google/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/google/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/google/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/google/oss-fuzz/events","assignees_url":"https://api.github.com/repos/google/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/google/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/google/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/google/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/google/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/google/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/google/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/google/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/google/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/google/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/google/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/google/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/google/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/google/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/google/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/google/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/google/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/google/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/google/oss-fuzz/merges","archive_url":"https://api.github.com/repos/google/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/google/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/google/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/google/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/google/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/google/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/google/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/google/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/google/oss-fuzz/deployments","created_at":"2016-07-20T19:39:50Z","updated_at":"2024-04-03T11:54:21Z","pushed_at":"2024-04-03T09:33:34Z","git_url":"git://github.com/google/oss-fuzz.git","ssh_url":"git@github.com:google/oss-fuzz.git","clone_url":"https://github.com/google/oss-fuzz.git","svn_url":"https://github.com/google/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":44507,"stargazers_count":9774,"watchers_count":9774,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":2086,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":473,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["fuzz-testing","fuzzing","oss-fuzz","security","stability","vulnerabilities"],"visibility":"public","forks":2086,"open_issues":473,"watchers":9774,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"},"html":{"href":"https://github.com/google/oss-fuzz/pull/10667"},"issue":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667"},"comments":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments"},"review_comments":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments"},"review_comment":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits"},"statuses":{"href":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":"off-topic"}},"public":true,"created_at":"2024-04-03T13:21:30Z","org":{"id":1342004,"login":"google","gravatar_id":"","url":"https://api.github.com/orgs/google","avatar_url":"https://avatars.githubusercontent.com/u/1342004?"}}
{"id":"37127304547","type":"PullRequestReviewEvent","actor":{"id":31354670,"login":"jonathanmetzman","display_login":"jonathanmetzman","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","avatar_url":"https://avatars.githubusercontent.com/u/31354670?"},"repo":{"id":63809205,"name":"google/oss-fuzz","url":"https://api.github.com/repos/google/oss-fuzz"},"payload":{"action":"created","review":{"id":1518981986,"node_id":"PRR_kwDOA82mtc5aidNi","user":{"login":"jonathanmetzman","id":31354670,"node_id":"MDQ6VXNlcjMxMzU0Njcw","avatar_url":"https://avatars.githubusercontent.com/u/31354670?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanmetzman","html_url":"https://github.com/jonathanmetzman","followers_url":"https://api.github.com/users/jonathanmetzman/followers","following_url":"https://api.github.com/users/jonathanmetzman/following{/other_user}","gists_url":"https://api.github.com/users/jonathanmetzman/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanmetzman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanmetzman/subscriptions","organizations_url":"https://api.github.com/users/jonathanmetzman/orgs","repos_url":"https://api.github.com/users/jonathanmetzman/repos","events_url":"https://api.github.com/users/jonathanmetzman/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanmetzman/received_events","type":"User","site_admin":false},"body":"tl;dr This patch did not prevent OSS-Fuzz from finding the backdoor, OSS-Fuzz is incapable of finding the backdoor, this patch is not suspicious, and OSS-Fuzz is not meant to find bugs when users do not want them found.\r\n\r\nUPDATE:\r\nThere is no backdoor in this patch.\r\nThis repo provides a testing service to open source developers to help them find bugs in their code.\r\nWe allow developers to control 100% of what gets tested by our service. They own the code they submit to us, our reviews only mean we verified this is a project maintainer. Unfortunately we were told by the other XZ maintainer that \"Jia Tan\" was a maintainer. \r\nIf users don't want code tested, an automated tool like this can't stop them and was never intended to.\r\n\r\nOSS-Fuzz is not impacted by the backdoor, because the backdoor never ran on OSS-Fuzz. In addition, OSS-Fuzz runs code in a sandboxed environment so malicious developers/projects cannot harm OSS-Fuzz.\r\n\r\nUPDATE 2:\r\nI wanted to highlight the half-dozen reasons why the backdoor would never have been discovered by OSS-Fuzz. It's totally implausible that it would have been discovered here.\r\n\r\n1. This pull request fixed a build breakage caused by a compiler issue. The compiler issue was never fixed, so without this pull request, OSS-Fuzz would have never fuzzed an XZ version after June 2023, the backdoor was added in March 2024.\r\n2. The XZ backdoor only built in the tarballs included in the 5.6.0 and 5.6.1 branches and not in the master branch of the git repo that OSS-Fuzz was cloning.\r\n3. The XZ backdoor was only built when using build options for DEB or RPM packages. OSS-Fuzz was using neither: https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=Running%20as%20part%20of%20a%20debian%20or%20RPM%20package%20build\r\n(this analysis is from the person who discovered the backdoor).\r\n4. The XZ backdoor only ran when `argv[0]` was `/usr/sbin/sshd` This would never happen in OSS-Fuzz, only in a real environment https://openwall.com/lists/oss-security/2024/03/29/4#:~:text=argv%5B0%5D%20needs%20to%20be%20/usr/sbin/sshd\r\n5. Nothing OSS-Fuzz does is secret, all the tests and code are public. This was a well planned attack and if the backdoor was going to be run on OSS-Fuzz (which it was not), it is very likely \"Jia Tan\" would have made sure the tests passed. This is very similar to malware writers who test their malware against antivirus until it is undetectable. OSS-Fuzz is in the business of finding accidental bugs not intentional ones.\r\n6. OSS-Fuzz does not detect backdoors and it never has detected one. The backdoor's buginess did lead to it being discovered by Valgrind. However OSS-Fuzz's bug detectors would not have found the same issues. OSS-Fuzz uses ASAN to detect memory corruption bugs. ASAN requires instrumentation of a binary to detect bugs in the binary. This is not the case with Valgrind. The backdoor was not instrumented with ASAN, so OSS-Fuzz would not be able to detect bugs in the backdoor (in this case), though someone using Valgrind could detect them.\r\n\r\nTo summarize: the backdoor never ran on OSS-Fuzz and OSS-Fuzz would not detect the backdoor if somehow it magically ran on OSS-Fuzz.\r\n\r\nUPDATE 3:\r\nThis patch fixes an actual false positive in ASAN.\r\nIf you change the old XZ dockerfile to check out the XZ source at the time of this PR, you can see how the fuzzers segfault immediately like all other users of ASAN and ifuncs.\r\nASAN's false positives can still be reproduced using this test file in OSS-Fuzz (and possibly other clang-15 builds)\r\n```\r\nvoid crunch1(void) {}\r\nvoid crunch2(void) {}\r\n\r\n__attribute__((__ifunc__(\"resolve_crunch\")))\r\nvoid crunch(void);\r\n\r\n// __attribute__((__used__,__no_sanitize_address__))\r\nstatic __typeof__(crunch)* resolve_crunch(void)\r\n{\r\n\t__builtin_cpu_init();\r\n\treturn __builtin_cpu_supports(\"avx\") ? crunch1 : crunch2;\r\n}\r\n\r\nint main(void)\r\n{\r\n\tcrunch();\r\n}\r\n```\r\n","commit_id":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","submitted_at":"2023-07-07T14:00:55Z","state":"approved","html_url":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986","pull_request_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","author_association":"CONTRIBUTOR","_links":{"html":{"href":"https://github.com/google/oss-fuzz/pull/10667#pullrequestreview-1518981986"},"pull_request":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"}}},"pull_request":{"url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667","id":1424714538,"node_id":"PR_kwDOA82mtc5U62sq","html_url":"https://github.com/google/oss-fuzz/pull/10667","diff_url":"https://github.com/google/oss-fuzz/pull/10667.diff","patch_url":"https://github.com/google/oss-fuzz/pull/10667.patch","issue_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667","number":10667,"state":"closed","locked":true,"title":"xz: Disable ifunc to fix Issue 60259.","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"body":"Indirect function support was added to xz on machines that support it for function dispatching. ifunc is not compatible with -fsanitize=address, so this should be disabled for fuzzing builds.","created_at":"2023-07-07T13:49:31Z","updated_at":"2024-04-03T13:24:37Z","closed_at":"2023-07-07T14:01:16Z","merged_at":"2023-07-07T14:01:16Z","merge_commit_sha":"d2e42b2e489eac6fe6268e381b7db151f4c892c5","assignee":null,"assignees":[],"requested_reviewers":[],"requested_teams":[],"labels":[{"id":5560466969,"node_id":"LA_kwDOA82mtc8AAAABS23-GQ","url":"https://api.github.com/repos/google/oss-fuzz/labels/ready%20to%20merge","name":"ready to merge","color":"0E8A16","default":false,"description":""}],"milestone":null,"draft":false,"commits_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits","review_comments_url":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments","review_comment_url":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}","comments_url":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d","head":{"label":"JiaT75:jiatan_xz_updates","ref":"jiatan_xz_updates","sha":"d7e58a7704ac07a8c01e6dc7e5701728d639902d","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"repo":{"id":616460661,"node_id":"R_kgDOJL5xdQ","name":"oss-fuzz","full_name":"JiaT75/oss-fuzz","private":false,"owner":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"html_url":"https://github.com/JiaT75/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":true,"url":"https://api.github.com/repos/JiaT75/oss-fuzz","forks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/forks","keys_url":"https://api.github.com/repos/JiaT75/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/JiaT75/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/JiaT75/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/JiaT75/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/JiaT75/oss-fuzz/events","assignees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/JiaT75/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/JiaT75/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/JiaT75/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/JiaT75/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/JiaT75/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/JiaT75/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/JiaT75/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/JiaT75/oss-fuzz/merges","archive_url":"https://api.github.com/repos/JiaT75/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/JiaT75/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/JiaT75/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/JiaT75/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/JiaT75/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/JiaT75/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/JiaT75/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/JiaT75/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/JiaT75/oss-fuzz/deployments","created_at":"2023-03-20T12:41:49Z","updated_at":"2024-04-01T13:50:25Z","pushed_at":"2024-02-12T12:43:36Z","git_url":"git://github.com/JiaT75/oss-fuzz.git","ssh_url":"git@github.com:JiaT75/oss-fuzz.git","clone_url":"https://github.com/JiaT75/oss-fuzz.git","svn_url":"https://github.com/JiaT75/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":42338,"stargazers_count":1,"watchers_count":1,"language":"Shell","has_issues":false,"has_projects":true,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":0,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":0,"open_issues":0,"watchers":1,"default_branch":"master"}},"base":{"label":"google:master","ref":"master","sha":"451c04cf8c2ae4654d8188ab23859a1b27b4bce1","user":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"repo":{"id":63809205,"node_id":"MDEwOlJlcG9zaXRvcnk2MzgwOTIwNQ==","name":"oss-fuzz","full_name":"google/oss-fuzz","private":false,"owner":{"login":"google","id":1342004,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzNDIwMDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1342004?v=4","gravatar_id":"","url":"https://api.github.com/users/google","html_url":"https://github.com/google","followers_url":"https://api.github.com/users/google/followers","following_url":"https://api.github.com/users/google/following{/other_user}","gists_url":"https://api.github.com/users/google/gists{/gist_id}","starred_url":"https://api.github.com/users/google/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/google/subscriptions","organizations_url":"https://api.github.com/users/google/orgs","repos_url":"https://api.github.com/users/google/repos","events_url":"https://api.github.com/users/google/events{/privacy}","received_events_url":"https://api.github.com/users/google/received_events","type":"Organization","site_admin":false},"html_url":"https://github.com/google/oss-fuzz","description":"OSS-Fuzz - continuous fuzzing for open source software.","fork":false,"url":"https://api.github.com/repos/google/oss-fuzz","forks_url":"https://api.github.com/repos/google/oss-fuzz/forks","keys_url":"https://api.github.com/repos/google/oss-fuzz/keys{/key_id}","collaborators_url":"https://api.github.com/repos/google/oss-fuzz/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/google/oss-fuzz/teams","hooks_url":"https://api.github.com/repos/google/oss-fuzz/hooks","issue_events_url":"https://api.github.com/repos/google/oss-fuzz/issues/events{/number}","events_url":"https://api.github.com/repos/google/oss-fuzz/events","assignees_url":"https://api.github.com/repos/google/oss-fuzz/assignees{/user}","branches_url":"https://api.github.com/repos/google/oss-fuzz/branches{/branch}","tags_url":"https://api.github.com/repos/google/oss-fuzz/tags","blobs_url":"https://api.github.com/repos/google/oss-fuzz/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/google/oss-fuzz/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/google/oss-fuzz/git/refs{/sha}","trees_url":"https://api.github.com/repos/google/oss-fuzz/git/trees{/sha}","statuses_url":"https://api.github.com/repos/google/oss-fuzz/statuses/{sha}","languages_url":"https://api.github.com/repos/google/oss-fuzz/languages","stargazers_url":"https://api.github.com/repos/google/oss-fuzz/stargazers","contributors_url":"https://api.github.com/repos/google/oss-fuzz/contributors","subscribers_url":"https://api.github.com/repos/google/oss-fuzz/subscribers","subscription_url":"https://api.github.com/repos/google/oss-fuzz/subscription","commits_url":"https://api.github.com/repos/google/oss-fuzz/commits{/sha}","git_commits_url":"https://api.github.com/repos/google/oss-fuzz/git/commits{/sha}","comments_url":"https://api.github.com/repos/google/oss-fuzz/comments{/number}","issue_comment_url":"https://api.github.com/repos/google/oss-fuzz/issues/comments{/number}","contents_url":"https://api.github.com/repos/google/oss-fuzz/contents/{+path}","compare_url":"https://api.github.com/repos/google/oss-fuzz/compare/{base}...{head}","merges_url":"https://api.github.com/repos/google/oss-fuzz/merges","archive_url":"https://api.github.com/repos/google/oss-fuzz/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/google/oss-fuzz/downloads","issues_url":"https://api.github.com/repos/google/oss-fuzz/issues{/number}","pulls_url":"https://api.github.com/repos/google/oss-fuzz/pulls{/number}","milestones_url":"https://api.github.com/repos/google/oss-fuzz/milestones{/number}","notifications_url":"https://api.github.com/repos/google/oss-fuzz/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/google/oss-fuzz/labels{/name}","releases_url":"https://api.github.com/repos/google/oss-fuzz/releases{/id}","deployments_url":"https://api.github.com/repos/google/oss-fuzz/deployments","created_at":"2016-07-20T19:39:50Z","updated_at":"2024-04-03T11:54:21Z","pushed_at":"2024-04-03T09:33:34Z","git_url":"git://github.com/google/oss-fuzz.git","ssh_url":"git@github.com:google/oss-fuzz.git","clone_url":"https://github.com/google/oss-fuzz.git","svn_url":"https://github.com/google/oss-fuzz","homepage":"https://google.github.io/oss-fuzz","size":44507,"stargazers_count":9774,"watchers_count":9774,"language":"Shell","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":2086,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":473,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["fuzz-testing","fuzzing","oss-fuzz","security","stability","vulnerabilities"],"visibility":"public","forks":2086,"open_issues":473,"watchers":9774,"default_branch":"master"}},"_links":{"self":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667"},"html":{"href":"https://github.com/google/oss-fuzz/pull/10667"},"issue":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667"},"comments":{"href":"https://api.github.com/repos/google/oss-fuzz/issues/10667/comments"},"review_comments":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/comments"},"review_comment":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/comments{/number}"},"commits":{"href":"https://api.github.com/repos/google/oss-fuzz/pulls/10667/commits"},"statuses":{"href":"https://api.github.com/repos/google/oss-fuzz/statuses/d7e58a7704ac07a8c01e6dc7e5701728d639902d"}},"author_association":"CONTRIBUTOR","auto_merge":null,"active_lock_reason":"off-topic"}},"public":true,"created_at":"2024-04-03T13:24:38Z","org":{"id":1342004,"login":"google","gravatar_id":"","url":"https://api.github.com/orgs/google","avatar_url":"https://avatars.githubusercontent.com/u/1342004?"}}
{"id":"37128435769","type":"IssueCommentEvent","actor":{"id":1398793,"login":"kientzle","display_login":"kientzle","gravatar_id":"","url":"https://api.github.com/users/kientzle","avatar_url":"https://avatars.githubusercontent.com/u/1398793?"},"repo":{"id":3219804,"name":"libarchive/libarchive","url":"https://api.github.com/repos/libarchive/libarchive"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/libarchive/libarchive/issues/1606","repository_url":"https://api.github.com/repos/libarchive/libarchive","labels_url":"https://api.github.com/repos/libarchive/libarchive/issues/1606/labels{/name}","comments_url":"https://api.github.com/repos/libarchive/libarchive/issues/1606/comments","events_url":"https://api.github.com/repos/libarchive/libarchive/issues/1606/events","html_url":"https://github.com/libarchive/libarchive/pull/1606","id":1037470254,"node_id":"PR_kwDOADEhXM4tvngn","number":1606,"title":"Cleaned up archive_read_disk_descend functions","user":{"login":"JiaT75","id":78042786,"node_id":"MDQ6VXNlcjc4MDQyNzg2","avatar_url":"https://avatars.githubusercontent.com/u/78042786?v=4","gravatar_id":"","url":"https://api.github.com/users/JiaT75","html_url":"https://github.com/JiaT75","followers_url":"https://api.github.com/users/JiaT75/followers","following_url":"https://api.github.com/users/JiaT75/following{/other_user}","gists_url":"https://api.github.com/users/JiaT75/gists{/gist_id}","starred_url":"https://api.github.com/users/JiaT75/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JiaT75/subscriptions","organizations_url":"https://api.github.com/users/JiaT75/orgs","repos_url":"https://api.github.com/users/JiaT75/repos","events_url":"https://api.github.com/users/JiaT75/events{/privacy}","received_events_url":"https://api.github.com/users/JiaT75/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-10-27T14:07:51Z","updated_at":"2024-04-03T13:52:19Z","closed_at":"2021-11-15T23:46:53Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/libarchive/libarchive/pulls/1606","html_url":"https://github.com/libarchive/libarchive/pull/1606","diff_url":"https://github.com/libarchive/libarchive/pull/1606.diff","patch_url":"https://github.com/libarchive/libarchive/pull/1606.patch","merged_at":"2021-11-15T23:46:53Z"},"body":"Moved the code changes out of the documentation changes to the man pages for archive_read_disk.","reactions":{"url":"https://api.github.com/repos/libarchive/libarchive/issues/1606/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libarchive/libarchive/issues/1606/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/libarchive/libarchive/issues/comments/2034679035","html_url":"https://github.com/libarchive/libarchive/pull/1606#issuecomment-2034679035","issue_url":"https://api.github.com/repos/libarchive/libarchive/issues/1606","id":2034679035,"node_id":"IC_kwDOADEhXM55Rrz7","user":{"login":"kientzle","id":1398793,"node_id":"MDQ6VXNlcjEzOTg3OTM=","avatar_url":"https://avatars.githubusercontent.com/u/1398793?v=4","gravatar_id":"","url":"https://api.github.com/users/kientzle","html_url":"https://github.com/kientzle","followers_url":"https://api.github.com/users/kientzle/followers","following_url":"https://api.github.com/users/kientzle/following{/other_user}","gists_url":"https://api.github.com/users/kientzle/gists{/gist_id}","starred_url":"https://api.github.com/users/kientzle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kientzle/subscriptions","organizations_url":"https://api.github.com/users/kientzle/orgs","repos_url":"https://api.github.com/users/kientzle/repos","events_url":"https://api.github.com/users/kientzle/events{/privacy}","received_events_url":"https://api.github.com/users/kientzle/received_events","type":"User","site_admin":false},"created_at":"2024-04-03T13:52:18Z","updated_at":"2024-04-03T13:52:18Z","author_association":"CONTRIBUTOR","body":"`archive_check_magic()` is designed to be called at the beginning of each public API function.  It helps guard against basic errors by software that uses libarchive.   Changing `archive_read_disk_can_descend()` to use a different return type might be a reasonable change that would make the code easier to understand.  But it is part of the public API (declared in `archive.h`) and so we can't change it without a major version bump.  (Any PR that proposes changing this should be guarded with `#if ARCHIVE_VERSION_NUMBER >= 4000000` to ensure it doesn't take effect before libarchive 4.0.)\r\n\r\nFor a trivial function like this, it might make sense to remove the magic check.  Again, that check is there is to help developers use libarchive by giving them a clear error when they call functions that aren't reasonable in a certain context.  For a trivial status function like this, that check is less useful.","reactions":{"url":"https://api.github.com/repos/libarchive/libarchive/issues/comments/2034679035/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-04-03T13:52:19Z","org":{"id":1354741,"login":"libarchive","gravatar_id":"","url":"https://api.github.com/orgs/libarchive","avatar_url":"https://avatars.githubusercontent.com/u/1354741?"}}
