{"id":"35973306573","type":"IssueCommentEvent","actor":{"id":11667869,"login":"thesamesam","display_login":"thesamesam","gravatar_id":"","url":"https://api.github.com/users/thesamesam","avatar_url":"https://avatars.githubusercontent.com/u/11667869?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/85","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/85/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/85/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/85/events","html_url":"https://github.com/tukaani-project/xz/issues/85","id":2152403600,"node_id":"I_kwDOIQBEvs6ASxKQ","number":85,"title":"[Bug?]: Default option. Non determinism in multithreads?","user":{"login":"milkylainen","id":9418255,"node_id":"MDQ6VXNlcjk0MTgyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9418255?v=4","gravatar_id":"","url":"https://api.github.com/users/milkylainen","html_url":"https://github.com/milkylainen","followers_url":"https://api.github.com/users/milkylainen/followers","following_url":"https://api.github.com/users/milkylainen/following{/other_user}","gists_url":"https://api.github.com/users/milkylainen/gists{/gist_id}","starred_url":"https://api.github.com/users/milkylainen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milkylainen/subscriptions","organizations_url":"https://api.github.com/users/milkylainen/orgs","repos_url":"https://api.github.com/users/milkylainen/repos","events_url":"https://api.github.com/users/milkylainen/events{/privacy}","received_events_url":"https://api.github.com/users/milkylainen/received_events","type":"User","site_admin":false},"labels":[{"id":4687621022,"node_id":"LA_kwDOIQBEvs8AAAABF2drng","url":"https://api.github.com/repos/tukaani-project/xz/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-02-24T16:59:20Z","updated_at":"2024-02-24T17:07:39Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"Well. Not really a bug, but perhaps more a question of default and helpful information.\r\nPlease correct me if I'm wrong here.\r\nI've always lived with the assumption that using xz with more than one thread isn't deterministic.\r\nIe, the compression result will vary with threads?\r\nBy changing the default, various usages will start to perhaps experience different results when building on different machines.\r\nLike packagers, embedded build envs etc.\r\n\r\nHas anything changed in the determinism department or can users just expect that default is to create variable results with the defaults?\r\n\r\n### Version\r\n\r\n5.6\r\n\r\n### Operating System\r\n\r\nLinux\r\n\r\n### Relevant log output\r\n\r\n_No response_","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/85/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/85/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/1962424817","html_url":"https://github.com/tukaani-project/xz/issues/85#issuecomment-1962424817","issue_url":"https://api.github.com/repos/tukaani-project/xz/issues/85","id":1962424817,"node_id":"IC_kwDOIQBEvs50-Dnx","user":{"login":"thesamesam","id":11667869,"node_id":"MDQ6VXNlcjExNjY3ODY5","avatar_url":"https://avatars.githubusercontent.com/u/11667869?v=4","gravatar_id":"","url":"https://api.github.com/users/thesamesam","html_url":"https://github.com/thesamesam","followers_url":"https://api.github.com/users/thesamesam/followers","following_url":"https://api.github.com/users/thesamesam/following{/other_user}","gists_url":"https://api.github.com/users/thesamesam/gists{/gist_id}","starred_url":"https://api.github.com/users/thesamesam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thesamesam/subscriptions","organizations_url":"https://api.github.com/users/thesamesam/orgs","repos_url":"https://api.github.com/users/thesamesam/repos","events_url":"https://api.github.com/users/thesamesam/events{/privacy}","received_events_url":"https://api.github.com/users/thesamesam/received_events","type":"User","site_admin":false},"created_at":"2024-02-24T17:07:38Z","updated_at":"2024-02-24T17:07:38Z","author_association":"NONE","body":"Please see https://github.com/tukaani-project/xz/commit/6daa4d0ea46a8441f21f609149f3633158bf4704:\r\n>   - Output from single-threaded and multi-threaded compressors\r\n>    differ but such changes could happen for other reasons too\r\n>    (they just haven't happened since 5.0.0).\r\n\r\nI believe (although see if a maintainer confirms) that the threaded compressor is deterministic if it's used (so it doesn't depend on the thread count and so on).","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/1962424817/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-02-24T17:07:39Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
{"id":"35973334017","type":"IssueCommentEvent","actor":{"id":1096701,"login":"satmandu","display_login":"satmandu","gravatar_id":"","url":"https://api.github.com/users/satmandu","avatar_url":"https://avatars.githubusercontent.com/u/1096701?"},"repo":{"id":553665726,"name":"tukaani-project/xz","url":"https://api.github.com/repos/tukaani-project/xz"},"payload":{"action":"created","issue":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/84","repository_url":"https://api.github.com/repos/tukaani-project/xz","labels_url":"https://api.github.com/repos/tukaani-project/xz/issues/84/labels{/name}","comments_url":"https://api.github.com/repos/tukaani-project/xz/issues/84/comments","events_url":"https://api.github.com/repos/tukaani-project/xz/issues/84/events","html_url":"https://github.com/tukaani-project/xz/issues/84","id":2152384446,"node_id":"I_kwDOIQBEvs6ASse-","number":84,"title":"[Bug]:  5.6.0 build issue","user":{"login":"satmandu","id":1096701,"node_id":"MDQ6VXNlcjEwOTY3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/1096701?v=4","gravatar_id":"","url":"https://api.github.com/users/satmandu","html_url":"https://github.com/satmandu","followers_url":"https://api.github.com/users/satmandu/followers","following_url":"https://api.github.com/users/satmandu/following{/other_user}","gists_url":"https://api.github.com/users/satmandu/gists{/gist_id}","starred_url":"https://api.github.com/users/satmandu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/satmandu/subscriptions","organizations_url":"https://api.github.com/users/satmandu/orgs","repos_url":"https://api.github.com/users/satmandu/repos","events_url":"https://api.github.com/users/satmandu/events{/privacy}","received_events_url":"https://api.github.com/users/satmandu/received_events","type":"User","site_admin":false},"labels":[{"id":4687621022,"node_id":"LA_kwDOIQBEvs8AAAABF2drng","url":"https://api.github.com/repos/tukaani-project/xz/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-02-24T16:21:05Z","updated_at":"2024-02-24T17:10:08Z","closed_at":null,"author_association":"NONE","active_lock_reason":null,"body":"### Describe the bug\r\n\r\nFails to build on armv7l. built with `--enable-shared`\r\n\r\n\r\n### Version\r\n\r\n5.6.0\r\n\r\n### Operating System\r\n\r\nChromeOS, M91\r\n\r\n### Relevant log output\r\n\r\n```shell\r\nmake  all-recursive\r\nmake[1]: Entering directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0'\r\nMaking all in src\r\nmake[2]: Entering directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src'\r\nMaking all in liblzma\r\nmake[3]: Entering directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src/liblzma'\r\nMaking all in api\r\nmake[4]: Entering directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src/liblzma/api'\r\nmake[4]: Nothing to be done for 'all'.\r\nmake[4]: Leaving directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src/liblzma/api'\r\nmake[4]: Entering directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src/liblzma'\r\nmake[4]: Nothing to be done for 'all-am'.\r\nmake[4]: Leaving directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src/liblzma'\r\nmake[3]: Leaving directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src/liblzma'\r\nMaking all in xzdec\r\nmake[3]: Entering directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src/xzdec'\r\narmv7l-cros-linux-gnueabihf-gcc -DHAVE_CONFIG_H -I. -I../..  -DTUKLIB_GETTEXT=0 -I../../src/common -I../../src/liblzma/api -I../../lib  -pthread -fvisibility=hidden -Wall -Wextra -Wvla -Wformat=2 -Winit-self -Wmissing-include-dirs -Wshift-overflow=2 -Wstrict-overflow=3 -Walloc-zero -Wduplicated-cond -Wfloat-equal -Wundef -Wshadow -Wpointer-arith -Wbad-function-cast -Wwrite-strings -Wdate-time -Wsign-conversion -Wfloat-conversion -Wlogical-op -Waggregate-return -Wstrict-prototypes -Wold-style-definition -Wmissing-prototypes -Wmissing-declarations -Wredundant-decls -O2 -pipe -ffat-lto-objects -fPIC -mfloat-abi=hard -mthumb -mfpu=vfpv3-d16 -march=armv7-a+fp -fuse-ld=mold  -flto=auto -c -o xzdec-xzdec.o `test -f 'xzdec.c' || echo './'`xzdec.c\r\nxzdec.c: In function ‘sandbox_enter’:\r\nxzdec.c:329:36: error: ‘SYS_landlock_create_ruleset’ undeclared (first use in this function)\r\n  329 |         int landlock_abi = syscall(SYS_landlock_create_ruleset,\r\n      |                                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nxzdec.c:329:36: note: each undeclared identifier is reported only once for each function it appears in\r\nxzdec.c:349:29: error: ‘SYS_landlock_restrict_self’ undeclared (first use in this function)\r\n  349 |                 if (syscall(SYS_landlock_restrict_self, ruleset_fd, 0U) != 0)\r\n      |                             ^~~~~~~~~~~~~~~~~~~~~~~~~~\r\nmake[3]: *** [Makefile:610: xzdec-xzdec.o] Error 1\r\nmake[3]: Leaving directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src/xzdec'\r\nmake[2]: *** [Makefile:427: all-recursive] Error 1\r\nmake[2]: Leaving directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0/src'\r\nmake[1]: *** [Makefile:597: all-recursive] Error 1\r\nmake[1]: Leaving directory '/usr/local/tmp/crew/xzutils.20240224160935.dir/xz-5.6.0'\r\nmake: *** [Makefile:487: all] Error 2\r\nThere was a build error.\r\n```","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/84/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tukaani-project/xz/issues/84/timeline","performed_via_github_app":null,"state_reason":null},"comment":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/1962425297","html_url":"https://github.com/tukaani-project/xz/issues/84#issuecomment-1962425297","issue_url":"https://api.github.com/repos/tukaani-project/xz/issues/84","id":1962425297,"node_id":"IC_kwDOIQBEvs50-DvR","user":{"login":"satmandu","id":1096701,"node_id":"MDQ6VXNlcjEwOTY3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/1096701?v=4","gravatar_id":"","url":"https://api.github.com/users/satmandu","html_url":"https://github.com/satmandu","followers_url":"https://api.github.com/users/satmandu/followers","following_url":"https://api.github.com/users/satmandu/following{/other_user}","gists_url":"https://api.github.com/users/satmandu/gists{/gist_id}","starred_url":"https://api.github.com/users/satmandu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/satmandu/subscriptions","organizations_url":"https://api.github.com/users/satmandu/orgs","repos_url":"https://api.github.com/users/satmandu/repos","events_url":"https://api.github.com/users/satmandu/events{/privacy}","received_events_url":"https://api.github.com/users/satmandu/received_events","type":"User","site_admin":false},"created_at":"2024-02-24T17:10:07Z","updated_at":"2024-02-24T17:10:07Z","author_association":"NONE","body":"Same issue building with `cmake`:\r\n```\r\nFAILED: CMakeFiles/xzdec.dir/src/xzdec/xzdec.c.o\r\n/usr/local/bin/cc -DHAVE_CHECK_CRC32 -DHAVE_CHECK_CRC64 -DHAVE_CHECK_SHA256 -DHAVE_CLOCK_GETTIME -DHAVE_CLOCK_MONOTONIC -DHAVE_DECODERS -DHAVE_DECODER_ARM -DHAVE_DECODER_ARM64 -DHAVE_DECODER_ARMTHUMB -DHAVE_DECODER_DELTA -DHAVE_DECODER_IA64 -DHAVE_DECODER_LZMA1 -DHAVE_DECODER_LZMA2 -DHAVE_DECODER_POWERPC -DHAVE_DECODER_RISCV -DHAVE_DECODER_SPARC -DHAVE_DECODER_X86 -DHAVE_ENCODERS -DHAVE_ENCODER_ARM -DHAVE_ENCODER_ARM64 -DHAVE_ENCODER_ARMTHUMB -DHAVE_ENCODER_DELTA -DHAVE_ENCODER_IA64 -DHAVE_ENCODER_LZMA1 -DHAVE_ENCODER_LZMA2 -DHAVE_ENCODER_POWERPC -DHAVE_ENCODER_RISCV -DHAVE_ENCODER_SPARC -DHAVE_ENCODER_X86 -DHAVE_INTTYPES_H -DHAVE_LINUX_LANDLOCK_H -DHAVE_LZIP_DECODER -DHAVE_MF_BT2 -DHAVE_MF_BT3 -DHAVE_MF_BT4 -DHAVE_MF_HC3 -DHAVE_MF_HC4 -DHAVE_MICROLZMA -DHAVE_PROGRAM_INVOCATION_NAME -DHAVE_PTHREAD_CONDATTR_SETCLOCK -DHAVE_STDBOOL_H -DHAVE_STDINT_H -DHAVE__BOOL -DHAVE___BUILTIN_ASSUME_ALIGNED -DHAVE___BUILTIN_BSWAPXX -DMYTHREAD_POSIX -DPACKAGE_BUGREPORT=\\\"xz@tukaani.org\\\" -DPACKAGE_NAME=\"\\\"XZ Utils\\\"\" -DPACKAGE_URL=\\\"https://xz.tukaani.org/xz-utils/\\\" -DTUKLIB_FAST_UNALIGNED_ACCESS -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE -I/usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/src/common -I/usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/src/liblzma/api -I/usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/builddir/lib -I/usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/lib -O2 -pipe -ffat-lto-objects -fPIC -mfloat-abi=hard -mthumb -mfpu=vfpv3-d16 -march=armv7-a+fp -fuse-ld=mold  -flto=auto -O2 -DNDEBUG -std=gnu99 -flto=auto -fno-fat-lto-objects -Wall -Wextra -pthread -MD -MT CMakeFiles/xzdec.dir/src/xzdec/xzdec.c.o -MF CMakeFiles/xzdec.dir/src/xzdec/xzdec.c.o.d -o CMakeFiles/xzdec.dir/src/xzdec/xzdec.c.o -c /usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/src/xzdec/xzdec.c\r\n/usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/src/xzdec/xzdec.c: In function ‘sandbox_enter’:\r\n/usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/src/xzdec/xzdec.c:329:36: error: ‘SYS_landlock_create_ruleset’ undeclared (first use in this function)\r\n  329 |         int landlock_abi = syscall(SYS_landlock_create_ruleset,\r\n      |                                    ^~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n/usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/src/xzdec/xzdec.c:329:36: note: each undeclared identifier is reported only once for each function it appears in\r\n/usr/local/tmp/crew/xzutils.20240224170549.dir/xz-5.6.0/src/xzdec/xzdec.c:349:29: error: ‘SYS_landlock_restrict_self’ undeclared (first use in this function)\r\n  349 |                 if (syscall(SYS_landlock_restrict_self, ruleset_fd, 0U) != 0)\r\n      |                             ^~~~~~~~~~~~~~~~~~~~~~~~~~\r\n[6*1/70] Linking C executable lzmainfo                                                                                                                                                                        ninja: build stopped: subcommand failed.\r\n```","reactions":{"url":"https://api.github.com/repos/tukaani-project/xz/issues/comments/1962425297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}},"public":true,"created_at":"2024-02-24T17:10:08Z","org":{"id":116083088,"login":"tukaani-project","gravatar_id":"","url":"https://api.github.com/orgs/tukaani-project","avatar_url":"https://avatars.githubusercontent.com/u/116083088?"}}
